function cdbElinkPortfolioNavigator(appContext) {
  // Application Name
  this.appName = 'PortfolioNavigator';
  // Application event namespace
  this.eventNS = '.portfolionavigator.cdbelink';

  this.detailURL = '';
  this.currProject = '';
  this.reloadFlag = false;
  // Should be set to '' for relative path
  this.ajaxRootURL = cdb.elink.baseURL + 'powerscript/cs.portfolios.navigator.navigator/';
  this.openCommentField = [];
};

//Inherites elinkBase
cdbElinkPortfolioNavigator.prototype = new cdbElinkBase();

/**
 * The start up function which will be called once after loading document.
 */
cdbElinkPortfolioNavigator.prototype.start = function () {
  this.setAppRefresh(false);
  
  $(document).ready(function() {

      //generate dataTable if in leaf folder
      if ($('#dataTables').length > 0){

          //select language
          function _init_dataTable(){
            _oLanguage = window.dataTableSettings.oLanguage;
          }

          function _fnDrawCallback(oSettings) {
              //disable dataTables pagination when there are too few items in the table
              var nrItems = oSettings.fnRecordsDisplay();
              if (oSettings._iDisplayLength >= nrItems) {
                  $(oSettings.nTableWrapper).find('.dataTables_paginate').hide();
                  $(oSettings.nTableWrapper).find('.dataTables_info').hide();
              }
              if (oSettings.aLengthMenu[0] >= nrItems) {
                  $(oSettings.nTableWrapper).find('.dataTables_length').hide();
              }
              //adds placeholder to DataTables searchbox
              $($('#dataTables_filter').find('input')).attr("placeholder",
                      window.dataTableSettings.sFilterPlaceholder);
              //enable/disable pagination when user changes items per page via "dataTables_length" selector
              $('select[name=dataTables_length]').on("change", function(event){
                    if ( parseInt($(this).val(), 10) >= nrItems) {
                        $(oSettings.nTableWrapper).find('.dataTables_paginate').hide();
                        $(oSettings.nTableWrapper).find('.dataTables_info').hide();
                    }
                    else{
                        $(oSettings.nTableWrapper).find('.dataTables_paginate').show();
                        $(oSettings.nTableWrapper).find('.dataTables_info').show();
                    }
              });
          }

          _init_dataTable();
          $('#dataTables').dataTable({
              "fnDrawCallback": function(oSettings) {
                                    _fnDrawCallback(oSettings);},
              "oLanguage": _oLanguage,
              "aaSorting": [[1,'asc'], [2,'asc']],
              "aoColumns": [
                            { "bSortable": false },
                            { "bSortable": true },
                            { "bSortable": true }
                           ]
          });

        }
    });

};


var pictureUploader = new cdbElinkPictureUploader();

pictureUploader.prepareModal = function(event) {
  var target = $(event.currentTarget);
  // for block image, looks up block cdb_object_id
  var image_to_object = $(target).closest('.block-content').find('.cdb-object-id').html().trim();
  var cdb_object_id = window.location.href.split('=')[1];
  var name = $(target).closest('.block-content').parent().find('h2').html().trim();
  if(image_to_object !== '' && (typeof image_to_object !== 'undefined')){
      this.setWindowTitle(name);
      // fills project id in the form to be submitted
      this.popupWindow.find('input[name=image_to_object]').val(image_to_object);
      this.popupWindow.find('input[name=cdb_object_id]').val(cdb_object_id);

  }
}
//Tells cdb.elink to run uploader.
cdb.elink.addApplication('cdb.elink.pictureuploader', pictureUploader);

//=== Activates Collapsible Blocks plug-in ===
var collapsibleBlocks = new cdbElinkCollapsibleBlocks();
collapsibleBlocks.blockSettingID = 'cdb.elink.portfolionavigator';
//Tells cdb.elink to run that plug-in.
cdb.elink.addApplication('cdb.elink.collapsibleblocks', collapsibleBlocks);

//Tells cdb.elink to run this application.
cdb.elink.addApplication('cdb.elink.portfolionavigator', new cdbElinkPortfolioNavigator());

