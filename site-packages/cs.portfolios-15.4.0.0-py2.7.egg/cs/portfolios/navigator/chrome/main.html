<metal:page use-macro="global_macros['cdb_welcome_page_layout']"
            tal:define="current_toolbar_op 'CDB_eLink_portfolio';
                        body_responsive_class 'cdb-responsive-normal';
                        cdbhelpid 'portfolio_navigator';
                        page_title categorie_ids[0][0]|options.labels.cdb_portfolio_page_title|'Portfolio Navigator'">
<html>
    <head>
        <metal:head fill-slot="head_block">
            <script src="${options.plugins}filters/class_filter.js" type="text/javascript"></script>
            <link href="${options.plugins}picture_uploader/picture_uploader.css" rel="stylesheet" type="text/css" />
            <script src="${options.plugins}picture_uploader/picture_uploader.js" type="text/javascript"></script>
            <link href="${options.plugins}collapsible_blocks/collapsible_blocks.css" rel="stylesheet" type="text/css" />
            <script src="${options.plugins}collapsible_blocks/collapsible_blocks.js" type="text/javascript"></script>
            <link href="${options.localres}main.css" rel="stylesheet" type="text/css" ></link>
            <script src="${options.localres}main.js" type="text/javascript"></script>
            <tal:block tal:condition="reached_product_level">
                <script src="${options.jscript}jquery/jquery.dataTables.min.js" type="text/javascript"></script>
                <script src="${options.jscript}jquery/jquery.ui.min.js" type="text/javascript"></script>
            </tal:block>
            <script type="text/javascript">
                $(document).ready(function() {
                    window.dataTableSettings = {
                            "oLanguage": $.parseJSON('${oLanguage}'),
                            "sFilterPlaceholder": "${sFilterPlaceholder}"
                        };
                });
            </script>
        </metal:head>
    </head>
    <body>
        <metal:pt fill-slot="page_title_content">
            <metal:opmenu use-macro="global_plugins['components'].macros.operations_dropdown_navbar"
                        tal:define="oplist options.operations.get_object_operations_for_context(context_object, context_name='CS.Portfolios')" />
        </metal:pt>
        <tal:pc metal:fill-slot="page_content">
            <div class="page-content">
                <div class="breadcrumb-path">
                    <tal:layout
                        tal:repeat="item path_list">
                            <metal:block metal:use-macro="templates['breadcrumbs_template.html'].macros.breadcrumb"
                                     tal:define="display python: dropdown_dict.has_key(item)">
                                <metal:block fill-slot="breadcrumb_link">
                                    <a href="${options.base_uri}powerscript/cs.portfolios.navigator.navigator${categories_ids[repeat.item.index-1][1]}" tal:omit-tag="not: display">
                                        <u><tal:block tal:replace="item" /></u>
                                    </a>
                                </metal:block>
                                <metal:block fill-slot="dropDownMenuText">
                                    ${categories_ids[repeat.item.index][0]}
                                </metal:block>
                                <metal:block fill-slot="dropdown_content" tal:condition="display">
                                    <ul class="dropdown-menu">
                                        <tal:block tal:repeat="li dropdown_dict[item]">
                                            <metal:block metal:use-macro="templates['breadcrumbs_template.html'].macros.dropdown">
                                                <metal:block fill-slot="dropdown_text">
                                                    <a href="${options.base_uri}powerscript/cs.portfolios.navigator.navigator?cdb_object_id=${li[1]}">
                                                        <tal:block tal:replace="li[0]" />
                                                    </a>
                                                </metal:block>
                                            </metal:block>
                                        </tal:block>
                                    </ul>
                                </metal:block>
                            </metal:block>
                    </tal:layout>
                </div>
                <div id="blocks">
                    <tal:block tal:condition="not: reached_product_level">
                        <tal:blocks repeat="block blocks[0]">
                            <tal:layout
                                metal:use-macro="global_plugins['collapsible_blocks'].macros['block_container']"
                                define="block_order block[0]">
                                <metal:filltitle fill-slot="block_title">
                                    <a href='${options.base_uri}powerscript/cs.portfolios.navigator.navigator?cdb_object_id=${block[1].cdb_object_id}'>
                                        <h2>${block[1].Name[""]}</h2>
                                    </a>
                                </metal:filltitle>
                                <metal:blockcontent fill-slot="block_content">
                                    <tal:block tal:define="img_link string:${options.base_uri}powerscript/cs.portfolios.navigator.navigator?cdb_object_id=${block[1].cdb_object_id}">
                                        <tal:previewImage
                                            metal:use-macro="global_plugins['picture_uploader'].macros['preview_image']"
                                            define="prev_img get_preview_img(block[1]);
                                                    btn_title options.labels.cdb_portfolio_btn_title;
                                                    img_link_target string:_self;
                                                    tile_detail_url string:${options.base_uri}powerscript/cs.portfolios.navigator.navigator?cdb_object_id=${block[1].cdb_object_id}"
                                        />
                                    </tal:block>
                                    <div class='cdb-object-id'>${block[1].cdb_object_id}</div>
                                </metal:blockcontent>
                            </tal:layout>
                        </tal:blocks>
                    </tal:block>
                    <tal:block tal:condition="reached_product_level">
                        <tal:tiles repeat="block blocks[0:-1]">
                            <tal:dummy tal:condition="len(block)>0">
                                <tal:layout
                                    metal:use-macro="global_plugins['collapsible_blocks'].macros['collapsible_block_container']"
                                    define="block_id block[0][1].GetClassname();
                                            block_expanded False">
                                    <metal:filltitle fill-slot="block_title">
                                        <h2>${block[0][1].GetClassDef().getTitle()}</h2>
                                    </metal:filltitle>
                                    <metal:content fill-slot="block_content">
                                        <tal:blocks repeat="item block">
                                            <tal:layout
                                                metal:use-macro="global_plugins['collapsible_blocks'].macros['block_container']"
                                                define="block_order item[0]">
                                                <metal:filltitle fill-slot="block_title">
                                                    <metal:title metal:use-macro="plugins[repeat.block.index][1].getTemplate('macros.html').macros['widget_title']"
                                                                    tal:define="obj item[1]"/>
                                                </metal:filltitle>
                                                <metal:filldropdown fill-slot="dropdown_menu">
                                                    <metal:dropdown metal:use-macro="plugins[repeat.block.index][1].getTemplate('macros.html').macros['widget_dropdown']"
                                                                    tal:define="obj item[1]"/>
                                                </metal:filldropdown>
                                                <metal:fillcontent fill-slot="block_content">
                                                    <metal:content metal:use-macro="plugins[repeat.block.index][1].getTemplate('macros.html').macros['widget_content']"
                                                                    tal:define="obj item[1]"/>
                                                </metal:fillcontent>
                                            </tal:layout>
                                        </tal:blocks>
                                    </metal:content>
                                </tal:layout>
                            </tal:dummy>
                        </tal:tiles>
                        <tal:dummy tal:condition="len(blocks[-1])>0">
                            <tal:layout metal:use-macro="global_plugins['collapsible_blocks'].macros['collapsible_block_container']"
                                define="block_id string:detail_more">
                                <metal:filltitle fill-slot="block_title">
                                    <h2>${options.labels['cdb_portfolio_more']}</h2>
                                </metal:filltitle>
                                <metal:fillcontent fill-slot="block_content">
                                    <metal:content metal:use-macro="templates['widget_weitereinfo.html'].macros.widget_table"
                                                                tal:define="obj blocks[-1]"/>
                                </metal:fillcontent>
                            </tal:layout>
                        </tal:dummy>
                    </tal:block>
                    <tal:modalupload
                            metal:use-macro="global_plugins['picture_uploader'].macros['upload_modal']"
                            define="modal_title options.labels.cdb_portfolio_modal_title;
                                    modal_desc options.labels.cdb_portfolio_modal_desc;
                                    action_url upload_action_url">
                        <metal:formHidden fill-slot="input_hidden">
                                <input type="hidden" name="cdb_object_id" value=""/>
                                <input type="hidden" name="image_to_object" value=""/>
                        </metal:formHidden>
                    </tal:modalupload>
                </div>
            </div>
        </tal:pc>
    </body>
</html>
</metal:page>





