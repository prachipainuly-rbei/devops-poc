.. _`officelink-adminmanual-config-common-server-metadata-sync`:

Serverseitiger Metadatenabgleich
################################

Gemeint ist hier nicht eine *vollständig* automatisierte auf dem Server ablaufende Aktion, d.h. ohne
dass dabei vorerst das entsprechende Dokument aus dem System zum Bearbeiten geöffnet wird. Gemeint
ist vielmehr das rein serverseitig lesende oder schreibende Auswerten von explizit dafür bestimmter
Dokumentvariablen. Der Unterschied zu den üblichen Dokumentvariablen besteht darin, dass die
serverseitigen Variablen flexibler benutzt werden können. Standardmäßig werden lesende serverseitige
Dokumentvariablen von einem Defaulthandler gefüllt.

.. important:: 

   Damit die (standardmäßig aktivierten) Komponentenmethoden :emphasis:`on_metadata_read` und
   :emphasis:`on_metadata_write` überhaupt aufgerufen werden, bzw. deren Signale
   :emphasis:`officelink_metadata_read` und :emphasis:`officelink_metadata_write` gesendet werden,
   muss es die für die :emphasis:`officelink` Komponente entsprechenden :guilabel:`Aktiver Aufruf`
   Werte :emphasis:`metadata|read` und :emphasis:`metadata|write` geben.

Folgender Code liefert der Beispielvariable aus dem Anwenderhandbuch
(:emphasis:`cdb.rs.document2cdb_file.cdbf_original_name.N.string.PRIMARY`) einen Wert zurück:

.. code-block:: python

    from cdb.sig import connect

    @connect("officelink_metadata_read")
    def set_result_values_in_excel_sheet(self, ctx):
        if ctx.object["cdb_classname"] == "document":
            from cs.documents import Document
            from cs.officelink.documentvariables import DocumentVariable
            doc = Document.ByKeys(ctx.object["cdb_object_id"])
            for var_name in ctx.document_variables:
                var = DocumentVariable(var_name)
                if var.relationship == "document2cdb_file":
                    if var.parameter == "PRIMARY":
                        ctx.document_variables[var_name] = doc.PrimaryFiles[0].cdbf_original_name
