.. _`officelink-usermanual-visio-metadata-template`:

Vorlagen zum Datenabgleich erstellen
####################################

Dieser Abschnitt beschreibt die Erstellung von Dokumentvorlagen mit den System-
Variablen zum Datenabgleich.

- Abgleich von Dokumentmetadaten (z.B. Titel, Dokument-Nr. ...)
- Abgleich von 1:1 referenzierten Objekten (z.B. Projektname des zugeordneten Projekts)

.. _`officelink-usermanual-visio-metadata-template-format`:

Formatbeschreibung für System-Variablen
=======================================

System-Variablen in Visio Dokumenten haben folgendes Format:
cdb.<Mode>.<Beziehung>.<Attribut>.<Kardinalität>

:guilabel:`Mode`
   Der Mode gibt an, ob eine Variable aus dem System ausschließlich gelesen oder auch
   nach Änderung im Dokument im System aktualisiert werden darf. Gültige Werte
   für den Modus sind:

   - :guilabel:`r`

     Nur Datenübernahme aus dem System möglich. Der übernommene Wert kann im Dokument
     verändert werden, jedoch nicht an das System übergeben werden. Bei erneuter
     Datenübernahme wird der geänderte Wert im Dokument wieder durch den System-Wert ersetzt.
   
   - :guilabel:`w`

     Nur Datenübergabe in das System möglich. Durch diesen Modus kann sichergestellt
     werden, dass ein Dokumentfeld durch eine Datenübernahme nicht verändert werden kann,
     eine Aktualisierung im System aber möglich ist (sinnvoll bei Feldern, die durch
     das Dokument berechnet werden). Dieser Modus kann nicht bei 1:N Beziehungen
     verwendet werden.
   
   - :guilabel:`rw`

     Datenübernahme aus dem System und Aktualisierung im System nach Änderung im Dokument
     möglich. Dieser Modus kann nicht bei 1:N Beziehungen verwendet werden.

:guilabel:`Beziehung`
   Die Beziehung gibt ausgehend vom Dokument den Pfad zu den durch die Variable
   repräsentierten Daten im System an. Als Beziehung können folgende Ausdrücke
   verwendet werden:

   - :guilabel:`this`

     Der konstante Ausdruck 'this' wird verwendet, um Attribute des Dokuments
     selbst anzugeben.
   
   - :guilabel:`Name einer in CIM DATABASE konfigurierten Beziehung`

     Über eine Beziehung können Attribute von referenzierten Objekten übernommen
     und abgeglichen werden.
   
   - :guilabel:`BY_ZNUM_ZIDX_FROM_<table_name>`

     Verwendung einer impliziten Beziehung über die Attribute z_nummer und z_index.
     Hierzu wird der Ausdruck BY_ZNUM_ZIDX_FROM_<table_name> angegeben.
     table_name gibt dabei die Datenbanktabelle an, aus der ein Objekt über z_nummer
     und z_index implizit referenziert wird. Die angegebene Datenbanktabelle
     muss die Attribute z_nummer und z_index enthalten und die Kombination
     aus z_nummer und z_index muss eindeutig sein.

:guilabel:`Attribut`
   Das Attribut spezifiziert ein Attribut eines durch die Beziehung referenzierten
   System-Objekts.

   Sachmerkmale als Attribute von Artikeln:

   Wird eine Artikelbeziehung als Beziehung angegeben, können auch die Sachmerkmale
   des Artikels als Attribut angegeben werden. Dies kann qualifiziert über die Merkmalkennung
   oder unqualifiziert mittels Zählnummer erfolgen:

   - :guilabel:`Sachmerkmale qualifiziert:`

     ``_SML_<mm_mk>``

     .. container:: example
   
        .. rubric:: Visio: Datenabgleich - Sachmerkmale qualifiziert

        Sachmerkmal mit der Kennung 'L' des zugeordneten Artikels
        
        .. code-block:: none

            ``cdb.r.cdb_doc_to_part._SML_L``

   - :guilabel:`Sachmerkmale unqualifiziert:`

     ``_SMLN<nummer> für Merkmalskennungen``

     ``_SMLV<nummer> für Merkmalswerte``

     Merkmalkennung und der zugehörige Wert müssen dabei dieselbe Nummer haben.

     .. container:: example
   
        .. rubric:: Visio: Datenabgleich - Sachmerkmale unqualifiziert

        Kennung und Wert des erstes Sachmerkmals des zugeordneten Artikels
        
        .. code-block:: none

            ``cdb.r.cdb_doc_to_part._SMLN1``
            ``cdb.r.cdb_doc_to_part._SMLV1``

   .. important::

      SML Attribute können nicht schreibend synchronisiert werden!

:guilabel:`Kardinalität`
   Gibt die Kardinalität der Beziehung an. Wenn keine Kardinalität angegeben wurde,
   wird von der Kardinalität 1 ausgegangen. Bei der Erstellung neuer Dokumentvorlagen
   sollte die Kardinalität explizit angegeben werden. Folgende Werte können für die
   Kardinalität verwendet werden:

   - :guilabel:`1`

     Für Beziehungen vom Typ ``this, BY_ZNUM_ZIDX_FROM_<table_name>``
     und für 1-stellige homogene Beziehungen.

.. _`officelink-usermanual-visio-metadata-template-definition`:

Definition von System-Variablen
===============================

Die Definition von System-Variablen erfolgt mit einem Assistenten, der über die Schaltfläche
:guilabel:`[ Verwalten ]` der OfficeLink-Symbolleiste aufgerufen wird. Damit die Schaltfläche 
verfügbar ist, muss sie zuvor in dem Einstellungsdialog aktiviert worden sein. Der Dialog 
bietet auf der linken Seite die Möglichkeit neue Variablen im System-Format anzulegen 
(siehe :ref:`officelink-usermanual-visio-metadata-template-format` ). Auf der rechten 
Seite werden alle im Dokument enthaltenen System-Variablen angezeigt. Durch Markierung einer 
Variablen wird gleichzeitig das entsprechende Textfeld in der Visio Dokument markiert. Durch 
Betätigung der Schaltfläche :guilabel:`[ Variable löschen ]` kann die markierte 
Variable aus dem Dokument entfernt werden.

.. _`officelink-usermanual-visio-metadata-template-definition-dialog`:

.. figure:: images/visio2007_docvar_dialog.png
   :align: center

   Visio: Datenabgleich - Dialog zur Erstellung von System-Variablen

- :guilabel:`Beziehung:`   

  Die Beziehung gibt ausgehend vom Dokument den Pfad zu einem Attribut eines oder 
  mehrerer referenzierter System-Objekte an. Der Katalog bietet alle im System 
  konfigurierten Dokumentenbeziehungen an, bei denen das Dokument das Startobjekt 
  darstellt. Für Attribute des Dokuments selbst, muss in diesem Feld 
  ``this`` eingetragen werden. 

  Zur Verwendung einer impliziten Beziehung, die über die Schlüsselattribute 
  Dokumentennummer und Index hergestellt wird, muss in diesem Feld 
  ``BY_ZNUM_ZIDX_FROM_`` ausgewählt werden und 
  im Feld Datenbanktabelle eine Relation als Datenquelle ausgewählt werden.

- :guilabel:`Datenbanktabelle:`   

  Eine Datenbanktabelle muss nur dann ausgewählt werden, wenn im Feld Beziehung 
  der spezielle Eintrag ``BY_ZNUM_ZIDX_FROM_`` für 
  implizite Beziehungen ausgewählt wurde. In der ausgewählten Relation muss die 
  Kombination der Attribute z_nummer und z_index eindeutig sein. 

- :guilabel:`Attribut:`   

  Das Attribut spezifiziert ein Attribut eines durch die Beziehung referenzierten 
  System-Objekts.

- :guilabel:`Abgleichmodus:`   

  Der Modus gibt an, ob eine Variable aus dem System ausschließlich gelesen oder auch 
  nach Änderung im Dokument im System aktualisiert werden darf:

  r: nur lesend

  w: nur schreibend

  rw: lesender und schreibender Zugriff in CIM DATABASE

- :guilabel:`CIM DATABASE Variable:`

  In diesem Feld wird der aus den anderen Feldern erzeugte Ausdruck für die zu 
  erstellenden System-Variable angezeigt. Das manuelle Ändern dieses Ausdrucks 
  ist nur zur Angabe von Sachmerkmalen bei Artikelbeziehungen erforderlich.

Beim Hinzufügen der Variablen durch Betätigung der Schaltfläche :guilabel:`[ Variable hinzufügen ]` wird der in dem Feld System-Variable angezeigte Ausdruck überprüft 
und bei Ungültigkeit eine entsprechende Fehlermeldung angezeigt. Ansonsten wird die 
Variable als neue System-Variable in dem aktiven Dokument angelegt und mit dem Wert 
``<Attribut>`` als Platzhalter initialisiert.

.. important:: 

   Die System-Variablen können nur in einfachen Visio 'Formen' plaziert werden.
   Desweiteren kann nur jeweils eine System-Variable pro Visio Form definiert werden.
   Es erscheint eine Fehlermeldung, falls versucht wird eine neue Variable zu definieren, 
   ohne dass eine einfache Form aktiviert ist, oder falls die zur Zeit aktivierte Form
   schon eine Variable enthält.

.. _`officelink-usermanual-visio-metadata-template-change`:

Ändern von System-Variablen
===========================

Die Änderung der Textfelder, welche System-Variablen beinhalten, erfolgt durch Mausklick 
in das zu ändernde Feld. Der Cursor befindet sich dann innerhalb des Feldes und ermöglicht 
eine freie Bearbeitung.

.. _`officelink-usermanual-visio-metadata-template-usage`:

Verwendung von System-Variablen im Dokument
===========================================

System-Variablen sollten im Dokument für den Anwender kenntlich gemacht werden, 
um versehentliches Löschen oder Überschreiben zu vermeiden. Der Schutz von 
Dokumentenvariablen ist nur bedingt möglich. Eine Möglichkeit ist die Erstellung 
von Formularen.

.. note:: 

   Beim Datenabgleich von Variablen in das System werden Attributänderungen auch dann 
   vorgeblendet, wenn das Feld laut Maskenkonfiguration durch den Anwender nicht 
   interaktiv änderbar oder nur via Katalogauswahl änderbar wäre. Bei der Verwendung 
   von System-Variablen mit schreibenden Zugriff ist dies zu berücksichtigen. Gegebenenfalls 
   ist die Gültigkeit der Werte durch eine entsprechende Prüfung im User Exit abzusichern.

.. _`officelink-usermanual-visio-metadata-template-autoupdate`:

Automatisches Aktualisieren von Metadaten
=========================================

Die Metadaten aller System-Variablen mit lesendem Zugriff werden beim Laden eines Dokuments aus CDB automatisch übernommen.
Die Bedingungen dafür sind, dass das Dokument:

#. im Client im "Bearbeiten" Modus geöffnet wurde (oder direkt aus Office heraus über "Laden")
#. eine "Zeichnung" ist (d.h. die Eigenschaft "vorlage_kz" hat)
#. keine Vorlage ist (d.h. "vorlage_kz=0")