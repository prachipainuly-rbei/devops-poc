from datetime import datetime
from cs.activitystream.objects import SystemPosting
from cs.activitystream.posting_queue import SystemPostingJob, getQueue
from cdb.testcase import RollbackTestCase


class TestPostingQueue(RollbackTestCase):
    def test_create_posting(self):
        q = getQueue()
        job = q.put(title_de="test titel",
                    cdb_cdate=datetime.now(),
                    context_object_id="09098029384",
                    cdb_cpersno="test")
        assert isinstance(job, SystemPostingJob)
        posting = job.create_posting()
        assert isinstance(posting, SystemPosting)
        assert posting.title_de == job.title_de
        assert posting.cdb_cdate == job.cdb_cdate
        assert posting.context_object_id == job.context_object_id
        assert posting.cdb_cpersno == job.cdb_cpersno
