/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: Sidebar.jsx 168430 2017-11-14 13:52:36Z yzh $"
 */

import React from 'react';
import Channels from './Channels';
import Channel from './Channel';
import Subscriptions from './Subscriptions';
import Immutable from 'immutable';
import {formatStr} from '../i18n';
import {prefixNS} from '../helpers';
import {ReactRouter, PropTypes} from 'cs-web-components-externals';
import {parseQuery, FormControl} from 'cs-web-components-base';

class Sidebar extends React.PureComponent {
    constructor(props) {
        super(props);
        this.state = {
            filter: ''
        };
        this.setFilter = this.setFilter.bind(this);
    }

    setFilter(value) {
        this.setState({
            filter: value
        });
    }

    render() {
        const {location} = this.props;
        const showAll = Immutable.Map({
            cdb_object_id: undefined,
            description: formatStr('all')
        });
        const currentTopic = parseQuery(location).topic;
        const {filter} = this.state;
        return (
            <div className={prefixNS('sidebar-navigations')}>
                <div className={prefixNS('filter-bar')}>
                    <div className={prefixNS('filter-bar-filter')}>
                        <FormControl.TextInput
                            name={prefixNS('channel-filter')}
                            placeholder={formatStr('filter_by_channel')}
                            value={filter}
                            onValueChange={this.setFilter}/>
                    </div>
                </div>
                <div className="clearfix"/>
                <Channel
                    className={prefixNS('channel-show-all')}
                    channel={showAll}
                    currentTopic={currentTopic}
                    location={location} />
                <Channels location={location}
                          currentTopic={currentTopic}
                          filter={filter}/>
                <Subscriptions location={location}
                               currentTopic={currentTopic}
                               filter={filter}/>
            </div>
        );
    }
}

Sidebar.propTypes = {
    location: PropTypes.object
};

export default ReactRouter.withRouter(Sidebar);
