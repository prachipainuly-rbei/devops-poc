/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: helpers.js 168151 2017-11-09 14:47:33Z yzh $"
 */

import moment from 'moment';
import {getLocalPathForURL, getAppSetup} from 'cs-web-components-base';
import {TOPIC_LINK} from './constants';
import Immutable from 'immutable';

export const APPBASE = getAppSetup().getIn(['appSettings', 'basePath']);

export function prefixNS(name) {
    return `${componentNameSpace}-${name}`;
}

export function getReferencedPostings(state, oids) {
    if (oids === undefined) {
        return undefined;
    }
    if (typeof oids === 'string') {
        return state.objectsById.get(oids);
    }
    const result = oids
        .map(ref => state.objectsById.get(ref))
        .filter(obj => obj !== undefined);
    return result;
}

export function formatDate(dateStr) {
    return moment(dateStr, moment.ISO_8601).calendar();
}

export function getPostingURL(postingID) {
    const collURL = getAppSetup().getIn([componentNameSpace, 'dataURL']);
    if (postingID === undefined) {
        return collURL;
    }
    return `${collURL}/${postingID}`;
}

export function byTopicURL(topicID) {
    return `${TOPIC_LINK}/${topicID}`;
}

export function getToLink(url) {
    return getLocalPathForURL(url, APPBASE);
}

export function convertSearchResultItem(item) {
    return Immutable.Map({
        'cdb_object_id': item.get('cdb_object_id'),
        'description': item.get('title'),
        'object_icon': item.get('icon'),
        'object_id': item.get('rest_url')
        // disable link for search result because
        // it replaces the dialog by navigating
        // 'object_ui_link': item.get('ui_link')
    });
}

export function filterChannels(channels, filter) {
    if (!filter) {
        return channels;
    }
    const text = filter.toLowerCase();
    return channels.filter(
        channel => channel.get('description').toLowerCase().indexOf(text) > -1);
}
