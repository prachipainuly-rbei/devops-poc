<metal:postings define-macro="postinghead">
  <link href="${options.localres_base}cs.activitystream/cdbblog-postings.css" rel="stylesheet" type="text/css" />
  <link href="${cssfile}" rel="stylesheet" type="text/css"
        tal:repeat="cssfile postingtools.get_plugin_css_files()"
        tal:condition="postingtools"/>
  <script src="${options.jscript}jquery/jquery.autosize.js" type="text/javascript"></script>
  <script src="${options.localres_base}cs.activitystream/cdbblog-postings.js" type="text/javascript"></script>
</metal:postings>

<metal:postings define-macro="postinglist">
<div class="cdbblog-postinglist"
     data-elink-cdbblog-posting-topic-id="${topic_id}"
     data-elink-cdbblog-cnt="${posting_cnt|nothing}"
     data-elink-cdbblog-no-channels="${no_channels|None}"
     tal:define="topic_id topic_id|''">
  <metal:labels use-macro="postingtools.templates()['custom_layouts.html'].macros['label_texts']|
                           postingtools.templates()['layouts.html'].macros['label_texts']" />
  <metal:inputfield use-macro="postingtools.templates()['custom_layouts.html'].macros['posting_input']|
                               postingtools.templates()['layouts.html'].macros['posting_input']"
                    tal:define="create_posting create_posting|True;
                                ph_label 'cdbblog_placeholder_new' if topic_id else 'cdbblog_placeholder_new_to_all'"
                    tal:condition="create_posting" />
  <button class="btn btn-primary new-postings-button hide">${options.labels['cdbblog_more_new']|'Load New Postings'}</button>
  <metal:postingloop use-macro="postingtools.templates()['postings.html'].macros['postingloop']"
                     tal:define="create_posting nothing"/>
</div>
</metal:postings>

<metal:postings define-macro="postingloop">
<tal:postings tal:repeat="posting postings">
  <metal:posting use-macro="postingtools.templates()['custom_layouts.html'].macros[clsname]|
                            postingtools.templates()['layouts.html'].macros[clsname]|
                            postingtools.templates()['layouts.html'].macros['cdbblog_user_posting']"
                 tal:define="clsname posting.GetClassname()" />
</tal:postings>
<tal:morebutton condition="more_postings>0">
<button class="btn btn-primary more-postings-button hide"
        tal:define="last_posting postings[-1] if len(postings) else None;
                    last_date postingtools.format_date(last_posting.last_comment_date) if last_posting else None"
        data-elink-cdbblog-last_date="${last_date}"
        data-elink-cdbblog-last_id="${last_posting.cdb_object_id|nothing}">${options.labels['cdbblog_more']}</button>
</tal:morebutton>
<tal:placeholdertext condition="len(postings)<1">
<!-- No more postings -->
</tal:placeholdertext>
</metal:postings>
