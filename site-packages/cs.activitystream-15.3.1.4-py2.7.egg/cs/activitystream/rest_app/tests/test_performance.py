import cProfile
from webtest import TestApp as Client
from unittest import SkipTest
from cdb.testcase import RollbackTestCase
from cs.platform.web.root import Root
from . import util


raise SkipTest("Work in process")


AMOUNT = 1000


class TestPerformance(RollbackTestCase):
    def setUp(self):
        super(TestPerformance, self).setUp()
        app = Root()
        self.client = Client(app)
        util.gen_user(AMOUNT)
        util.gen_channel(AMOUNT)
        util.gen_attachments(AMOUNT)
        util.gen_postings(AMOUNT)
        util.subscribe_all()

    def test_load_postings(self):
        prof = cProfile.Profile()
        prof.enable()
        self.client.get('/internal/activitystream/posting?posting_count=30')
        prof.disable()
        prof.dump_stats("performance_test_load_postings_%d.profile" % AMOUNT)

    def test_load_channels(self):
        prof = cProfile.Profile()
        prof.enable()
        self.client.get('/internal/activitystream/channel')
        prof.disable()
        prof.dump_stats("performance_test_load_channels_%d.profile" % AMOUNT)
