/**
 * CDB Blog Home Page Application
 * @param appContext: the selector of the context element for this
 *                application.
 */
function cdbElinkBlogHomePage(appContext) {
  // Application Name
  this.appName = 'CDBBlogHomePage';
  // Application event namespace
  this.eventNS = '.cdbbloghomepage.cdbelink';

  // Should be set to '' for relative path
  this.ajaxRootURL = cdb.elink.baseURL + 'powerscript/cs.activitystream/';
};

//Inherites elinkBase
cdbElinkBlogHomePage.prototype = new cdbElinkBase();

/**
 * Filter checkbox
 * (Event handler, use 'this' to reference the application object,
 *  use 'event.currentTarget' to get the target object.)
 */
cdbElinkBlogHomePage.prototype.changeFilter = function(event) {
  blogPosting.refreshPostingList();
};

cdbElinkBlogHomePage.prototype.start = function(event) {
  $(this.context).on(
      this.nsEvents('click'),
      '.posting-filters input:checkbox',
      this.appEventHandler('changeFilter'));
};

var blogPosting = new cdbElinkBlogPosting('.blog-container');
blogPosting.reloadPostingURL = blogPosting.ajaxRootURL + 'reloadstartpage';
blogPosting.checkNewPostingURL = blogPosting.ajaxRootURL + '_check_start_page_new_postings';

blogPosting.getPostingFilters = function(data) {
  var filterContainer =$('#elink_page_content .posting-filters').first();
  if ($('input:checkbox[data-elink-blog-filter=filter-mine]', filterContainer).is(':checked')) {
    data['filter_mine'] = 1;
  }
  if ($('input:checkbox[data-elink-blog-filter=filter-userpostings]', filterContainer).is(':checked')) {
    data['filter_userpostings'] = 1;
  }
  if ($('input:checkbox[data-elink-blog-filter=filter-systempostings]', filterContainer).is(':checked')) {
    data['filter_systempostings'] = 1;
  }
  var clsfilters = [];
  $('input:checked[data-elink-blog-filter^=filter-class-]', filterContainer).each(function() {
    clsfilters.push($(this).data('elink-blog-filter').replace('filter-class-', ''));
  });
  if (clsfilters.length > 0) {
    data['filter_classes'] = clsfilters.join(" ");
  }
};

//Tells cdb.elink to run blogPosting.
cdb.elink.addApplication('cdb.elink.blogposting', blogPosting);
//Tells cdb.elink to run Blog home page
cdb.elink.addApplication('cdb.elink.bloghomepage', new cdbElinkBlogHomePage());
cdb.elink.pinTab(true);
