// jshint esversion:6

import jQuery from 'jquery';

const get = def => obj => key => (obj[key] !== undefined) ? obj[key] : def;


export default mapping => store => next => action => {
    const followUps = get([])(get({})(mapping)(action.containerId))(action.type);
    for (let followUp of followUps) {
        if (jQuery.isFunction(followUp)) {
            store.dispatch(followUp(action));
        } else {
            store.dispatch(Object.assign({}, action, followUp));
        }
    }

    return next(action);
};
