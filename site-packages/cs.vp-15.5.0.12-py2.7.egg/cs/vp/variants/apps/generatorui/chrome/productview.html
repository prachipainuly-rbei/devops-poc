<metal:page use-macro="global_macros['cdb_welcome_page_layout']"
            tal:define="body_responsive_class 'cdb-responsive-normal';
                        page_title context.page_title;
                        cdbicon 'cdbpco_matrix';
                        no_title_bar_refresh True;
                        no_quick_access True;
                        cdbhelpid 'cs_vp_variants_editor';
                        no_title_bar embedded;
                        product_collapsed embedded">

    <metal:head fill-slot="head_block" tal:condition="context.readable">
        <link rel="stylesheet" href="${options.images}jquery/jquery.ui.min.css" />
        <link rel="stylesheet" href="${options.localres}css/demo_table_jui.css" />

        <script src="${options.localres}js/jquery.dataTables.min.js" type="text/javascript"></script>
        <script src="${options.jscript}jquery/jquery.jeditable.mini.js" type="text/javascript"></script>
        <script src="${options.localres}js/jquery.dataTables.cdb.elink.rowselection.js" type="text/javascript"></script>
        <script src="${options.localres}js/jquery.dataTables.fixedColumns.min.js" type="text/javascript"></script>
        <script src="${options.jscript}jquery/dataTables/jquery.dataTables.columnFilter.js" type="text/javascript"></script>
        <link href="${options.plugins}datatables/datatables.css" rel="stylesheet" type="text/css" />
        <link href="${options.plugins}picture_uploader/picture_uploader.css" rel="stylesheet" type="text/css" />
        <script src="${options.plugins}picture_uploader/picture_uploader.js" type="text/javascript"></script>
        <script src="${options.jscript}jquery/jquery.jeditable.mini.js" type="text/javascript"></script>
        <link rel="stylesheet" href="${options.localres}css/productview.css" />
        <script type="text/javascript">
        var labels = $.parseJSON('${labels}');
        var meta_data_columns_visible=$.parseJSON('${vecf}');
        var embedded_mode = ${'true' if embedded else 'false'};
        var obj_type = '${obj_type}';
        </script>
        <script src="${options.localres}js/misc.js" type="text/javascript"></script>
        <script src="${options.localres}js/productview.js" type="text/javascript"></script>

        <style tal:condition="embedded">
            /**
             * Embedded Mode
             */

            div#elink_page_content {
                box-shadow: none;
            }

            body.cdb-bg-gradient {
                background-color: white;
                background-image: none;
                padding-top: 0px;
            }
        </style>
    </metal:head>
      <metal:pagecontent fill-slot="page_content" tal:condition="context.readable">
          <div id="context-div" data-elink-cdbvp-state_id="${context.state_id| nothing}"
                        data-elink-cdbvp-json_data_url="${context.json_data_url| nothing}"
                        data-elink-cdbvp-localres-url="${options.localres| nothing}"
                        data-elink-picture-uploder-window-title="${page_title| nothing}">
            <div tal:condition="context.show_product_info | nothing">
              <div>
                <img alt="" id="toggle"
                    tal:attributes="src options.localres +
                        ('images/open.png' if not product_collapsed
                        else 'images/closed.png')"
                    onclick="variant_editor.show_hide_product_details()"/>
                <para style="vertical-align: middle;" class="heading2"
                      tal:content="options.labels['cdbvp_product_details']">

                </para>
              </div>
              <div id="product_details"
                tal:attributes="style 'display:none' if product_collapsed else None">

                <div class="container-fluid">
                  <div class="row-fluid">
                    <div style="float: left; display: block;">

                        <tal:previewImage
                        metal:use-macro="global_plugins['picture_uploader'].macros['preview_image']"
                        define="prev_img get_preview_img(context.product);"/>

                    </div>

                    <div style="float: left; display: block; width: 70%;">
                      <div class="container-fluid">

                        <div class="row-fluid">
                          <div class="span6 fix-text" style="width: 48.7179%; color: #999999; min-height: 0;">
                            <small tal:content="options.labels['cdbvp_product_maturity']"></small>
                          </div>
                          <div class="span6 fix-text" style="width: 48.7179%; color: #999999; min-height: 0;">
                            <small tal:content="options.labels['cdbvp_max_boms']"></small>
                          </div>
                        </div>
                        <div class="row-fluid">
                          <div class="span6 fix-text" style="width: 48.7179%;">
                            <small
                            tal:content="context.product.ProductMaturity.Name[''] if context.product.ProductMaturity else ''"></small>
                          </div>
                          <div class="span6 fix-text" style="width: 48.7179%;">
                            <!-- <div style="display: inline-block;"> -->

                            <div tal:repeat="maxbom context.maxboms">
                              <input type="radio" name="maxbom" id="maxbom_radio_button" value="${maxbom.ID()| nothing}"
                                data-maxbom="${'%(teilenummer)s#%(t_index)s' % maxbom}">
                              <small>
                                <a href="${maxbom.MakeURL('CDB_ProductStructure')| nothing}"
                                   target="_blank"
                                   tal:content="maxbom.GetDescription()"></a>
                              </small>
                            </div>
                          </div>
                        </div>

                        <div class="row-fluid">
                          <div class="span6 fix-text" style="width: 48.7179%; color: #999999; min-height: 0;">
                            <small tal:content="options.labels['cdbvp_status_vm']"></small>
                          </div>
                          <div class="span6 fix-text" style="width: 48.7179%; color: #999999; min-height: 0;">
                            <small tal:content="options.labels['cdbvp_responsible']"></small>
                          </div>
                        </div>
                        <div class="row-fluid">
                          <div class="span6 fix-text" style="width: 48.7179%;">
                            <small>${context.product.joined_status_name}</small>
                          </div>
                          <div class="span6 fix-text" style="width: 48.7179%;">
                            <small>${context.product.mapped_subject_name| nothing}</small>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div id="cdb_buttons">
                <div class="btn-toolbar pull-left">
                  <div class="btn-group">
                    <button title="${options.labels['cdbvp_save']}" id="save_button" onclick="variant_editor.sync_selection()" class="btn" disabled>
                      <img alt="" src="${options.localres}images/save.png"
                           title="${options.labels['cdbvp_save']}">
                    </button>
                    <button title="${options.labels['cdbvp_delete_saved_variants']}" id="delete_saved_variants" onclick="variant_editor.delete_saved_variants()" class="btn" disabled>
                      <img alt="" src="${options.localres}images/delete_variant.png"
                             title="${options.labels['cdbvp_delete_saved_variants']}">
                    </button>
                    <button title="${options.labels['cdbvp_exclude_variants']}" id="exclude_variants" onclick="variant_editor.exclude_variants_from_solution_space()" class="btn" disabled>
                      <img alt="" src="${options.localres}images/exclude.png"
                             title="${options.labels['cdbvp_exclude_variants']}">
                    </button>
                    <button title="${options.labels['cdbvp_instantiate_max_bom']}" id="instantiate_max_bom_button" onclick="variant_editor.instantiate_max_bom()" class="btn" disabled
                            tal:condition="context.show_product_info | nothing">
                      <img alt="" src="${options.getIcon('cdb_part1')}"
                             title="${options.labels['cdbvp_instantiate_max_bom']}">
                    </button>
                    <button title="${options.labels['cdbvp_export_csv']}" id="export_csv" onclick="variant_editor.csv_export()" class="btn">
                      <img alt="" src="${options.localres}images/csv_export.png"
                           title="${options.labels['cdbvp_export_csv']}">
                    </button>
                  </div>

                  <div class="btn-group">
                    <button title="${options.labels['cdbvp_show_product_structure']}" id="show_bom_button" onclick="variant_editor.show_filtered_bom()" class="btn" disabled>
                      <img alt="" src="${options.localres}images/product_structure.png"
                           title="${options.labels['cdbvp_show_product_structure']}">
                    </button>
                    <button title="${options.labels['cdbvp_generate_bom_report']}" id="show_bom_report_button" onclick="variant_editor.show_bom_report()" class="btn" disabled>
                      <img alt="" src="${options.localres}images/product_structure_report.png"
                           title="${options.labels['cdbvp_generate_bom_report']}">
                    </button>
                    <button title="${options.labels['cdbvp_variant_comparison']}" id="show_bom_comparison_button" onclick="variant_editor.show_bom_comparison()" class="btn" disabled>
                      <img alt="" src="${options.localres}images/product_structure_comparison.png"
                             title="${options.labels['cdbvp_variant_comparison']}">
                    </button>
                  </div>
                  <div class="btn-group" tal:condition="len(plugins) > 0">
                      <button title="${options.labels[plugins[0]['label']]}"
                              id="show_in_cad_button"
                              data-json-name="${plugins[0]['json_name']}"
                              data-open-new-window="${1 if plugins[0]['open_new_window'] else 0}"
                              data-multiselect="${1 if plugins[0]['multiselect'] else 0}"
                              onclick="variant_editor.show_in_cad()"
                              class="btn" disabled>
                          <img alt="" src="${options.getIcon(plugins[0]['icon'])}">
                      </button>
                      <button type="button"
                              id="show_in_cad_button_drop"
                              class="btn btn-default dropdown-toggle"
                              data-toggle="dropdown" disabled>
                          <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu btn-mini" id="show_in_cad_button_menu">
                             <tal:operations repeat="plugin plugins">
                            <li data-button-icon="${options.getIcon(plugin['icon'])}"
                                data-button-json="${plugin['json_name']}"
                                data-button-label="${options.labels[plugin['label']]}"
                                data-open-new-window="${1 if plugin['open_new_window'] else 0}"
                                data-multiselect="${1 if plugin['multiselect'] else 0}"
                                class="cad_entry"
                            ><img class="cad_icon_li" alt="" src="${options.getIcon(plugin['icon'])}">${options.labels[plugin['label']]}</li>
                          </tal:operations>
                      </ul>
                  </div>
                  <div class="btn-group">
                    <button title="${options.labels['cdbvp_create_variant_manually']}" id="create_manual_variant" onclick="variant_editor.create_manual_variant()" class="btn">
                      <img alt="" src="${options.localres}images/add_manual.png"
                             title="${options.labels['cdbvp_create_variant_manually']}">
                    </button>
                  </div>
                  <div class="btn-group">
                    <div title="${options.labels['cdbvp_views']}" id="view_selector">
                        <img alt="" src="${options.localres}images/view_selection.png" class="hidden" id="view_icon"
                               title="${options.labels['cdbvp_views']}">
                    </div>
                  </div>
                </div>

                <!-- Menu zum Ein- und Ausblenden von Sichtmerkmalen -->
                <div id="show_hide_properties" class="hidden">
                    <ul class="nav nav-pills">
                        <li class="dropdown">
                            <a class="dropdown-toggle" role="button" href="#" data-toggle="dropdown" role="button">
                                <small>${options.labels['cdbvp_elink_show_hide']}</small>
                                <b class="caret"></b>
                            </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                    <form id="dropdown-form">
                                    <li class="hidden template">
                                        <a href="#" tabindex="-1"><i class="" style="padding-right:10px;"></i></a>
                                    </li>
                                </form>
                            </ul>
                        </li>
                    </ul>
                </div>

            </div>

            <div class="unselectable">
                  <table id="grid" class="display dataTable" width="100%">
                    <thead>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                  <div id="pager"></div>
            </div>
          </div>

        <tal:modalupload
        metal:use-macro="global_plugins['picture_uploader'].macros['upload_modal']"
        define="modal_title options.labels.cdbvp_product_modal_title;
                 modal_desc options.labels.cdbvp_product_modal_desc"
        condition="context.show_product_info | nothing">
            <metal:formHidden fill-slot="input_hidden">
                <input type="hidden" name="cdb_object_id" value="${context.product.cdb_object_id| nothing}"/>
                <input type="hidden" name="image_to_object" value=""/>
              </metal:formHidden>
        </tal:modalupload>

      </metal:pagecontent>
</metal:page>
