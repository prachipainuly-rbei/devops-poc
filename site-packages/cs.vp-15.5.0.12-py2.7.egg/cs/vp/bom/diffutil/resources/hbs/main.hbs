{{#if rRootNode.nodeId}}
    <div class="row-fluid diffutil-prv-tbar-row row-layout header">
        {{preview-control csThreedInstalled=csThreedInstalled
                          threedUrl=threedUrl
                          linkBinding="previewLink"
                          titleBinding="previewItem.nr"
                          descriptionBinding="previewItem.description"
                          placeholder=controller.labels.cdbvp_elink_diffutils_preview
                          previewMode=previewMode
                          showPreviewControls=true
                          refreshAll="refreshAll"}}
    </div>
{{else}}
    {{preview-control showPreviewControls=false}}
    <div class="alert inplace alert-warning preview-warning">
    {{#if hasMultipleMBOMs}}
        {{controller.labels.cdbvp_elink_diffutils_mbom_select}}
    {{else}}
        {{controller.labels.cdbvp_elink_diffutils_mbom_no_mbom_available}}
    {{/if}}
    </div>
{{/if}}
<div {{bind-attr class=":diffutil :row-layout :body tableExpanded"}}>
    <div class="row-layout container">
        <div class="diffutil-metadata-row row-layout header">
            {{view "partMeta"}}
        </div>
        {{#if rRootNode.nodeId}}
            <div class="diffutil-treeview-tbar-row row-layout body">
                <div class="half-column lhs">
                    {{#if lRootNode.isFulfilled}}
                        {{tree-view-toolbar treeNode=lRootNode
                                            showNavigation=true
                                            viewSelector=App.BomTreeNodeViewSelector
                                            treeSearches=lTreeSearches
                                            searchString=lSearchString}}
                    {{/if}}
                </div>
                <div class="half-column rhs with-padding">
                    {{#if rRootNode.isFulfilled}}
                        {{tree-view-toolbar treeNode=rRootNode
                                            treeSearches=rTreeSearches
                                            searchString=rSearchString}}
                    {{/if}}
                </div>
            </div>
            <div id="mbom-draggable-containment" class="row-fluid diffutil-treeview-row row-layout body">
                {{#if lRootNode.nodeId}}
                    <div class="half-column lhs">
                        {{tree-view classNames="first-view"
                                    selectedNodesBinding="selectedNodes"
                                    selectedNodeBinding="selectedNode"
                                    operationsBinding="operations"
                                    treeNodeBinding="lRootNode"
                                    treeViewTitle=controller.labels.cdbvp_elink_diffutils_left_bom
                                    viewSelector=App.BomTreeNodeViewSelector
                                    expandLevel=expandLevelLeft
                                    findNodeBinding="selectedItem.item_object_id"
                                    showNavigation=true
                                    refreshBom="refreshBom"
                                    nodeClicked="nodeClicked"
                                    triggerSync="triggerSync"
                                    drag=true
                                    treeSearches=lTreeSearches
                        }}
                    </div>
                    <div class="half-column rhs">
                        <div class="btn sync" {{action 'triggerSync'}}><img {{bind-attr src=sync_view_icon}}></div>
                        {{tree-view classNames="second-view"
                                    selectedNodesBinding="selectedNodes"
                                    selectedNodeBinding="selectedNode"
                                    operationsBinding="operations"
                                    treeNodeBinding="rRootNode"
                                    treeViewTitle=controller.labels.cdbvp_elink_diffutils_right_bom
                                    viewSelector=App.BomTreeNodeViewSelector
                                    expandLevel=expandLevelRight
                                    findNodeBinding="selectedItem.item_object_id"
                                    showNavigation=true
                                    refreshBom="refreshBom"
                                    nodeClicked="nodeClicked"
                                    drag=true
                                    drop=true
                                    treeSearches=rTreeSearches
                        }}
                    </div>
                {{/if}}
            </div>
        {{/if}}
    </div>
</div>
{{#if rRootNode.nodeId}}
    {{#collapsible-block blocktitle=labels.cdbvp_elink_diffutils_differences
            classNames="diffutil row-layout footer diff-table-row" expanded=tableExpanded diffCount=ndiffs}}
        {{#if rRootNode.nodeId}}
            <div class="diffutil-table-row">
                <div {{bind-attr class="span12"}}>
                    {{diff-table selectedItem=selectedItem
                                 content=differences
                                 headerContent=diffHeaderContent
                                 hasProducts=hasProducts
                                 hasVariants=hasVariants
                                 selectVariant=selectVariant
                                 product=product
                                 products=products
                                 variant=variant
                                 linked=tableLinked
                                 showModalWindow="showModalWindow"
                                 errorMessage=labels.cdbvp_elink_diffutils_no_differences
                                 tableSizeChange=tableExpanded
                                 ignore="ignoreDifference"
                                 deleteIgnore="deleteIgnore"
                                 filter_txt=filter_txt}}
                </div>
            </div>
        {{/if}}
    {{/collapsible-block}}
{{/if}}

{{#if modalFirstLoad}}
    {{#modal-window
            isVisible=modalActive
            header=labels.cdbvp_elink_diffutils_select_variant
            footer_buttons=modalFooterButtons
            header_buttons=modalHeaderButtons
            buttonTriggered="modalButtonTriggered"}}
        <div class="container-fluid">
            {{#if hasProducts}}
                <div class="row-fluid modal-products">
                    <div class="span1">{{labels.cdbvp_elink_diffutils_product}}</div>
                    <div class="span11">
                        {{view Ember.Select
                                    content=products
                                    selection=product
                                    optionLabelPath="content.description"
                                    prompt=" "
                                    }}
                    </div>
                </div>
            {{/if}}
            {{#if variantsExists}}
                <div class="row-fluid modal-variants">
                    <div class="span12">
                        {{generic-table
                        content=variants
                        filter="searchVariants"
                        filter_placeholder=labels.cdbvp_elink_diffutils_search
                        selection=variant
                        numFixedColumns=2
                        rowHeight=16
                        headerContentBinding="variantTableHeader"
                        tableSizeChange=variantTableExpanded}}
                    </div>
                </div>
            {{/if}}
        </div>
    {{/modal-window}}
{{/if}}

{{#if showDebugTool}}
    {{debug-tool entries=debugEntries}}
{{/if}}

<div class="ajax-alerts">
</div>