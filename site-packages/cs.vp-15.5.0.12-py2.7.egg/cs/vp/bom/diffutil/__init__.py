#!/usr/bin/env python
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 1990 - 2013 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/

"""
Module cs.workflow.designer.designer
"""

__docformat__ = "restructuredtext en"
__revision__ = "$Id: __init__.py 121014 2015-02-24 15:41:26Z gda $"

from cdb import elink
from cdb import objects

import nanoroute


def log(txt):
    from cdb import misc
    misc.cdblogv(misc.kLogErr, 7, txt)


@elink.using_template_engine("chameleon")
class App(elink.Application):

    def setup(self):
        import pages
        self.add("index", pages.MainPage())
        self.add("preview", pages.BOMPreview())
#        self.add("templates", pages.TemplateProvider())
        self.add("api", pages.DataPage())
        self.addJSON(pages.custom_operation)

    @classmethod
    def on_cdbvp_mbom_manager_show_preview_now(cls, ctx):
        from cdb import ue
        return ue.Url4Context(cls.getModuleURL() + "preview")


# lazy instantiation
_APP = None


def _getapp():
    global _APP
    if _APP is None:
        _APP = App("App")
    return _APP


def handle_request(req):
    """Shortcut to the app"""
    return _getapp().handle_request(req)


router = nanoroute.LookUp()


# -- Ignored differences -------------------------------------------------------------------------------------------

class IgnoredDifferences(objects.Object):
    __maps_to__ = "cdbvp_diffutil_ignored"
    __classname__ = "cdbvp_diffutil_ignored"
