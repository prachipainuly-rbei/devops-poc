var path = require('path');
var glob = require("glob");


var js_path = (function() {
    var paths = process.env.JS_PATH;
    if (paths === undefined) {
        paths = "";
    }

    var result = [path.join(__dirname, 'node_modules')]
        .concat(paths.split(';'));
    return result;
})();


var aliases = (function() {
    var js_aliases = process.env.JS_ALIASES;
    var result = [];

    js_aliases.split(';').forEach(function(el) {
        var _el = el.split("::");
        var name = _el[0];
        var path = _el[1];

        result[name] = path;
    });
    return result;
})();


module.exports = {
    entry: glob.sync("./tests/*.js"),
    output: {
        path: path.join(__dirname, 'dist'),
        filename: 'tests.js',
        libraryTarget: 'umd',
        library: 'cs-base-tests'
    },
    devtool: 'source-map',
    modulesDirectories: ["node_modules"],
    module: {
        loaders: [
            {
                test: /\.jsx?$/,
                exclude: [
                    /node_modules/,
                ],
                loader: 'babel-loader?sourceMap=true'
            },
            { test: /\.css$/, loader: "style-loader!css-loader" },
            { test: /\.svg(\?v=\d+\.\d+\.\d+)?$/, loader: "url-loader?limit=10000&mimetype=image/svg+xml"},
            { test: /\.png$/, loader: "url-loader?limit=8192" },
            { test: /\.json$/, loader: "json-loader" }
        ]
    },
    resolveLoader: {
        fallback: js_path,
    },
    resolve: {
        alias: {
            'cs-items': path.join(__dirname, '..', '..', 'cs', 'vp', 'items', 'web', 'gui', 'webapp'),
            'cs-activitystream': path.join(aliases['cs-activitystream'], '..'),
            'cs-web-favorites': aliases['cs-web-favorites'],
            'bflummox': aliases['bflummox']
        },
        fallback: js_path,
        extensions: ['.js', '.jsx']
    }
};
