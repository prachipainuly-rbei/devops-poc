@productmanager
@engineering
@mbom
Feature: MBOM Diffutils


Scenario: Compute differences between EBOM and MBOM
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
    WHEN the quantity of an MBOM position is changed
    THEN the difference in the position and in its children is computed


Scenario: Cookie for expanded items
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the user has opened the mBOM Manager
    WHEN a bom item is expanded
        AND the page is refreshed
    THEN the item will still be expanded


Scenario: Operation registration
    GIVEN the user registers an operation
    THEN the operation is added to the list of all mBOM Manager operations

@skip
Scenario: Have multi select operations available
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the user has opened the mBOM Manager
    WHEN two mbom items are selected
        AND the operation drop down button is pressed
    THEN the mbom multi select operations are available

@skip
@engineering
Scenario: Drag and drop an ebom item into an mbom item
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the user has opened the mBOM Manager
    WHEN one ebom item is selected
        AND the selection is dragged and dropped on an mbom item
    THEN the ebom item is copied underneath the mbom item

@skip
@engineering
Scenario: Drag and drop an mbom item into a second mbom item
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the user has opened the mBOM Manager
    WHEN one mbom item is selected
        AND the selection is dragged and dropped on a second mbom item
    THEN the mbom item is moved underneath the second mbom item


@productmanager
Scenario: Select Variant to filter differences and bom trees
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND EBOM and MBOM are both assigned to the same product
        AND the product has properties
        AND the product has variants
        AND the EBOM and MBOM contain different selection predicates
    WHEN the user has opened the mBOM Manager
        AND the product is selected
        AND a variant is selected
    THEN the EBOM and MBOM structures are filtered
        AND the differences are filtered

@productmanager
Scenario Outline: Search Variants in variant table dialog
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND EBOM and MBOM are both assigned to the same product
        AND the product has 5 properties
        AND the product has 5 variants
        AND the product <has_or_has_not> a variant named <name>
    WHEN the user has opened the mBOM Manager
        AND the product is selected
        AND the user search variants with <searchstr>
    THEN the variant table has <n> variants

    Examples:
        | name            | has_or_has_not | searchstr        | n |
        |                 | has not        | search it        | 0 |
        | Contact Variant | has            | Contact Variant  | 1 |
        | Contact Variant | has            | variant          | 1 |
        |                 | has not        |                  | 5 |


@productmanager
Scenario: Compute Predicate differences
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND EBOM and MBOM are both assigned to the same product
        AND the product has properties
        AND the product has variants
        AND the EBOM and MBOM contain different selection predicates
    WHEN the user has opened the mBOM Manager
    THEN the part list position with different predicates is shown in the table


@productmanager
Scenario: Compute Predicate differences and split an EBOM position in two MBOM positions
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND EBOM and MBOM are both assigned to the same product
        AND the product has properties
        AND the product has variants
        AND the MBOM has two different positions for the same EBOM position
    WHEN the user has opened the mBOM Manager
    THEN the EBOM position is not shown the table


@productmanager
Scenario: Search differences
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the quantity of an MBOM position is changed
    WHEN the user has opened the mBOM Manager
        AND the user clicks on a difference in the difference table
    THEN only the relevant occurrences are found


@productmanager
Scenario: Open mBOM Manager from context of stored variant
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND EBOM and MBOM are both assigned to the same product
        AND the product has properties
        AND the product has variants
        AND the EBOM and MBOM contain different selection predicates
    WHEN the user has opened the mBOM Manager in context of stored variant
        AND the product is selected
    THEN the EBOM and MBOM structures are filtered
        AND the variant is automatically selected
        AND the differences are filtered

@skip
@productmanager
Scenario: Open mBOM Manager from context of VariantEditor with stored variant
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND EBOM and MBOM are both assigned to the same product
        AND the product has properties
        AND the product has variants
        AND the EBOM and MBOM contain different selection predicates
    WHEN the user has opened the Variant Editor
        AND the user selects a stored variant
        AND the user opens the mBOM Manager in context of variant
    THEN the EBOM and MBOM structures are filtered
        AND the variant is automatically selected
        AND the differences are filtered
@skip
@productmanager
Scenario: Open mBOM Manager from context of VariantEditor with virtual variant
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND EBOM and MBOM are both assigned to the same product
        AND the product has properties
        AND the EBOM and MBOM contain different selection predicates
    WHEN the user has opened the Variant Editor
        AND the user selects a variant
        AND the user opens the mBOM Manager in context of variant
    THEN the EBOM and MBOM structures are filtered
        AND the differences are filtered


Scenario: Filter differences by category
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the quantity of an MBOM position is changed
    WHEN the user has opened the mBOM Manager
        AND the user filters out a category
    THEN the differences are filtered out


@engineering
Scenario: mBOM is properly loaded
    GIVEN an EBOM exists
        AND the EBOM has two corresponding mBOM
    WHEN the user has opened the mBOM Manager
        AND the user selects a mBOM
    THEN the mBOM is properly loaded

@skip
@engineering
Scenario: mBOM description is shown in dropdown menu
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
    WHEN the user has opened the mBOM Manager
    THEN the mBOM description is shown in dropdown menu


@engineering
Scenario Outline: Start of mBOM Manager with different mBOM count
    GIVEN an EBOM exists
        AND the EBOM has <count> corresponding mBOM
    WHEN the user has opened the mBOM Manager
    THEN <message> is shown

    Examples:
        | count | message        |
        | no    | no_mBOM        |
        | two   | multiple_mBOMs |


@engineering
Scenario Outline: Filter differences by search field
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the user wants to perform a <search_type>
        AND the quantity of an MBOM position is changed
    WHEN the user has opened the mBOM Manager
        AND the user enters a search string
    THEN the differences are filtered out

    Examples:
        | search_type |
        | diff_search |


@engineering
Scenario Outline: Search node in tree views by search field
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the user wants to perform a <search_type>
    WHEN the user has opened the mBOM Manager
        AND the user enters a search string for <tree>
    THEN the node is found

    Examples:
        | tree | search_type |
        | eBOM | tree_search |
        | mBOM | tree_search |

@skip
@productmanager
Scenario Outline: Call operation on tree node
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the user has opened the mBOM Manager
    WHEN the user hovers over a <node_type> node
        AND the operation drop down button is pressed
    THEN the tree node operations are available

    Examples:
        | node_type |
        | EBOM      |
        | MBOM      |


Scenario Outline: Show only assembly or component differences
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the quantity of an MBOM position is changed
    WHEN the user has opened the mBOM Manager
        AND the user filters out the <what> differences
    THEN the <what> differences are filtered out

    Examples:
        | what      |
        | assembly  |
        | component |


Scenario Outline: Tag a difference as ignored
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the quantity of an MBOM position is changed
    WHEN the user has opened the mBOM Manager
        AND the user tags a <what> as ignored
    THEN the <what> is tagged as ignored

    Examples:
        | what       |
        | item       |
        | difference |


Scenario Outline: Tag a difference as not ignored
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the quantity of an MBOM position is changed
    WHEN the user has opened the mBOM Manager
        AND the user tags a <what> as ignored
        AND the user tags the row as not ignored
    THEN the row is not ignored anymore

    Examples:
        | what       |
        | item       |
        | difference |


Scenario: Data reload
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
    WHEN the user has opened the mBOM Manager
        AND a part list position is added to the EBOM
        AND a part list position is deleted from the mBOM
        AND a state of a part list position is changed
        AND a description of a part list position is changed
        AND the users clicks the reload button
    THEN the EBOM contains the added part list position
        AND the mBOM does not contain the deleted part list position
        AND the state changed part list position has the correct state
        AND the description changed part list position has the correct description
        AND the difference table has 2 differences


Scenario: Filter an MBOM based on production plant
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the MBOM has a plant-specific bom position
    WHEN the user has opened the mBOM Manager for a different plant
    THEN the plant-specific position is disabled
        AND the difference table has 4 differences


Scenario: Filter an MBOM based on production plant
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the MBOM has a plant-specific bom position
    WHEN the user has opened the mBOM Manager for the same plant
    THEN the plant-specific position is not disabled
        AND the difference table has 0 differences


Scenario: Filter an MBOM based on production plant and search difference
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the MBOM has a plant-specific bom position
    WHEN the user has opened the mBOM Manager for a different plant
        AND the user clicks on a difference in the difference table
    THEN the plant-specific position is disabled
        AND the difference is found

# Regression test
Scenario: Points in the item number
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the MBOM has an assembly with points in the item number
    WHEN the user has opened the mBOM Manager
        AND the user expands the MBOM assembly
    THEN the MBOM assembly is expanded

# Regression test
Scenario: Points in the item number after reload
    GIVEN an EBOM exists
        AND the EBOM has an MBOM
        AND the MBOM has an assembly with points in the item number
    WHEN the user has opened the mBOM Manager
        AND the user expands the MBOM assembly
        AND the MBOM assembly is expanded
        AND the page is refreshed
    THEN the MBOM assembly is expanded
