#!/usr/bin/env python
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 1990 - 2014 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

import string
import random

from cdb.validationkit import operation
from cs.calendar import CalendarEntry, CalendarDayType
from cdb import sqlapi, auth


def random_id(size=6, chars=string.ascii_uppercase + string.digits):
    return ''.join(random.choice(chars) for _ in range(size))


def get_created_entries(day_from, day_until):
    return CalendarEntry.Query("personalnummer = '%s' AND day >= %s AND day <= %s" %
                              (sqlapi.quote(auth.get_login()),
                               sqlapi.SQLdbms_date(day_from),
                               sqlapi.SQLdbms_date(day_until)))


def create_calendar_extries(day_from, day_until, day_type=None, person=None, capacity=0):
    if day_type is None:
        day_id = "1"
        day_type = CalendarDayType.KeywordQuery(day_type_id=day_id)[0]
    else:
        day_id = day_type.day_type_id
    if person is None:
        person = auth.get_login()

    preset = {"personalnummer": person,
              "day_type_id": day_id,
              "mapped_day_type": day_type.name_de,
              "capacity": capacity
              }

    user_input = {"day_from": day_from,
                  "day_until": day_until
                  }

    number_before = len(CalendarEntry.Query())
    operation("cdb_cal_entry_multi_new", CalendarEntry, user_input, preset)
    return number_before
