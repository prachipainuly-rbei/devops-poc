<metal:opmenu define-macro="operations_dropdown_menu"
              tal:define="oplist oplist|[]">
  <ul class="dropdown-menu">
    <metal:otheractions define-slot="pre_list" />
    <li tal:repeat="opdata oplist">
      <a href="${opdata['url']}"
         title="${opdata['tooltip']}"
         target="_blank" >
          <img class="operation_icon" src="${opdata['icon']}" />${opdata['fullpath_label']}</a>
    </li>
    <metal:otheractions define-slot="post_list" />
  </ul>
</metal:opmenu>

<metal:oplist define-macro="operations_dropdown">
<div class="btn-group elink-button-dropdown"
     tal:define="obj obj|None;
                 context_name context_name|None;
                 default_op default_op|None;
                 op_parameters op_parameters|{};
                 oplist oplist|options.operations.get_object_operations_for_context(obj, context_name, default_op, **op_parameters);
                 icon_only icon_only|True"
     tal:condition="len(oplist)">
  <a class="btn btn-mini"
           tal:define="opdata oplist[0]"
           href="${opdata['url']}"
           target="_blank"
           title="${opdata['fullpath_label'] if icon_only else opdata['tooltip']}"
           ><img src="${opdata['icon']}" alt="${opdata['label'] if icon_only else ''}" />
            ${'' if icon_only else opdata['fullpath_label']}</a>
  <button type="button" class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
    <span class="caret"></span>
  </button>
  <metal:menu use-macro="global_plugins['components'].macros.operations_dropdown_menu" />
</div>
</metal:oplist>

<metal:navop define-macro="operations_dropdown_navbar">
  <ul class="nav"
      tal:define="obj obj|None;
                  context_name context_name|None;
                  default_op default_op|None;
                  op_parameters op_parameters|{};
                  oplist oplist|options.operations.get_object_operations_for_context(obj, context_name, default_op, **op_parameters)"
      tal:condition="len(oplist)>0">
    <li class="dropdown">
      <a href="#"
            class="dropdown-toggle"
            data-toggle="dropdown"
            title="${oplist[0]['tooltip']}">${oplist[0]['fullpath_label']}
            <b class="caret"></b>
      </a>
      <metal:menu use-macro="global_plugins['components'].macros.operations_dropdown_menu" />
    </li>
  </ul>
</metal:navop>
