/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: Selector.jsx 174047 2018-03-06 06:26:20Z ssa $"
 */

import React from 'react';
import {PropTypes, ImmutablePropTypes} from 'cs-web-components-externals';
import {Table, FormControl} from 'cs-web-components-base';
import {prefixNS} from '../../helpers';
import {selectRow} from './actions';
import {getSingleSelectionMode} from './reducers';

const {connect} = Table;

class Renderer extends React.Component {
    constructor(props) {
        super(props);
        this.onChange = this.onChange.bind(this);
        this.onClick = this.onClick.bind(this);
    }

    onChange() {
        // Do nothing. The onClick on row takes care.
    }

    getRowID() {
        return this.props.row.get('id');
    }

    onClick(event) {
        event.stopPropagation();

        const {row} = this.props;
        this.props.selectRow(row.get('id'));
    }

    render() {
        const {selectedRows, singleSelectionMode, tableID, row} = this.props;
        if (row.get('functionalRow', false)) {
            // render Selector only if the row contains data, and is not computed
            return null;
        }
        const checked = selectedRows.contains(this.getRowID());
        const Selector = singleSelectionMode ? FormControl.Radio : FormControl.CheckBox;
        if (row.get("columns").toJS()[10] === "") {
            return null;
        }
        return (
            <div className={prefixNS('table-selector-column-renderer')}
                 onClick={this.onClick}>
                <Selector className={prefixNS('table-selector-column-content')}
                          checked={checked}
                          onChange={this.onChange}
                          name={prefixNS(`table-selector${tableID}`)}/>
            </div>
        );
    }
}

Renderer.propTypes = {
    singleSelectionMode: PropTypes.bool,
    selectedRows: ImmutablePropTypes.orderedSet,
    selectRow: PropTypes.func,
    row: ImmutablePropTypes.map,
    tableID: PropTypes.number
};

const mapStateToProps = (state) => ({
    selectedRows: state.selectedRows,
    singleSelectionMode: getSingleSelectionMode(state),
    tableID: state.tableID
});

export default connect(mapStateToProps, {selectRow})(Renderer);
