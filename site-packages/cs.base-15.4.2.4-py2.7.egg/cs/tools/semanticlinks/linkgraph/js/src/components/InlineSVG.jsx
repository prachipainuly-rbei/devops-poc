/*
 * Copyright (C) 2018 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: InlineSVG.jsx 173633 2018-02-22 07:18:07Z ssa $"
 */

import React, {Component} from 'react';
import svgPanZoom from 'svg-pan-zoom';
import {PropTypes} from 'cs-web-components-externals';
import {prefixNS} from '../helpers';

const SVG = (props) => {
    const {svg} = props;
    return <div className={prefixNS('svg')} dangerouslySetInnerHTML={{__html: svg}} />;
};
SVG.propTypes = {
    svg: PropTypes.string.isRequired
};

export default class InlineSVG extends Component {
    constructor(props) {
        super(props);
    }

    componentDidUpdate() {
        const linkgraph = document.getElementById('linkgraph');
        if (linkgraph) {
            svgPanZoom(linkgraph, {dblClickZoomEnabled: false,
                                   minZoom: 0,
                                   maxZoom: 1000,
                                   zoomScaleSensitivity: 0.5});
            const els = linkgraph.querySelectorAll('.node');
            for (let i = 0, length = els.length; i < length; i++) {
                let clickCount = 0;
                els[i].addEventListener('click', () => {
                    clickCount++;
                    if (clickCount === 1) {
                        setTimeout(() => {
                            clickCount = 0;
                            this.props.onClicked(els[i]);
                        }, 400);
                    }
                    else if (clickCount === 2) {
                        clickCount = 0;
                        this.props.onDblClicked(els[i]);
                    }
                }, false);
            }
        }
    }

    render() {
        return (
            <SVG svg={this.props.svg} />
        );
    }
}

InlineSVG.propTypes = {
    svg: PropTypes.string.isRequired,
    onClicked: PropTypes.func.isRequired,
    onDblClicked: PropTypes.func.isRequired
};
