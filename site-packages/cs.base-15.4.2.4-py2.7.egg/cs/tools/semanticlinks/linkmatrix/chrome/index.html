<metal:page use-macro="global_macros['cdb_standard_page_layout']" tal:define="no_title_bar_search True;
																			  body_responsive_class 'cdb-responsive-normal';
																			  favicon string:${options.localres}linkmatrix.ico;
																			  cdbicon 'linkmatrix'">
  <html>
    <tal:header metal:fill-slot="head_block">
      <script src="${options.jscript}jquery/jquery.treeview.min.js" type="text/javascript"></script>
      <script src="${options.plugins}collapsible_blocks/collapsible_blocks.js" type="text/javascript"></script>
      <script src="${options.localres}linkmatrix.js" type="text/javascript"></script>
      <script type="text/javascript">
      var config_object_id = "${config_object_id}";
      var context_object_id = "${context_object_id}";
      var empty_link = "${options.labels['cdb_link_matrix_empty']}";
      </script>

      <link href="${options.localres}jquery.treeview.css" rel="stylesheet" type="text/css"></link>
      <link href="${options.plugins}collapsible_blocks/collapsible_blocks.css" rel="stylesheet" type="text/css"></link>
      <link rel="stylesheet" href="${options.localres}linkmatrix.css" type="text/css"></link>
    </tal:header>

  <body>
    <tal:buttons metal:fill-slot="page_title_buttons">

      <ul class="nav">
        <li class="nav-item"><a href="#" id="save-btn">${options.labels['cdb_link_matrix_save']}</a></li>
        <li class="nav-item"><a href="#" id="reset-btn">${options.labels['cdb_link_matrix_reset']}</a></li>
      </ul>

    </tal:buttons>
    <tal:test metal:fill-slot="page_content">
		<div class="">
			<div class="block-container block-collapsible" data-elink-block-order="1">
				<div
					class="block-content container-fluid collapse in ${'default-expanded' if expanded else nothing}"
					id="sem_link_viz">
					<div id="sem_visualization" class="container-fluid">
						<div class="row-fluid">
							<div class="span8"></div>
							<div class="span4 sem_border sem_object"></div>
						</div>
						<div class="row-fluid">
							<div class="span8"></div>
							<div class="span4">
								<div class="sem_arrow_up"></div>
								<hr class="sem_arrow_up">
							</div>
						</div>
						<div class="row-fluid">
							<div class="span4 sem_border sem_subject"></div>
							<div class="span4">
								<div class="sem_arrow_right"></div>
								<hr class="sem_arrow_right">
							</div>
							<div class="span4 sem_border sem_semantic"></div>
						</div>
					</div>
				</div>
				<div class="block-header">
					<div class="block-action">
					<hr style="margin:0px;">
						<span data-toggle="collapse" data-target="#sem_link_viz"
							class="btn-mini action-button ${'default-expanded' if expanded else nothing} collapsed">
							<i class="icon-chevron-up"
							data-elink-toggle-class1="icon-chevron-up"
							data-elink-toggle-class2="icon-chevron-down"></i>
						</span>
					</div>
					<div class="block-title"></div>
					<ul class="nav pull-right header-dropdown-actions hide">
						<li class="dropdown"><a class="btn btn-small dropdown-toggle"
							data-toggle="dropdown" href="#"> <i class="icon-chevron-down"></i>
						</a></li>
					</ul>
					<div class="bg-line">
						<hr>
					</div>
				</div>
		    </div>
	    </div>
	    <div>
        <div id="matrix_object">
    	    <select>
    	      <div tal:repeat="option object_options" tal:omit-tag="1">
    	          <option selected="selected" data-cls_name="${option.cls_name}" tal:condition="option.cls_name == choosen_relship.column_classname">
    	            ${option.label}
    	          </option>
    	          <option data-cls_name="${option.cls_name}" tal:condition="option.cls_name != choosen_relship.column_classname">
    	            ${option.label}
    	          </option>
    	      </div>
    	      
            </select>
         
		    <form style="display:${column_has_ctx};">
		      <div class="input-prepend pull-left">
		         <input type="text" class="filter_search" placeholder="${options.labels['cdb_link_matrix_search']}" value="">
		      </div>
		    </form>
		    
		  </div>
		
		<div id="matrix_subject">
    	    <select>
    	      <div tal:repeat="option subject_options" tal:omit-tag="1">
    	          <option selected="selected" data-cls_name="${option.cls_name}" tal:condition="option.cls_name == choosen_relship.row_classname">
    	            ${option.label}
    	          </option>
    	          <option data-cls_name="${option.cls_name}" tal:condition="option.cls_name != choosen_relship.row_classname">
    	            ${option.label}
    	          </option>
    	      </div>
            </select>
		    <form style="display:${row_has_ctx};">
		    <div class="input-prepend pull-left">
		      <input type="text" class="filter_search" placeholder="${options.labels['cdb_link_matrix_search']}" value="">
		      </div>
		    </form>
		</div>
    	</div>
	    <div class="matrix_header">
	      <div id="column_container" class="content_scroll">
	        <table id="col_treeview">
	          <tr>
	            <td tal:repeat="col column_start_objects" data-cdb_object_id="${col['object'].cdb_object_id}" data-depth="0" class="header_td">
	            <div class="col_line" data-layer="0"></div>
	            <tal:group tal:condition="col['group']">
	            <div class="col_hitarea collapsed"></div>
	            </tal:group>
	            <tal:group tal:condition="not col['group']">
	            <div class="col_node"></div>
	            </tal:group>
	            
	            <img src="${col['object'].GetObjectIcon()}"></img>
	            <a href="${col['object'].MakeURL()}">${col['object'].GetDescription()}</a></td>
	          </tr>
	        </table>
	      </div>
	    </div>

	    <div id="matrix_content">
	      <div id="row_container" class="left_fixed">
	        <ul id="row_treeview">
	          <li tal:repeat="row row_start_objects" data-cdb_object_id="${row['object'].cdb_object_id}">
	          
	            <img src="${row['object'].GetObjectIcon()}"></img>
	            <a data-cdb_object_id="${row['object'].cdb_object_id}" href="${row['object'].MakeURL()}"> ${row['object'].GetDescription()}</a>
	            <tal:group tal:condition="row['group']">
	              <ul><li>loading...</li></ul>
	            </tal:group>
	            
	          </li>
	        </ul>
	      </div>
	      <div id="table_container" class="content_scroll">
	         <table id="matrix_table" class="table table-bordered matrix_table">
	           <tr tal:repeat="row row_start_objects" data-cdb_object_id="${row['object'].cdb_object_id}">
	             <td tal:repeat="col column_start_objects"
	                 data-cdb_object_id="${col['object'].cdb_object_id}"
	                 class="cell ${'readonly' if links[row['object'].cdb_object_id][col['object'].cdb_object_id]['read_only'] else ''}"
	                 data-readonly="${1 if links[row['object'].cdb_object_id][col['object'].cdb_object_id]['read_only'] else 0}"
	                 data-orig_value="${links[row['object'].cdb_object_id][col['object'].cdb_object_id]['link_name']}"
	                 data-link_object_id="${links[row['object'].cdb_object_id][col['object'].cdb_object_id]['link_object_id']}"
	                 data-link_type_object_id="${links[row['object'].cdb_object_id][col['object'].cdb_object_id]['link_type_object_id']}">
			           <div class="dropdown cell-dropdown">
			             <tal:writeable tal:condition="not links[row['object'].cdb_object_id][col['object'].cdb_object_id]['read_only']">
						   <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">${links[row['object'].cdb_object_id][col['object'].cdb_object_id]['link_name'] or '&nbsp;'}</a>
						 </tal:writeable>
						 <tal:readonly tal:condition="links[row['object'].cdb_object_id][col['object'].cdb_object_id]['read_only']">
						   <span class="readonly">${links[row['object'].cdb_object_id][col['object'].cdb_object_id]['link_name'] or '&nbsp;'}</span>
						 </tal:readonly>
					   </div>
	             </td>
	           </tr>
	         </table>
	      </div>
	    </div>
	
	    <div class="link_types dropdown">
	      <a id="linktypeslink" class="dropdown-toggle" href="#" data-toggle="dropdown"></a>
	        <ul class="dropdown-menu" role="menu" id="link_types">
	     	  <li><a href="javascript:void(0);">(${options.labels['cdb_link_matrix_empty']})</a></li>
	     	  <li class="divider"></li>
	          <li tal:repeat="link_type link_types"><a href="javascript:void(0);" tal:content="link_type.name" data-link_type_object_id="${link_type.cdb_object_id}"></a></li>
	        </ul>
	    </div>
	
	    <div class="modal hide" id="myModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-header">
		  	${options.labels['cdb_link_matrix_search_res']}
		  </div>
		  <div class="modal-body">
		  </div>
		  <div class="modal-footer">
	        <a href="#" class="btn" data-dismiss="modal" aria-hidden="true">${options.labels['cdb_link_matrix_cancel']}</a>
		  </div>
	
		</div>
		
		<div class="modal hide" id="modalDialogNoSearch" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-header">
		  </div>
		  <div class="modal-body">
		  	${options.labels['cdb_link_matrix_no_search_res']}
		  </div>
		  <div class="modal-footer">
		  	<a href="#" type="button" class="btn btn-primary" data-dismiss="modal">OK</a>
		  </div>
	
		</div>
	
		<div id="cell_container" style="display:none"></div>
		<div id="changed_cells_alert" count="0" class="alert" style="display:none"></div>
		<div id="cdb_link_matrix_change_count" style="display:none">${options.labels['cdb_link_matrix_change_count']}</div>
		<div id="overlay" style="width:100%; height:100%; position:fixed; top:0px; left:0px; background-color:#000000; z-index:9999; opacity:0.25; display:none;"></div>
		
    </tal:test>
    
    

  </body>
  </html>
</metal:page>