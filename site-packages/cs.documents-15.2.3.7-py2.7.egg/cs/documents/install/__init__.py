#!/usr/bin/env python
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 2013 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

__revision__ = "$Id: __init__.py 164067 2017-08-28 12:30:25Z heiko $"

from cdb import sqlapi
from cdb import util
from cdb.comparch import protocol


class InitCategCounter(object):

    def run(self):
        # Initialize the cdb_counter for the document categories to the
        # highest value currently in use.
        # The field cdb_doc_categ.categ_id is a char field in the DB -> must
        # convert to int to get the correct max.
        rset = sqlapi.RecordSet2("cdb_doc_categ", columns=["categ_id"])
        if len(rset) > 0:
            max_id = max(int(rec.categ_id) for rec in rset)
            protocol.logMessage("Set counter 'doc_categ_id' to %d" % max_id)
            util.set_min_counter_value('doc_categ_id', max_id)


post = [InitCategCounter]
