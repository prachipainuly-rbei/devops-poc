# -*- mode: python; coding: utf-8 -*-
#
# Copyright (C) 1990 - 2018 CONTACT Software GmbH
# All rights reserved.
# https://www.contact-software.com/

"""
This module contains the `cdb.objects.Object` class for document categories.
"""

__docformat__ = "restructuredtext en"
__revision__ = "$Id: objects.py 178054 2018-05-31 12:52:33Z heiko $"

# Exported objects
__all__ = ["DocumentCategory",
           "WorkflowAssignment",
           "CADDocumentType_FType",
           "DocumentReference",
           "SheetReference",
           "DocumentECN"]

from cdb.objects import Object
from cdb.objects import Reference_1
from cdb.objects import Forward

from cdb import ue

fDocument = Forward("cs.documents.Document")
fDocumentReference = Forward("cs.documents.DocumentReference")
fSheetReference = Forward("cs.documents.SheetReference")
fDocumentECN = Forward("cs.documents.DocumentECN")


class DocumentCategory(Object):

    __maps_to__ = "cdb_doc_categ"

    def ItemReferenceMandatory(self):
        """
        Returns ``True`` if a document of this category has to be
        assigned to an item.
        """
        if self.HasField("item_ref_mandatory"):
            return self.item_ref_mandatory
        return False


class WorkflowAssignment(Object):
    __maps_to__ = "doctype_assign"


class CADDocumentType_FType(Object):
    __maps_to__ = "cdb_cad_categ_ftype"


class DocumentReference(Object):
    __maps_to__ = "cdb_doc_rel"

    ReferencedDocument = Reference_1(fDocument,
                                     fDocumentReference.z_nummer2,
                                     fDocumentReference.z_index2)

    ReferencingDocument = Reference_1(fDocument,
                                      fDocumentReference.z_nummer,
                                      fDocumentReference.z_index)

    def _prevent_interactive_remove(self, ctx):
        """
        The entries in ``cdb_doc_rel`` should only be removed by
        the WSM or other integrations.
        """
        if ctx.interactive and not ctx.active_integration:
            raise ue.Exception("error_cdb_doc_rel_remove_interactive")

    event_map = {("delete", "pre"): "_prevent_interactive_remove"}


class SheetReference(Object):
    __maps_to__ = "cdb_drawing2sheets"
    __classname__ = "cdb_drawing2sheets"

    Sheet = Reference_1(fDocument,
                        fSheetReference.z_nummer2,
                        fSheetReference.z_index2)

    Drawing = Reference_1(fDocument,
                          fSheetReference.z_nummer,
                          fSheetReference.z_index)


class DocumentECN(Object):
    __maps_to__ = "aenderung"
    __classname__ = "aenderung"

    Document = Reference_1(fDocument, fDocumentECN.z_nummer, fDocumentECN.z_index)
