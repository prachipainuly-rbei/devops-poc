#!/usr/bin/env python
# -*- mode: python; coding: iso-8859-1 -*-
#
# Copyright (C) 1990 - 2009 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#
"""Binary helpers"""

__docformat__ = "restructuredtext en"
__revision__ = "$Id: xmlrpc_binary.py 101672 2013-09-05 14:47:53Z js $"

import io
import xmlrpclib


class WithXMLBinary(object):
    @classmethod
    def unwrap_binary(cls, binres, filename):
        assert isinstance(filename, unicode)
        with io.open(filename, "wb") as binfile:
            binfile.write(binres.data)
        return filename

    @classmethod
    def wrap_binary(cls, filename):
        assert isinstance(filename, unicode)
        with io.open(filename, "rb") as binfile:
            binres = xmlrpclib.Binary(binfile.read())
        return binres

if __name__ == "__main__":
    import os
    import sys
    # Change sys.argv to unicode
    sys.argv = [arg.decode("utf-8") for arg in sys.argv]

    if len(sys.argv) == 2:
        FN = sys.argv[1]
        TN = os.path.splitext(FN)[0] + "_copy" + os.path.splitext(FN)[1]
        print FN, TN
        print WithXMLBinary.unwrap_binary(WithXMLBinary.wrap_binary(FN), TN)
