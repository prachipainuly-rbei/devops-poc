#!/usr/bin/env python
# -*- coding: iso-8859-1 -*-
# vim: set fileencoding=utf-8 :
# -*- Python -*-
# $Id: cdbxml_set_defaults.py 173232 2018-02-12 10:33:09Z heiko $
#
# Copyright (C) 1990 - 2003 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#
# File:     cdbxml_set_defaults.ue
# Author:   aki
# Creation: 22.10.08
# Purpose:


from cdb import ue, auth
from cdb.platform.mom import entities

from cs.tools.powerreports import XMLReport, XMLReportParameter


def save_defaults(ctx):
    dlg_attrs = ctx.dialog.get_attribute_names()

    if "cdbxml_source_name" in dlg_attrs and "cdbxml_report_title" in dlg_attrs:
        report = XMLReport.FindByNameAndTitle(ctx.dialog.cdbxml_source_name,
                                              ctx.dialog.cdbxml_report_title)
        if report:
            cdef = None
            if ctx.classname:
                cdef = entities.CDBClassDef(ctx.classname)
            report.ParametersByPersno[auth.persno].Delete()
            for attr in dlg_attrs:
                if attr not in ["cdbxml_source_name", "cdbxml_report_title"]:
                    # Only save args that are not part of the object / class
                    if not cdef.getAttributeDefinition(attr):
                        XMLReportParameter.Create(name=report.name,
                                                  report_title=report.title,
                                                  persno=auth.persno,
                                                  arg_name=attr,
                                                  arg_value=ctx.dialog[attr])

if __name__ == "__main__":
    ue.run(save_defaults, 'cdbmaskaction')
