#!/usr/bin/env python
# -*- python -*- coding: UTF-8 -*-
#
# Copyright (C) 2017 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/

import os

from cdb import testcase

from cs.tools.powerreports import XMLSource


def test_make_schema():
    print "Generating XML schema..",
    try:
        from cs import powerreports_fixture  # require demo data
    except ImportError:
        print "SKIPPED"
        return
    testcase.run_level_setup()

    xml_src = XMLSource.ByKeys("TestReportPersons")
    ctx = MockedContext()
    ctx.sys_args.target_filename = ""
    xml_src.on_cdbxml_make_xsd_now(ctx)
    print "OK"


class MockedContext(object):

    def __init__(self):
        self.sys_args = lambda: None

    def upload_to_client(self, srv_filename, client_filename=None, delete_file_after_upload=1):
        assert os.stat(srv_filename).st_size != 0, "XSD file is empty"
        os.remove(srv_filename)
