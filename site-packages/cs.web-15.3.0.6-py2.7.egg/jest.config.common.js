/*
 * Copyright (C) 2017 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: jest.config.common.js 182690 2018-08-23 08:53:30Z jfi $"
 */

/* eslint-env node */

const fs = require('fs');
const path = require('path');

function getComponentNameSpace() {
    return JSON.parse(fs.readFileSync('namespace.json'));
}

function moduleMappings() {
    const fname = process.env.JEST_MODULE_MAPPINGS;
    const result = JSON.parse(fs.readFileSync(fname));
    result["\\.(jpg|jpeg|png|gif|svg)$"] = path.join(__dirname, "jestAssetsTransformer.js");
    return result;
}

function modulePaths() {
    return [
        process.env.JEST_EXTERNAL_NODE_MODULES
    ];
}

module.exports = {
    "moduleNameMapper": moduleMappings(),
    "modulePaths": modulePaths(),
    roots: [
        "<rootDir>/src/"
    ],
    testMatch: [
        "**/__tests__/**/*.js?(x)"
    ],
    testPathIgnorePatterns: [
        "<rootDir>/.cache/",
        "<rootDir>/build/",
        "<rootDir>/node_modules/"
    ],
    testURL: 'http://localhost/', //https://github.com/jsdom/jsdom/issues/2304
    setupFiles: [
        path.join(__dirname, "setupEnzymeForJest.js")
    ],
    globals: {
        "componentNameSpace": getComponentNameSpace()
    },
    cacheDirectory: "<rootDir>/.jest-cache",
    coverageReporters: ["lcov", "text-summary"],
    collectCoverageFrom: [
        "src/**/*.{js,jsx}"
    ],
    coverageDirectory: "<rootDir>/.coverage"
};
