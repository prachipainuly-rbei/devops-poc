#!/usr/bin/env powerscript
# -*- python -*- coding: utf-8 -*-
#
# Copyright (C) 2017 CONTACT Software GmbH
# All rights reserved.
# http://www.contact-software.com
#

__docformat__ = "restructuredtext en"
__revision__ = "$Id: utils.py 156959 2017-04-12 09:47:34Z mbr $"

from collections import defaultdict
from cdb.platform.mom import getObjectHandlesFromRESTIDs


def get_handles_from_restitems(for_items):
    # First collect favorite entries for the same REST name
    cls2rest_ids = defaultdict(list)
    for item in for_items:
        cls2rest_ids[item.rest_name].append(item.rest_id)
    # For each REST name, collect object handles with one call. Make sure to
    # retrieve only those items that the user has access to.
    all_handles = {}
    for rest_name, rest_ids in cls2rest_ids.iteritems():
        if rest_name:
            all_handles[rest_name] = getObjectHandlesFromRESTIDs(rest_name,
                                                                 rest_ids,
                                                                 check_access=True)
    # Collect results in the order of the items given as input. For entries
    # where the target object could not be found (either deleted, or no rights)
    # a None value is returned.
    return [all_handles[item.rest_name].get(item.rest_id) if item.rest_name else None
            for item in for_items]
