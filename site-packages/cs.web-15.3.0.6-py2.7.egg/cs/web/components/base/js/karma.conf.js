/*
 * Copyright (C) 1990-2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: karma.conf.js 138467 2016-03-15 08:01:26Z cla $"
 */

var webpack = require('webpack');
var path = require('path');

module.exports = function (config) {
    config.set({

        browsers: [process.env.CONTINUOUS_INTEGRATION ? 'Firefox' : 'Chrome'],

        singleRun: true,

        frameworks: ['mocha'],

        files: [
            'C:/src/svn-src/cdb/trunk/cdb/python/cs/platform/web/static/resources/react/v0_14_7/react-with-addons.js',
            'C:/src/svn-src/cdb/trunk/cdb/python/cs/platform/web/static/resources/react_bootstrap/v0_28_3/react-bootstrap.js',
            '../../externals/js/build/cs-web-components-externals.js',
            'tests.webpack.js'
        ],

        preprocessors: {
            'tests.webpack.js': ['webpack', 'sourcemap', 'coverage'],
        },

        reporters: ['dots', 'coverage'],

        webpack: {
            devtool: 'inline-source-map',
            module: {
                loaders: [
                    {
                        test: /\.(js|jsx)$/,
                        exclude: /(node_modules|bower_components)/,
                        loader: 'babel',
                        query: {
                            presets: ['es2015', 'react', 'stage-2']
                        }
                    },
                    {test: /\.css$/, loader: "style-loader!css-loader"},
                    //{ test: /\.jsx$/, loader:'jsx-loader' }
                    {test: /\.json$/, loader: "json-loader"},
                    {test: /\.png(\?v=\d+\.\d+\.\d+)?$/, loader: "url-loader?limit=10000"},
                    {test: /\.svg(\?v=\d+\.\d+\.\d+)?$/, loader: "url?limit=10000&minetype=image/svg+xml"}
                ]
            },

            externals: {
                //"jquery": "jQuery",
                //"bootstrap": "bootstrap",
                "react": "React",
                //"react-dom": "ReactDOM",
                "react-bootstrap": "ReactBootstrap",
                //"immutable": "Immutable",
                //"underscore": "_",
                "cs-web-components-externals": "cs-web-components-externals",
                //"cs-web-components-base": "cs-web-components-base"
            },
            resolve: {
                extensions: ['', '.js', '.jsx'],
            }
        },
//    plugins: [
//        require('karma-babel-preprocessor'),
//        require("karma-webpack"),
//        require("karma-coverage"),
//        require("karma-mocha"),
//        //require("karma-jasmine"),
//        require("karma-chrome-launcher"),
////          //require("karma-phantomjs-launcher"),
//        require("karma-sourcemap-loader")
//      ],

        webpackServer: {
            noInfo: true
        }

    });
};
