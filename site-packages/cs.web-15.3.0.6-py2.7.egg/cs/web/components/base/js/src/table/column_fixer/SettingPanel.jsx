/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: SettingPanel.jsx 184479 2018-09-27 08:27:18Z mbr $"
 */

import React from 'react';
import {PropTypes} from 'cs-web-components-externals';
import {prefixNS} from '../../helpers';
import {setFixedColumns, setTableUserSettings} from '../common/actions';
import {formatStr} from '../../i18n';
import connect from '../connect';
import HelpReference from '../../components/HelpReference.jsx';
import Spinner from '../../formcontrols/Spinner';

export class FixerSettingPanel extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            fixedColumns: props.fixedColumns
        };
        this.setFixedColumns = this.setFixedColumns.bind(this);
    }

    componentDidMount() {
        this.props.registerPanel(this);
        this.props.setTableUserSettings('fixedColumns');
    }

    componentWillReceiveProps(nextProps) {
        if (this.props.fixedColumns !== nextProps.fixedColumns) {
            this.setState({fixedColumns: nextProps.fixedColumns});
        }
    }

    dispatchSettings() {
        if (this.props.fixedColumns !== this.state.fixedColumns) {
            this.props.setFixedColumns(this.state.fixedColumns);
        }
    }

    resetSettings() {
        this.setState({fixedColumns: this.props.fixedColumns});
    }

    setFixedColumns(value) {
        this.setState({fixedColumns: value});
    }

    render() {
        return (
            <div>
                <HelpReference helpId="user_web_components_table_hide_columns" />
                <Spinner name={prefixNS('table-fixed-columns')}
                         label={formatStr("table_fixed_columns")}
                         decimalPlaces={0}
                         minValue={0}
                         maxValue={100}
                         value={this.state.fixedColumns}
                         onValueChange={this.setFixedColumns}/>
            </div>
        );
    }
}

FixerSettingPanel.propTypes = {
    fixedColumns: PropTypes.number,
    setFixedColumns: PropTypes.func,
    setTableUserSettings: PropTypes.func,
    registerPanel: PropTypes.func
};

const mapStateToProps = (state) => ({
    fixedColumns: state.fixedColumns
});

const WrappedPanel = connect(mapStateToProps,
    {setFixedColumns, setTableUserSettings})(FixerSettingPanel);
WrappedPanel.settingsTitle = () => formatStr('table_settings_title_column_fixer');
export default WrappedPanel;
