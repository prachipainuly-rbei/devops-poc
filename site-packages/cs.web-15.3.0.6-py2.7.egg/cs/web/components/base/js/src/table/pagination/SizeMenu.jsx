/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: SizeMenu.jsx 161882 2017-07-19 10:14:34Z bwf $"
 */

import React from 'react';
import {DropdownButton, MenuItem} from 'react-bootstrap';
import {PropTypes, ImmutablePropTypes} from 'cs-web-components-externals';
import {formatStr} from '../../i18n';
import {prefixNS} from '../../helpers';
import {setPageSize} from './actions';
import {getPageSizeOptions, getPageSize} from './reducers';
import connect from '../connect';
import ButtonGroup from '../../components/ButtonGroup.jsx';

let COUNTER = 0;

/**
 * Combobox that allows to select the number of entries
 * displayed per page.
 *
 * @private
 */
export class SizeMenu extends React.Component {
    constructor(props) {
        super(props);
        this.onSelect = this.onSelect.bind(this);
    }

    onSelect(size) {
        const {setPageSize} = this.props;
        setPageSize(size);
    }

    render() {
        const {pageSize, pageSizeOptions} = this.props;
        return (
            pageSizeOptions.count() ? (
                <ButtonGroup className={prefixNS('table-pagination-size-menu')}>
                    <DropdownButton
                        id={prefixNS('table-pagination-size-menu' + (++COUNTER))}
                        title={formatStr('table_paginator_items_per_page',
                               {items: pageSize})}>
                        {pageSizeOptions.map(pageSize => (
                            <MenuItem key={String(pageSize)}
                                      eventKey={pageSize}
                                      onSelect={this.onSelect}>
                                {pageSize}
                            </MenuItem>))}
                    </DropdownButton>
                </ButtonGroup>
            ) : null
        );
    }
}

SizeMenu.propTypes = {
    setPageSize: PropTypes.func,
    pageSize: PropTypes.number,
    pageSizeOptions: ImmutablePropTypes.set
};

const mapStateToProps = (state) => ({
    pageSize: getPageSize(state),
    pageSizeOptions: getPageSizeOptions(state)
});

export default connect(mapStateToProps, {setPageSize})(SizeMenu);
