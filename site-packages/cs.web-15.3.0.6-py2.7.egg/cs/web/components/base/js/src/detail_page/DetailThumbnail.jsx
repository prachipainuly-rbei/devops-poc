/*
 * Copyright (C) 2017 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: DetailThumbnail.jsx 172991 2018-02-06 15:37:15Z vov $"
 */

import React from 'react';
import {PropTypes, ImmutablePropTypes} from 'cs-web-components-externals';
import Thumbnail from '../components/Thumbnail.jsx';
import {getJSON} from '../fetch.js';

export default class DetailThumbnail extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            imageURL: null,
            iconURL: null
        };
    }

    componentDidMount() {
        this.getURL(this.props);
    }

    componentWillReceiveProps(nextProps) {
        if (this.props.contextObject !== nextProps.contextObject) {
            this.getURL(nextProps);
        }
    }

    getURL(props) {
        const {contextObject} = props;
        if (contextObject) {
            const url = contextObject.get('@id') + '/file';
            getJSON(url, {kind: 'thumbnail'}).then(
                result => {
                    this.setState({
                        imageURL: result ? result.url : null,
                        iconURL: contextObject.get('system:icon_link')
                    });
                }
            );
        }
    }

    render() {
        const {size} = this.props;
        const {imageURL, iconURL} = this.state;
        return (
            <Thumbnail
                size={size}
                imgSrc={imageURL}
                fallbackSrc={iconURL}/>
        );
    }
}
DetailThumbnail.propTypes = {
    contextObject: ImmutablePropTypes.map.isRequired,
    size: PropTypes.string
};
