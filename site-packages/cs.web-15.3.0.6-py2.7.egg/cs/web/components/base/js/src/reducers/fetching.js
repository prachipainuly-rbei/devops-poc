/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: fetching.js 150654 2016-12-09 16:29:23Z heiko $"
 */

/**
  * This module  provides meta entities, such as
  * :ref:`cs-web-components-base-reducers.fetching.errorsById`,
  * that stores failed requests and
  * :ref:`cs-web-components-base-reducers.fetching.fetchingById`,
  * which stores pending requests.
  *
  * @module
  */

import {
    FETCHING_URL,
    FETCH_OK,
    FETCH_ERROR
} from '../actions/fetching.js';
import Immutable from 'immutable';

/**
 * Stores the Promise associated with a pending requests
 * by the request URL. Completed or failed requests will
 * be removed from this store.
 */
export function fetchingById(state = Immutable.Map(), action) {
    switch (action.type) {
        case FETCHING_URL:
            return state.set(action.meta.url, action.meta.promise);
        case FETCH_OK:
        case FETCH_ERROR:
            return state.delete(action.meta.url);
        default:
            return state;
    }
}

/**
 * Stores errors that occured during communication with the REST API by
 * the REST URL used.
 */
export function errorsById(state = Immutable.Map(), action) {
    switch (action.type) {
        case FETCH_OK:
        case FETCHING_URL:
            return state.delete(action.meta.url);
        case FETCH_ERROR:
            return action.error ? state.set(action.meta.url, action.payload) : state;
        default:
            return state;
    }
}
