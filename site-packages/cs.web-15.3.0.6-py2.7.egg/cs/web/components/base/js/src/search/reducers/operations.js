/*
 * Copyright (C) 2017 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: operations.js 174759 2018-03-20 14:31:14Z gwe $"
 */

import Immutable from 'immutable';
import {ACTIONS} from '../constants.js';
import {extractAttributesFromSearchOperation} from './util.js';

function loadSettings(opInfo, opData) {
    const data = Immutable.fromJS({opInfo, opData});
    return data.merge(extractAttributesFromSearchOperation(
        data.getIn(['opData', 'registers']),
        data.getIn(['opData', 'values'])));
}

export function operationByClass(state = Immutable.Map(), action) {
    switch (action.type) {
        case ACTIONS.SEARCH_OP_LOADED: {
            const {classname, opInfo, opData} = action.payload;
            return state.set(classname, loadSettings(opInfo, opData));
        }
        case ACTIONS.SEARCH_OP_LOAD_ERROR: {
            const {classname, error} = action.payload;
            return state.set(classname, Immutable.fromJS({classname, error}));
        }
        default:
            return state;
    }
}
