/* -*- mode: web; coding: utf-8 -*-
 * Copyright (C) 1990-2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: actions.js 162141 2017-07-25 11:11:08Z gwe $"
 */

import {getJSON, putJSON, postJSON, deleteObject} from '../fetch.js';
import Immutable from 'immutable';

export const FAVORITE_DELETE = `${componentNameSpace}-FAVORITE_DELETE`;
export const FAVORITE_UPDATE = `${componentNameSpace}-FAVORITE_UPDATE`;
export const FAVORITE_INIT = `${componentNameSpace}-FAVORITE_INIT`;
export const FAVORITE_ADD = `${componentNameSpace}-FAVORITE_ADD`;

function favoriteDeleted(favorite) {
    return {
        type: FAVORITE_DELETE,
        favorite: favorite
    };
}

function favoriteUpdated(favorite) {
    return {
        type: FAVORITE_UPDATE,
        favorite: favorite
    };
}

function favoriteAdded(favorite) {
    return {
        type: FAVORITE_ADD,
        favorite: favorite
    };
}

function favoritesInitialized(favorites) {
    return {
        type: FAVORITE_INIT,
        favorites: favorites
    };
}

export function deleteFavorite(favorite) {
    return (dispatch) => {
        return deleteObject(favorite.get('@id'))
            .then(() => dispatch(favoriteDeleted(favorite)));
    };
}

export function updateFavorite(favorite, newTitle) {
    const newFavorite = favorite.set('title', newTitle);
    return (dispatch) => {
        return putJSON(favorite.get('@id'), newFavorite.toJS())
            .then(() => dispatch(favoriteUpdated(Immutable.fromJS(newFavorite))));
    };
}

export function addFavorite(favorite) {
    return (dispatch) => {
        return postJSON("/internal/favorites/", favorite.toJS())
            .then(result => dispatch(favoriteAdded(Immutable.fromJS(result))));
    };
}

export function initFavorites() {
    return (dispatch) => {
        return getJSON("/internal/favorites/")
            .then(info => dispatch(favoritesInitialized(Immutable.fromJS(info.favorites))));
    };
}
