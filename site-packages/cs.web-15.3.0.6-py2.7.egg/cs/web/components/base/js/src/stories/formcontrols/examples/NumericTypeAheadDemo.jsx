/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: NumericTypeAheadDemo.jsx 170262 2017-12-08 15:02:29Z yzh $"
 */

import React from 'react';
import {FormControl, DataType} from 'cs-web-components-base';
import Immutable from 'immutable';

const NumericTypeAhead = FormControl.WithTypeAhead(FormControl.NumericEdit);
const valueList = Immutable.List(['0.123', '1.234', '2.345', '3.456', '4.567', '5.678', '6.789']);
// format the values corresponding to current language
const itemList = valueList.map(v => (new DataType.NumberType(v)).format(3));

export default class NumericTypeAheadDemo extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            value: null,
            matches: Immutable.List()
        };
        this.onValueChange = this.onValueChange.bind(this);
        this.onChange = this.onChange.bind(this);
        this.onSelectAt = this.onSelectAt.bind(this);
    }

    onChange(event) {
        const value = event.target.value;
        this.setState({
            matches: this.matchValues(value)
        });
    }

    onValueChange(value) {
        this.setState({
            value: value
        });
    }

    onSelectAt(idx) {
        const hit = this.state.matches.get(idx);
        const oriIdx = itemList.indexOf(hit);
        this.setState({
            value: valueList.get(oriIdx),
            matches: this.matchValues(hit)
        });
    }

    matchValues(value) {
        return itemList.filter(
            item => value !== '' && item.indexOf(value) > -1);
    }

    render() {
        return (
            <NumericTypeAhead
                name="NumericTypeAheadDemo"
                decimalPlaces={3}
                value={this.state.value}
                matched={this.state.matches}
                onChange={this.onChange}
                onValueChange={this.onValueChange}
                onSelectAt={this.onSelectAt}
                typeAheadDropdownClass="div"
                placeholder="Inputing will open a list for typing ahead"
            />
        );
    }
}
