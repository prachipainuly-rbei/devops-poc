/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: TextViewer.jsx 158306 2017-05-08 08:29:40Z gwe $"
 */

import React from 'react';
import {PropTypes} from 'cs-web-components-externals';
import {fetchAndCheck} from '../../fetch.js';
import {prefixNS} from '../../helpers.js';
import ContentBlock from '../ContentBlock.jsx';

export default class TextViewer extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            fileContent: null
        };
    }

    componentDidMount() {
        this.retrieveFile(this.props);
    }

    componentWillReceiveProps(nextProps) {
        if (this.props.url !== nextProps.url) {
            this.retrieveFile(nextProps);
        }
    }

    retrieveFile(props) {
        fetchAndCheck(props.url)
        .then(response => response.text())
        .then(txt => {
            this.setState({fileContent: txt});
        });
    }

    render() {
        return (
            <ContentBlock
                    collapsible={false}
                    expanded={true}
                    title={this.props.filename}
                    className={prefixNS('text-viewer')}>
                <ContentBlock.Body>
                    <textarea readOnly value={this.state.fileContent} />
                </ContentBlock.Body>
            </ContentBlock>
        );
    }
}
TextViewer.propTypes = {
    url: PropTypes.string.isRequired,
    filename: PropTypes.string.isRequired
};
