/*
 * Copyright (C) 2017 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: OperationDeleteDialog.jsx 183683 2018-09-11 12:37:14Z cla $"
 */

import React from 'react';
import {WithOperationHandler} from '../form/containers/OperationHandler.jsx';
import Dialog from '../dialogs';
import {formatStr} from '../i18n.js';
import {PropTypes} from 'cs-web-components-externals';

export function OperationDeleteDialog(props) {
    const {operationState, onCancel, onSubmit} = props;

    if (!operationState.get('displayForm')) {
        return null;
    }

    let deleteText = undefined;
    const objects = operationState.getIn(['params', 'contextObjects']);
    const relshipCtx = operationState.getIn(['info', 'relship_context']);
    if (objects.size === 1) {
        const object = objects.get(0);
        deleteText = formatStr(relshipCtx ?
                               'relship_delete_text' :
                               'detail_delete_text',
                               {object: object.get('system:description')});
    } else {
        deleteText = formatStr(relshipCtx ?
                               'relship_delete_multiple_txt' :
                               'detail_delete_multiple_txt');
    }

    const currentOpLabel = operationState.getIn(['info', 'label']);
    return (
        <Dialog.Alert title={currentOpLabel}
                      ActionButton={<Dialog.Buttons.Delete/>}
                      onConfirm={onSubmit}
                      onHide={onCancel}>
            {deleteText}
            {
                objects === undefined || objects.size === 1 ? null : (
                    <p style={{textAlign: 'left'}}>
                        <ul>
                            {objects.map(obj => (
                                 <li key={obj.get('@id')}>
                                     {obj.get('system:description')}
                                 </li>
                             ))}
                        </ul>
                    </p>
                )
            }
        </Dialog.Alert>
    );
}

OperationDeleteDialog.propTypes = {
    // General OperationHandler-Properties
    operationState: PropTypes.object.isRequired,
    onSubmit: PropTypes.func.isRequired,
    onCancel: PropTypes.func.isRequired,
};

/**
 * A specialized OperationHandler that displays an Alert-dialog to query deletion of
 * an object.
 *
 * @class OperationDeleteDialog
 * @extends React.Component
 */
export default WithOperationHandler(OperationDeleteDialog, "delete");
