/*
 * Copyright (C) 2017 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: Data.js 160452 2017-06-18 14:57:46Z sla $"
 */

/* global d3 */

// This uses the offical CONTACT color palette!
export const predefinedData = [
    {label: "Analyse", color: "#2E97CF"},
    {label: "Dokumentation", color: "#BBD230"},
    {label: "Implementierung", color: "#FCC52E"},
    {label: "QualitÃ¤tssicherung", color: "#F87930"},
    {label: "Spezifikation", color: "#D82E2E"}
];

let id = 0;

export function getIDPostix() {
    return ++id;
}

function calcRelativeValue(value, data) {
    return Math.round((100 * (value.value / d3.sum(data.map((v) => v.value)))) * 10) / 10;
}

export function drawLegend(id, data) {
    const legend = d3.select(id).append("table");
    legend.attr('style', 'display: inline-block;margin-top: 75px;vertical-align: top;');

    const tbody = legend.append("tbody");
    data.forEach((entry) => {
        const tr = tbody.append("tr");

        tr.append("td").append("svg").attr("width", '16').attr("height", '16').append("rect")
            .attr("width", '16').attr("height", '16')
            .attr("fill", entry.color);
        tr.append("td").text(entry.label).attr('style', 'padding-left: 10px; padding-right: 10px;');
        tr.append("td").text(String(Math.trunc(entry.value)))
            .attr('style', 'padding-left: 10px; padding-right: 5px;');
        tr.append("td").text("PT").attr('style', 'padding-left: 4px; padding-right: 10px;');
        tr.append("td").text(calcRelativeValue(entry, data))
            .attr('style', 'padding-left: 10px; padding-right: 5px;');
        tr.append("td").text("%").attr('style', 'padding-left: 2px; padding-right: 4px;');
    });
}
