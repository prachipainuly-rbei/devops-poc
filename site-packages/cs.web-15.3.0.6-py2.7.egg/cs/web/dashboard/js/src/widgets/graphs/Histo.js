/*
 * Copyright (C) 2017 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: Histo.js 160452 2017-06-18 14:57:46Z sla $"
 */

/* global d3 */

import {drawLegend} from './Data';

export function displayHistogram(id, data, container_id) {

    const hGDim = {t: 20, r: 0, b: 15, l: 15};
    hGDim.w = 300 - hGDim.l - hGDim.r;
    hGDim.h = 300 - hGDim.t - hGDim.b;

    const histogram = d3.select('#' + id).append("g");

    const x = d3.scale.ordinal().rangeRoundBands([0, hGDim.w], 0.1)
            .domain(data.map((entry) => entry.label.substring(0, 3)));

    histogram.append("g").attr("class", "x axis")
        .attr("transform", "translate(0," + hGDim.h + ")")
        .call(d3.svg.axis().scale(x).orient("bottom"));

    const y = d3.scale.linear().range([hGDim.h, 0])
            .domain([0, d3.max(data, (entry) => entry.value)]);

    const bars = histogram.selectAll(".bar").data(data).enter().append("g");

    bars.append("rect")
        .attr("x", function(entry) { return x(entry.label.substring(0, 3)) })
        .attr("y", function(entry) { return y(entry.value) })
        .attr("width", x.rangeBand())
        .attr("height", function(entry) { return hGDim.h - y(entry.value) })
        .attr('fill', (entry) => entry.color);

    drawLegend("#" + container_id, data);
}
