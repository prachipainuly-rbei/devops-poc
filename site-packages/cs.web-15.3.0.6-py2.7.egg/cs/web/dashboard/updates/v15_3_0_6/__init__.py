#!/usr/bin/env powerscript
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 2016 CONTACT Software GmbH
# All rights reserved.
# http://www.contact-software.com
#

__revision__ = "$Id: __init__.py 185829 2018-10-29 15:15:13Z sla $"

from cdb import sqlapi
from cs.web.dashboard import Dashboard


class CreateDashboardPositions(object):
    """
    Enumerate the dashboard positions for all users.
    The default dashboard gets position_index 0, all other
    dashboard position are just incremented.
    """
    def run(self):
        owners = sqlapi.SQLselect("DISTINCT owner FROM csweb_dashboard")

        for idx in range(sqlapi.SQLrows(owners)):
            next_position = 1
            dashboards = Dashboard.KeywordQuery(owner=owners.get_string("owner", idx)).Execute()
            for db in dashboards:
                if db.is_default:
                    db.position_index = 0
                else:
                    db.position_index = next_position
                    next_position += 1


pre = []
post = [CreateDashboardPositions]
