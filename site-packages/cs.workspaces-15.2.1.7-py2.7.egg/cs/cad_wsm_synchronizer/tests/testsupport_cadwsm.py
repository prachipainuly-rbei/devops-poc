#!/usr/bin/env python
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 1990 - 2013 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

from contextlib import contextmanager
from cdb import cad


@contextmanager
def patchedGetCADConfValue(pname, pcad_system, pval):
    oldGetCADConfValue = patchGetCADConfValue(pname, pcad_system, pval)
    yield
    unpatchGetCADConfValue(oldGetCADConfValue)


def patchGetCADConfValue(pname, pcad_system, pval):
    oldGetCADConfValue = cad.getCADConfValue

    def newGetCADConfValue(name, cad_system):
        if name == pname and cad_system.startswith(pcad_system):
            return pval
        else:
            return oldGetCADConfValue(name, cad_system)

    cad.getCADConfValue = newGetCADConfValue
    return oldGetCADConfValue


def unpatchGetCADConfValue(oldFun):
    cad.getCADConfValue = oldFun
