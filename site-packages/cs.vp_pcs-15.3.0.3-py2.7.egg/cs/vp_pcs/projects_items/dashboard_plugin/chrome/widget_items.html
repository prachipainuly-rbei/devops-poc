<metal:widget define-macro="collapsible_widget"
              tal:define="macrofile getattr(plugin, '__plugin_macro_file__', 'macros.html');
                          pluginmacros plugin.getTemplate(macrofile).macros;
                          kosmodromtools kosmodromtools|plugin.kosmodromtools;
                          dashboard_widget plugin.dashboard_widget">
  <tal:layout
    metal:use-macro="global_plugins['collapsible_blocks'].macros['collapsible_block_container']"
    define="block_id string:detail_items;
            block_order detail_widget_order;
            block_expanded widget_expanded;
            widget_data dashboard_widget.get_data(project.cdb_project_id)['widget_data']">
    <metal:filltitle fill-slot="block_title">
      <h2><metal:title use-macro="pluginmacros.widget_title" /></h2>
    </metal:filltitle>
    <metal:content fill-slot="block_content">
      <metal:using use-macro="pluginmacros.widget_filters" />
      <metal:using use-macro="pluginmacros.widget_content" />
    </metal:content>
  </tal:layout>
</metal:widget>

<metal:title define-macro="widget_title">
<i class="cdb-icon-article"></i>
${options.labels['parts']}&nbsp;(${options.labels.cdbpcs_elink_filtered_count % widget_data['filtered_counter']})
</metal:title>

<metal:filters define-macro="widget_filters">
<div class="kosmodrom-detail-filters" data-elink-kosmodrom-detail-target="filters">
  <div class="btn-group pull-left" data-toggle="buttons-checkbox">
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
               tal:define="filtername 'filter_mine';
                           cnt widget_data['all_counters'][filtername]|0;
                           filtertitle options.labels.cdbpcs_elink_my_items">
      <metal:cnt fill-slot="filter_content">
      <img src="${options.getIcon('cdb_person')}" />&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
  </div>
  <div class="btn-group pull-left" data-toggle="buttons-checkbox">
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
            tal:define="filtername 'filter_recently_created';
                        cnt widget_data['all_counters'][filtername]|0;
                        filtertitle options.labels.cdbpcs_elink_tooltip_recently_created % dashboard_widget.get_recent_days()">
      <metal:cnt fill-slot="filter_content">
      ${options.labels.cdbpcs_elink_filter_new}&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
  </div>
  <div class="btn-group pull-left" data-toggle="buttons-checkbox">
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
               tal:define="filtername 'filter_released';
                           cnt widget_data['all_counters'][filtername]|0;
                           filtertitle options.labels.cdbpcs_elink_filter_released">
      <metal:cnt fill-slot="filter_content">
      ${options.labels.cdbpcs_elink_filter_released}&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
               tal:define="filtername 'filter_not_released';
                           cnt widget_data['all_counters'][filtername]|0;
                           filtertitle options.labels.cdbpcs_elink_not_released">
      <metal:cnt fill-slot="filter_content">
      ${options.labels.cdbpcs_elink_filter_not_released}&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
  </div>
  <div class="no-float"></div>
</div>
</metal:filters>

<metal:widgetcontent define-macro="widget_content">
<div id="projectdetail-docs" class="kosmodrom-detail-object-list"
     data-elink-kosmodrom-detail-widget="item">
  <tal:objs tal:repeat="obj widget_data['objects']">
    <metal:show use-macro="kosmodromtools.templates()['layout.html'].macros['object_info']"
                tal:define="responsible_field 'mapped_cpersno_name';
                            deadline_field 'cdb_cdate';
                            deadline_label options.labels.cdbpcs_elink_created_at">
    </metal:show>
  </tal:objs>
  <metal:pg use-macro="global_plugins['pagination'].macros.paginator"
            tal:define="paginator widget_data['paginator']"/>
</div>
</metal:widgetcontent>
