#!/usr/bin/env powerscript
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 1990 - 2013 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/

from cdb import sqlapi


class DataMigrations(object):
    def run(self):
        self.upd_kosmodrom_missing_rules()

    def upd_kosmodrom_missing_rules(self):

        #items
        module_id = u'cs.vp_pcs.projects_items'
        #terms
        sqlstr = "into cdb_pyterm (name, fqpyname, predicate_name, attribute, operator, expression, filter_rule, id, cdb_module_id) " + \
                 "values('%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s')"

        name = u'cdbpcs: Kosmodrom: Released Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.vp.items.Item',
                    u'cdbpcs: Kosmodrom: Released Items', u'status', u'IN', u'200,300,400', u'', u'1', module_id))

        name = u'cdbpcs: Kosmodrom: Active Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.vp.items.Item',
                    u'cdbpcs: Kosmodrom: Active Items', u'status', u'!=', u'180', u'', u'1', module_id))

        name = u'cdbpcs: Kosmodrom: Objects Recently Created'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.vp.items.Item',
                    u'cdbpcs: Kosmodrom: Recently Created Items', u'cdb_cdate', u'>=', u'$(start_date)', u'', u'1', module_id))

        name = u'cdbpcs: Kosmodrom: My Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.vp.items.Item',
                    u'cdbpcs: Kosmodrom: My Items', u'cdb_cpersno', u'=', u'$(persno)', u'', u'1', module_id))

        #predicates
        sqlstr = "into cdb_pypredicate (name, fqpyname, predicate_name, description, cdb_module_id) " + \
                 "values('%s', '%s', '%s', '%s', '%s')"

        name = u'cdbpcs: Kosmodrom: Objects Recently Created'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.vp.items.Item', u'cdbpcs: Kosmodrom: Recently Created Items', u'', module_id))

        name = u'cdbpcs: Kosmodrom: My Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.vp.items.Item', u'cdbpcs: Kosmodrom: My Items', u'', module_id))

        name = u'cdbpcs: Kosmodrom: Released Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.vp.items.Item', u'cdbpcs: Kosmodrom: Released Items', u'', module_id))

        name = u'cdbpcs: Kosmodrom: Active Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.vp.items.Item', u'cdbpcs: Kosmodrom: Active Items', u'', module_id))

    # ----------------------------------------------------------

pre = []
post = [DataMigrations]
