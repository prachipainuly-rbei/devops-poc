# !/usr/bin/env python
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 1990 - 2012 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#
from cs.launchpad import App
from cdb.elink import DummyRequest, ELINK_ENCODING
from cdb.validationkit import when, then
import steps


def init_app(App):
    req = DummyRequest("")
    req.charset = ELINK_ENCODING
    app = App()
    app.handle_request(req)
    return app


# -------------------------------------------------------------
# Scenario: Register launchpad plugin
#
# -------------------------------------------------------------
@when("^a plugin is imported and registered$")
def step(context):
    import steps.launchpad_plugin


@then("^this plugin will be displayed in the launchpad$")
def step(context):
    categories = init_app(App).get_categories()
    app = steps.launchpad_plugin.app
    assert app is not None and app in categories, \
        "Expected the imported plugin to be registered"
