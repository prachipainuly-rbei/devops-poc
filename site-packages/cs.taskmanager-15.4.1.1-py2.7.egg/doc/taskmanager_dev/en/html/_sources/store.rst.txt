.. _`cs-tasks-store`:

Redux Store
===================================================================================================

``cs.taskmanager`` uses a Redux store to keep its application state. When running, it will reside
under the ``cs-taskmanager-web-reducer`` key of the global store.

To help you debug your configuration and/or custom plugins, the ``DebugInfo`` component shows you
the store ``cs-taskmanager-web-reducer`` when hovering over its area. This component is also used
in automated frontend tests to determine outstanding asynchronous actions and the number of
currently loaded tasks (since they are not always represented by DOM elements due to performance
optimization).

.. note::

    The ``DebugInfo`` component will only be visible if activated for the logged in user.

The debug mode is controlled by the class ``cs.taskmanager.settings.DebugMode``:

.. autoclass:: cs.taskmanager.settings.DebugMode

The following sections describe some of the store's more important contents in detail.

.. _`cs-tasks-store-settings`:

settings
---------------------------------------------------------------------------------------------------

+-----------------------+-----------------------------------------------------------------------------------+
| Key                   | Description                                                                       |
+=======================+===================================================================================+
| *-pane                | User settings for details and file info panes                                     |
+-----------------------+-----------------------------------------------------------------------------------+
| userSelection         | If ``true``, the current user may display tasks for other users                   |
+-----------------------+-----------------------------------------------------------------------------------+
| contextClassnames     | Filterable context classes. Represent all entries of class ``cs_tasks_context``   |
+-----------------------+-----------------------------------------------------------------------------------+
| taskClasses           | All classes that have a corresponding ``cs_tasks_class`` entry                    |
+-----------------------+-----------------------------------------------------------------------------------+
| userViews             | The current state of user views, filters and table settings                       |
+-----------------------+-----------------------------------------------------------------------------------+
| notificationInterval  | Interval in milliseconds, after which a check for new/removed tasks is made       |
+-----------------------+-----------------------------------------------------------------------------------+

The backend persists most of this data, see :ref:`cs-tasks-settings` and :ref:`cs-tasks-defaults`.

.. _`cs-tasks-store-table`:

table
---------------------------------------------------------------------------------------------------

Contains standard cs.web table data. Some additional attributes are added to each entry in the
``rows`` List:

+------------------------+--------------------------------------------------------------------------------------------------+
| Key                    | Description                                                                                      |
+========================+==================================================================================================+
| className              | Additional CSS class names (most notably the task's read status)                                 |
+------------------------+--------------------------------------------------------------------------------------------------+
| @plugin_discriminators | List of identifiers for custom plugins                                                           |
+------------------------+--------------------------------------------------------------------------------------------------+
| read_status            | Number representing the read status of the task. A ``0`` stands for "unread", a ``1`` for "read" |
+------------------------+--------------------------------------------------------------------------------------------------+
| activities_context     | @id of the activity channel to use                                                               |
+------------------------+--------------------------------------------------------------------------------------------------+

.. _`cs-tasks-store-delta`:

delta
---------------------------------------------------------------------------------------------------

Keeps delta between tasks in backend and frontend. This data is updated whenever the frontend
checks for updates, querying the backend for all task ids currently relevant for the selected user.

+-------------------+-------------------------------------------------------------------------------------------------------------+
| Key               | Description                                                                                                 |
+===================+=============================================================================================================+
| newTasks          | List of ``cdb_object_ids`` of tasks included in last check that are currently not shown in the tasks table  |
+-------------------+-------------------------------------------------------------------------------------------------------------+
| missingTasks      | List of ``cdb_object_ids`` of tasks currently shown in the tasks table that were not part of the last check |
+-------------------+-------------------------------------------------------------------------------------------------------------+
| temporaryTasks    | List of ``cdb_object_ids`` of tasks currently shown striked-through. When updating task data, tasks that    |
|                   | were externally removed from the task pool (for example by changing their status), these tasks will be      |
|                   | shown striked-through until the next update                                                                 |
+-------------------+-------------------------------------------------------------------------------------------------------------+
| proceeding        | List of ``cdb_object_ids`` the user just changed the status of. If one of these are not part of the next    |
|                   | update, they will be removed instead of shown striked-through                                               |
+-------------------+-------------------------------------------------------------------------------------------------------------+

.. _`cs-tasks-store-selection`:

currentSelection
---------------------------------------------------------------------------------------------------

+-------------------+---------------------------------------------------------------------------------------------------+
| Key               | Description                                                                                       |
+===================+===================================================================================================+
| task_object_id    | ``cdb_object_id`` of the currently selected task. Should always equal the task selection URL part |
+-------------------+---------------------------------------------------------------------------------------------------+
| byObjectID        | Map of cs.taskmanger-specific task data indexed by ``cdb_object_id``. Reflects the resolved       |
|                   | configuration for the task's context and relationships and any custom plugin discriminators       |
+-------------------+---------------------------------------------------------------------------------------------------+

Object Maps
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Any objects contained in JSON responses from the backend are added to the cs.web object store. Some
objects are represented by minified REST objects containing only these attributes:

- ``@id``
- ``system:ui_link``
- ``system:classname``
- ``system:description``
- ``system:icon_link``
- ``system:status``
- ``relship:files``

.. _`cs-tasks-store-file-container`:

fileContainerID
---------------------------------------------------------------------------------------------------

Contains null, is undefined or contains the ``cdb_object_id`` of the object selected as the file
list pane's context.

.. _`cs-tasks-store-in-flight`:

inFlight
---------------------------------------------------------------------------------------------------

Contains a list of strings identifying a currently running asynchronous action. Used for displaying
activity in the ``DebugInfo`` component.

.. _`cs-tasks-store-user-tags`:

userTags
---------------------------------------------------------------------------------------------------

Contains all unique tags of currently displayed tasks as strings. Used for typeahead suggestions
when adding new tags.
