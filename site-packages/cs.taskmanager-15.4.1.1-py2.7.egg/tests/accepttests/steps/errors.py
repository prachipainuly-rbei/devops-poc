#!/usr/bin/env powerscript
# -*- python -*- coding: utf-8 -*-
#
# Copyright (C) 1990 - 2018 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

from cdb.validationkit import then
from cdb.validationkit import when


@when('^user opens the Task Manager with task "(?P<task_id>.+)" preselected$')
def userOpensTasksPreselected(context, task_id):
    context.webdriver.Get("/tasks/{}".format(task_id))
    context.webdriver.waitForAsyncActions()


@when("^user clicks the task's proceed cell$")
def userClicksProceed(context):
    context.webdriver.Proceed.GetProceedCell(context.task, click=True)


@when(u"^user completes the task from the open proceed cell$")
def userCompletesProceed(context):
    context.webdriver.Proceed.Proceed(
        context.task,
        "Erledigt",
        True,
        required="comment",
    )


@then('^an error "(?P<message>.+)" is shown$')
def errorIsShown(context, message):
    error = context.webdriver.GetElement(
        byCSS=".cs-web-components-base-NotificationItem.alert-danger")
    assert error is not None, "no error shown"
    assert error.text.endswith(message), (
        "error is '{}', expected endswith'{}'".format(error.text, message))
