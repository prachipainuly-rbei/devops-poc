<metal:widget define-macro="collapsible_widget">
  <tal:layout
    metal:use-macro="global_plugins['collapsible_blocks'].macros['collapsible_block_container']"
    define="block_id string:detail_team;
            block_order detail_widget_order;
            block_expanded widget_expanded">
    <metal:filltitle fill-slot="block_title">
      <h2><metal:title use-macro="kosmodromtools.templates()['widget_projectteam.html'].macros.widget_title" /></h2>
    </metal:filltitle>
    <metal:menu fill-slot="dropdown_menu"
                use-macro="kosmodromtools.templates()['widget_projectteam.html'].macros.widget_dropdown" />
    <metal:mbs fill-slot="block_content"
               use-macro="kosmodromtools.templates()['widget_projectteam.html'].macros.widget_content" />
  </tal:layout>
</metal:widget>


<metal:title define-macro="widget_title">
<i class="cdb-icon-team"></i>${options.labels['cdbpcs_elink_project_team']}
</metal:title>

<metal:dropdown define-macro="widget_dropdown">
    <metal:menu use-macro="global_plugins['components'].macros.operations_dropdown_menu"
                tal:define="opnames ['CDB_Create'];
                            oplist options.operations.get_class_operations(opnames, 'cdbpcs_team', cdb_project_id=project.cdb_project_id)" />
</metal:dropdown>

<metal:widgetcontent define-macro="widget_content">
  <div class="kosmodrom-project-team">
    <div class="team-member ${'new-row' if repeat.member.even else None}" tal:repeat="member project.TeamMembers">
        <tal:previewImage metal:use-macro="global_plugins['picture_uploader'].macros['preview_image']"
                          define="prev_img kosmodromtools.get_preview_img(member.Person);
                                  default_img_url string:${options.localres}placeholder-person.png"/>
        <div class="contact-info"
             tal:define="pers member.Person;
                         roles kosmodromtools.get_roles_of_project(project)">
            <address>
                <a href="${pers.MakeURL('CDB_ShowObject')}"
                   target="_blank">
                    <strong>${pers.name}</strong>
                    <span class="hide person-id">${pers.personalnummer}</span>
                </a><br />${pers.abt_nummer}<br />
                <span tal:repeat='role roles[pers.personalnummer]'>
                    ${role}<tal:sep condition="not repeat.role.end">, </tal:sep>
                </span>
                <a href="mailto:${pers.e_mail}">${pers.e_mail}</a><br />
                <span tal:condition="pers.telefon1|nothing">${pers.tel1_remark}: ${pers.telefon1}</span><br />
                <span tal:condition="pers.telefon2|nothing">${pers.tel2_remark}: ${pers.telefon2}</span><br />
                <span tal:condition="pers.telefon3|nothing">${pers.tel3_remark}: ${pers.telefon3}</span><br />
            </address>
        </div>
    </div>
  </div>
  <div></div>
</metal:widgetcontent>
