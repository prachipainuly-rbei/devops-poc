<metal:widget define-macro="collapsible_widget"
              tal:define="macrofile getattr(plugin, '__plugin_macro_file__', 'macros.html');
                          pluginmacros plugin.getTemplate(macrofile).macros;
                          kosmodromtools kosmodromtools|plugin.kosmodromtools;
                          dashboard_widget plugin.dashboard_widget">
  <tal:layout
    metal:use-macro="global_plugins['collapsible_blocks'].macros['collapsible_block_container']"
    define="block_id string:detail_time_schedule;
            block_order detail_widget_order;
            block_expanded widget_expanded;
            widget_data dashboard_widget.get_data(project.cdb_project_id)['widget_data']">
    <metal:filltitle fill-slot="block_title">
      <h2><metal:title use-macro="pluginmacros.widget_title" /></h2>
    </metal:filltitle>
    <metal:menu fill-slot="dropdown_menu"
                use-macro="pluginmacros.widget_dropdown" />
    <metal:content fill-slot="block_content">
      <!-- <metal:using use-macro="pluginmacros.widget_filters" /> -->
      <metal:using use-macro="pluginmacros.widget_content" />
    </metal:content>
  </tal:layout>
</metal:widget>

<metal:title define-macro="widget_title">
<i class="cdb-icon-time-schedule"></i>${options.labels['cdbpcs_elink_project_time_schedule']}
</metal:title>

<metal:dropdown define-macro="widget_dropdown">
    <metal:menu use-macro="global_plugins['components'].macros.operations_dropdown_menu"
                tal:define="opnames ['CDB_Search'];
                            oplist options.operations.get_class_operations(opnames, 'cdbpcs_time_schedule', cdb_project_id=project.cdb_project_id)" />
</metal:dropdown>
  <!-- Not (yet) needed /> -->
<metal:filters define-macro="widget_filters">

</metal:filters>

<metal:widgetcontent define-macro="widget_content">
<div id="projectdetail-time_schedules" class="kosmodrom-detail-object-list"
     data-elink-kosmodrom-detail-widget="time_schedule">
  <tal:objs tal:repeat="obj widget_data['objects']">
    <metal:show use-macro="kosmodromtools.templates()['layout.html'].macros['object_info']"
                tal:define="responsible_label options.labels.cdbpcs_elink_responsible;
                            responsible_name obj.getSubjectName();
                            deadline_field 'cdb_cdate';
                            default_op 'CDBPCS_ProjectPlan';
                            primary_project_link '<a target=\'_blank\' title=\'' + obj.project_name + '\' href=\'' + 
                              obj.Project.MakeURL() + '\'>' + obj.project_name +'</a>' if obj.Project else '';
                            add_html widget[1].dashboard_widget.get_field_label(obj.GetClassname(), 'project_name') + ': ' + primary_project_link"/>
  </tal:objs>
  <metal:pg use-macro="global_plugins['pagination'].macros.paginator"
            tal:define="paginator widget_data['paginator']"/></div>
</metal:widgetcontent>

