#!/usr/bin/env powerscript
# -*- python -*- coding: iso-8859-1 -*-
#
# Copyright (C) 1990 - 2013 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/

from cdb import sqlapi


class DataMigrations(object):
    def run(self):
        self.upd_kosmodrom_missing_rules()

    def upd_kosmodrom_missing_rules(self):

        #docs
        module_id = u'cs.pcs.projects_documents'
        #terms
        sqlstr = "into cdb_pyterm (name, fqpyname, predicate_name, attribute, operator, expression, filter_rule, id, cdb_module_id) " + \
                 "values('%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s')"

        name = u'cdbpcs: Kosmodrom: Released Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.documents.Document',
                    u'cdbpcs: Kosmodrom: Released Documents', u'z_status', u'=', u'200', u'', u'1', module_id))

        name = u'cdbpcs: Kosmodrom: My Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.documents.Document',
                    u'cdbpcs: Kosmodrom: My Documents', u'autoren', u'=', u'$(persno)', u'', u'1', module_id))

        name = u'cdbpcs: Kosmodrom: Active Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.documents.Document',
                    u'cdbpcs: Kosmodrom: Active Documents', u'z_status', u'!=', u'180', u'', u'1', module_id))

        name = u'cdbpcs: Kosmodrom: Objects Recently Created'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pyterm where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(
                sqlstr % (
                    name, u'cs.documents.Document',
                    u'cdbpcs: Kosmodrom: Recently Created Documents', u'cdb_cdate', u'>=', u'$(start_date)', u'', u'1', module_id))

        #predicates
        sqlstr = "into cdb_pypredicate (name, fqpyname, predicate_name, description, cdb_module_id) " + \
                 "values('%s', '%s', '%s', '%s', '%s')"

        name = u'cdbpcs: Kosmodrom: Active Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.documents.Document', u'cdbpcs: Kosmodrom: Active Documents', u'', module_id))

        name = u'cdbpcs: Kosmodrom: My Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.documents.Document', u'cdbpcs: Kosmodrom: My Documents', u'', module_id))

        name = u'cdbpcs: Kosmodrom: Objects Recently Created'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.documents.Document', u'cdbpcs: Kosmodrom: Recently Created Documents', u'', module_id))

        name = u'cdbpcs: Kosmodrom: Released Objects'
        if not sqlapi.SQLrows(sqlapi.SQLselect("* from cdb_pypredicate where name='%s' and cdb_module_id='%s'" % (name, module_id))):
            result = sqlapi.SQLinsert(sqlstr % (name, u'cs.documents.Document', u'cdbpcs: Kosmodrom: Released Documents', u'', module_id))

    # ----------------------------------------------------------

pre = []
post = [DataMigrations]
