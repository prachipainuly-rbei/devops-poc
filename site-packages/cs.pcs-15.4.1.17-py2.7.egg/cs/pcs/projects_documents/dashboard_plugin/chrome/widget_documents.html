<metal:widget define-macro="collapsible_widget"
              tal:define="macrofile getattr(plugin, '__plugin_macro_file__', 'macros.html');
                          pluginmacros plugin.getTemplate(macrofile).macros;
                          kosmodromtools kosmodromtools|plugin.kosmodromtools;
                          dashboard_widget plugin.dashboard_widget">
  <tal:layout
    metal:use-macro="global_plugins['collapsible_blocks'].macros['collapsible_block_container']"
    define="block_id string:detail_docs;
            block_order detail_widget_order;
            block_expanded widget_expanded;
            widget_data dashboard_widget.get_data(project.cdb_project_id)['widget_data']">
    <metal:filltitle fill-slot="block_title">
      <h2><metal:title use-macro="pluginmacros.widget_title" /></h2>
    </metal:filltitle>
    <metal:menu fill-slot="dropdown_menu"
                use-macro="pluginmacros.widget_dropdown" />
    <metal:content fill-slot="block_content">
      <metal:using use-macro="pluginmacros.widget_filters" />
      <metal:using use-macro="pluginmacros.widget_content" />
    </metal:content>
  </tal:layout>
</metal:widget>

<metal:title define-macro="widget_title">
<i class="cdb-icon-document"></i>
${options.labels['documents']}&nbsp;(${options.labels.cdbpcs_elink_filtered_count % widget_data['filtered_counter']})
</metal:title>

<metal:widgetdropdown define-macro="widget_dropdown">
    <metal:menu use-macro="global_plugins['components'].macros.operations_dropdown_menu"
                tal:define="opnames ['CDB_Create', 'cdb_create_doc_from_template'];
                            oplist options.operations.get_class_operations(opnames, 'document', cdb_project_id=project.cdb_project_id)" />

</metal:widgetdropdown>

<metal:filters define-macro="widget_filters">
<div class="kosmodrom-detail-filters" data-elink-kosmodrom-detail-target="filters">
  <div class="btn-group pull-left" data-toggle="buttons-checkbox">
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
               tal:define="filtername 'filter_mine';
                           cnt widget_data['all_counters'][filtername]|0;
                           filtertitle options.labels.cdbpcs_elink_my_documents">
      <metal:cnt fill-slot="filter_content">
      <img src="${options.getIcon('cdb_person')}" />&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
  </div>
  <div class="btn-group pull-left" data-toggle="buttons-checkbox">
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
            tal:define="filtername 'filter_recently_created';
                        cnt widget_data['all_counters'][filtername]|0;
                        filtertitle options.labels.cdbpcs_elink_tooltip_recently_created % dashboard_widget.get_recent_days()">
      <metal:cnt fill-slot="filter_content">
      ${options.labels.cdbpcs_elink_filter_new}&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
  </div>
  <tal:modelbtn condition="dashboard_widget.get_model_rule()">
    <div class="btn-group pull-left" data-toggle="buttons-checkbox">
      <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
                 tal:define="filtername 'filter_categ_document';
                             cnt widget_data['all_counters'][filtername]|0;
                             filtertitle options.labels['documents']">
        <metal:cnt fill-slot="filter_content">
        <img src="${options.getIcon('Document')}" />&nbsp;(${cnt})
        </metal:cnt>
      </metal:btn>
      <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
                 tal:define="filtername 'filter_categ_model';
                             cnt widget_data['all_counters'][filtername]|0;
                             filtertitle options.labels['models']">
        <metal:cnt fill-slot="filter_content">
        <img src="${options.getIcon('CAD Document')}" />&nbsp;(${cnt})
        </metal:cnt>
      </metal:btn>
    </div>
  </tal:modelbtn>
  <div class="btn-group pull-left" data-toggle="buttons-checkbox">
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
               tal:define="filtername 'filter_released';
                           cnt widget_data['all_counters'][filtername]|0;
                           filtertitle options.labels.cdbpcs_elink_filter_released">
      <metal:cnt fill-slot="filter_content">
      ${options.labels.cdbpcs_elink_filter_released}&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
    <metal:btn use-macro="kosmodromtools.templates()['layout.html'].macros.filter_button"
               tal:define="filtername 'filter_not_released';
                           cnt widget_data['all_counters'][filtername]|0;
                           filtertitle options.labels.cdbpcs_elink_not_released">
      <metal:cnt fill-slot="filter_content">
      ${options.labels.cdbpcs_elink_filter_not_released}&nbsp;(${cnt})
      </metal:cnt>
    </metal:btn>
  </div>
  <div class="no-float"></div>
</div>
</metal:filters>

<metal:widgetcontent define-macro="widget_content">
<div id="projectdetail-docs" class="kosmodrom-detail-object-list"
     data-elink-kosmodrom-detail-widget="document">
  <tal:objs tal:repeat="obj widget_data['objects']">
    <metal:show use-macro="kosmodromtools.templates()['layout.html'].macros['object_info']"
                tal:define="responsible_field 'autoren';
                            deadline_field 'cdb_cdate';
                            deadline_label options.labels.cdbpcs_elink_created_at">
      <metal:menu fill-slot="other_actions"
                  tal:condition="obj.cdb_classname>='model'">
        <a tal:define="opdata options.operations.get_object_operation('CDB_Edit', obj)"
           target="_blank"
           href="${opdata['url']}" class="btn btn-mini" title="${options.labels.cdbpcs_elink_open_in_wsm}">
          <img src="${options.localres}wsm_dots_green.png" class="wsm-icon"/></a>
        <a tal:define="opdata options.operations.get_object_operation('CDB_RememberForCAD', obj)"
           target="_blank"
           href="${opdata['url']}" class="btn btn-mini" title="${opdata['label']}">
          <img src="${opdata['icon']}" alt="${opdata['label']}"/></a>
      </metal:menu>
    </metal:show>
  </tal:objs>
  <metal:pg use-macro="global_plugins['pagination'].macros.paginator"
            tal:define="paginator widget_data['paginator']"/>
</div>
</metal:widgetcontent>
