<div>
<ul id="task_struct"
	tal:attributes="fill_target_field string:task"
	tal:condition="context.project_object|nothing">
	<li tal:define="tasklist context.toptasks;
					dummylist python:tasklist.sort();
					task_level python:1;
					global task_order python:0" class="toplevel_object">
		<div class="context_div">
			<img src="" tal:attributes="src context.project_object.icon"/>
			<span tal:content="context.project_object.project_name"
				  tal:define="global task_order python:task_order+1"
				  tal:attributes="tabindex task_order"
				  class="toplevel_object"/>
			<div class="clearlayout"></div>
		</div>
		<tal:subtasks repeat="taskdata tasklist">
		<metal:taskobj use-macro="template.macros.display_task_object"></metal:taskobj>
		</tal:subtasks>
	</li>
</ul>
</div>
<tal:hide replace="nothing">
<metal:taskobj define-macro="display_task_object">
<ul tal:attributes="class string:task_level_${task_level}">
	<li tal:define="tid python:taskdata[1];
	                tmap python:context.tmaps.get(tid, None)"
	    tal:condition="tmap">
	    <tal:defineatt define="tasklist tmap.children;
	    					   dummylist python:tasklist.sort();
	    					   task_level python:task_level+1">
	    <div tal:attributes="class python:'highlight_display context_div' if tmap.get('highlight',False) else 'context_div'">
	    	<img src="" tal:attributes="src tmap.icon"/>
	    	<span tal:content="tmap.task_desc"
	    		  tal:define="global task_order python:task_order+1"

	    	      tal:attributes="class python:'task_selectable';
	    	      				  oid tid;
	    	      				  tabindex task_order"/>
	    	<input type="hidden" value="" tal:attributes="value tmap.task_name" class="hidden_task_name"/>
	    	<div class="clearlayout"></div>
	    </div>
		<tal:subtasks repeat="taskdata tasklist">
		<metal:taskobj use-macro="template.macros.display_task_object"></metal:taskobj>
		</tal:subtasks>
		</tal:defineatt>
	</li>
</ul>
</metal:taskobj>
</tal:hide>