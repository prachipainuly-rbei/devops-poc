#!/usr/bin/env python
# -*- mode: python; coding: utf-8 -*-
#
# Copyright (C) 1990 - 2016 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

"""
This module setups the stories for storybook.
"""
__docformat__ = "restructuredtext en"
__revision__ = "$Id: stories.py 159807 2017-06-07 08:43:53Z yzh $"


import os
from cdb import rte
from cdb import sig

from cs.platform.web import static
from cs.platform.web.rest.app import get_collection_app
from cs.pcs.projects import Project
from cs.web.components.storybook.main import add_stories
from cs.web.components.storybook.main import STORYBOOK_APP_SETUP_HOOK
from cs.web.components.storybook.main import STORYBOOK_APP_SETUP_PATH

from cs.pcs.projects.web import COMPONENT


STORY = "%s-stories" % COMPONENT


@sig.connect(rte.APPLICATIONS_LOADED_HOOK)
def _register_libraries():
    stories = static.Library(STORY, "15.1.0",
                             os.path.join(os.path.dirname(__file__), "js", "build"))
    stories.add_file("%s.js" % STORY)
    stories.add_file("%s.js.map" % STORY)
    static.Registry().add(stories)
    add_stories(
        (COMPONENT, "15.1.0"),
        (STORY, "15.1.0"))


@sig.connect(STORYBOOK_APP_SETUP_HOOK)
def _story_setup(app_setup, model, request):
    app_setup.merge_in(STORYBOOK_APP_SETUP_PATH, {
        "%s" % COMPONENT: {
            "project": request.class_link(
                Project,
                {"keys": "P000119"},
                app=get_collection_app(request))
        }
    })
