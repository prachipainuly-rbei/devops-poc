/*
 * Copyright (C) 2016 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 *
 * Revision "$Id: helpers.js 160367 2017-06-16 07:19:31Z yzh $"
 */

import {getAppSetup} from 'cs-web-components-base';
import moment from 'moment';
import Immutable from 'immutable';

const DATE_FORMAT = getAppSetup().getIn(['formats', 'dateFormat']);

export function getDateObject(date = moment()) {
    return moment(date, moment.ISO_8601);
}

export function formatDate(date) {
    return getDateObject(date).format(DATE_FORMAT);
}

export function prefixNS(name) {
    return `${componentNameSpace}-${name}`;
}

export function getTimeLinePosition(project, target) {
    const start = getDateObject(project.get('start_time_plan'));
    const end = getDateObject(project.get('end_time_plan'));
    const curr = getDateObject(target);
    const total = moment.duration(end.diff(start)).asDays();
    const left = moment.duration(curr.diff(start)).asDays();
    return total === 0 ? 100 : left * 100.0 / total;
}

export function getTodayPosition(project) {
    return getTimeLinePosition(project);
}

export function getAttributeLabel(classDef, attrName) {
    const attrDef = classDef ?
        classDef.get('attributes').find(
            attr => attr.get('name') === attrName
        ) : null;
    return attrDef ? attrDef.get('label') : '';
}

export function getRelship(name, dflt) {
    const relshipConfiguration = getAppSetup().getIn(
        ['detail_view', 'relshipConfiguration'], Immutable.Map());
    return relshipConfiguration.get(name, dflt);
}
