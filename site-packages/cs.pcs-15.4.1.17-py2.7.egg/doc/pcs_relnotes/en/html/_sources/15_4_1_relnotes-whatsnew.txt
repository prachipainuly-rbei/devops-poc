.. _`15_4_1_relnotes-whatsnew`:

What's New in |cs.pcs| 15.4.1?
##############################

Checklist
=========
The checklist refers to changes that require or are recommended for manual actions before or after the update.

The access rights of project folders now have an impact on the assignment of documents (from SL 4)
  The access rights of project folders now have an impact on the assignment of documents to a folder,
  but not on the document itself (from SL 4).
  Relationship access profiles ``CheckCreateFolderDoc`` and ``CheckDeleteFolderDocument`` have been replaced
  by ``cs.pcs: Folder: Document Assignments``.
  The relationship access profiles ``CheckCreateFolderDoc`` and ``CheckDeleteFolderDocument``
  and their configuration remain in the system as unassigned elements. After the update, you must delete
  these elements manually.

Document Templates in Project Structures
  **Before updating**: If you use documents as templates in project structures, you must prepare the data for the new
  database schema. More information can be found in :ref:`pcs_rn_document_templates_in_project_structures`

Default roles of a project
  Check customer-specific code for the use of the property ``cs.pcs.projects.default_roles``.
  If necessary, change the code as described in :ref:`pcs_rn_project_default_roles`.

Update Script for Favorites
  We recommend that you run the update script manually, as described in :ref:`pcs_rn_favorites`

Cost Center
  If you have used the cost center attribute and want to continue using it, add it manually to the GUI
  :ref:`pcs_rn_attribute_cost_center`


.. _`pcs_rn_project_default_roles`:

Default roles of projects can be customized in derived classes
==============================================================

From |cs.pcs| 15.4.1 default roles are now customizable in powerscript.

Default value has been moved from ``cs.pcs.projects.default_roles`` to ``cs.pcs.projects.Project.default_roles``.

Each project role that is defined, can be used as a default role in a derived class similar to the following lines:

.. code-block:: python

    from cs.pcs.projects import Project

    class MyProject(Project):

        default_roles = ['Projektmitglied', 'Projektassistent']

Currently, there is a legacy mode included. The previous definition ``cs.pcs.projects.default_roles`` points to the new
definition ``cs.pcs.projects.Project.default_roles``. It is strongly recommended to check and adapt existing code.
The legacy mode will be removed in a future version.

.. note::

    It is strongly recommended to check and adapt existing code regarding the default roles definition immediately.

Project: New from template
==========================

When a project is created from a template, the values of parent project and template flag are no longer copied.

Projects API manual
===================

Now there is an additional manual partly describing customization via PowerScript :ref:`pcs_api_en:pcs_api`.

Projects admin manual
=====================

Now there is an additional manual partly describing customization :ref:`pcs_admin_en:projects_admin`.

.. _`pcs_rn_favorites`:

Project: Update Script for Favorites
====================================

An additional manual update script named ``cs.pcs.projects.updates.v15_4_1.update_favorites.py``
for data migration of favorites  is added.
This script will change all occurrences of subject_name to mapped_subject_name_de for the classes
Task, Issue, Checklist and ChecklistItem.

.. _`pcs_rn_attribute_cost_center`:

Project: Cost Center 
==========================

Attribute ``cost_center`` is removed from user interface, but still existing within data dictionary.

Project: Coverage of Roles 
==========================

Project roles do now indicate if they are covered by at least one person and if they are used as a responsible role
for any of the projects tasks.

.. note::

    Later changes to indirect assignments to the project role by an intermediary role assignment are not evaluated.

.. _`pcs_rn_document_templates_in_project_structures`:

Document Templates in Project Structures
========================================

Documents or document templates can be used as templates in projects.
So far, documents could only be created from the exact index that was assigned to the business object.
From Service Level 4, documents can always be created from the currently valid index of the assigned template.
You can configure the behavior for the assignment of business object and template using the checkbox
:guilabel:`Always Use this Index`.
More information on this topic can be found in section :ref:`pcs_user_en:cdbwinusrman-pcs-doctemplates`
of the user manual.

So far, document index was a part of the the primary keys.
This made it possible to assign several index of a document as templates.
From now, the document index is no longer part of the primary key of the assignment class.
This means that it is no longer possible to assign multiple index of a document number.

.. important::
    :strong:`Before updating`, you must ensure that only one index of a document is assigned to a business
    object as a template.

The script :file:`check_uniqueness_of_pcs_doctemplate_assignments.py` supports you in preparing the data.
The script is located in the folder ``cs\pcs\projects_documents\updates\v15_4_1`` of |cs.pcs|.
Run the script in a console using |cdbpy|.

The script can display the number of assignments, if the assignments are not match to new database schema.

The script can modify the data to match the new schema.
If at least one non-obsolete document is assigned, its most recent index is maintained.
If only obsolete documents are assigned, their most recent index is retained.
All assignments to other index are removed.

For more information, run the script using the command line argument ``--help``

For a complete overview of the business objects to which a document can be assigned as a template,
refer to the section :ref:`<pcs_user_en:cdbwinusrman-pcs-doctemplates-processing-context>`.

.. note::

    If the update is performed and the data does not match the new database schema, you get an error when
    compiling one of the classes ``cdbpcs_prj2doctmpl, cdbpcs_task2doctmpl, cdbpcs_doc2cl or cdbpcs_doc2cli``.

Automatically generated view for responsible of persons or roles
=================================================================

An automatically generated view ``pcs_sharing_subjects_all`` provides the names for persons and roles that are
displayed in business objects, e.g. project tasks, issues, in the field :guilabel:`Responsible`.

For more information refer to the section :ref:`pcs_admin_en:pcs_admin_organizational_context`
of the admin manual.
