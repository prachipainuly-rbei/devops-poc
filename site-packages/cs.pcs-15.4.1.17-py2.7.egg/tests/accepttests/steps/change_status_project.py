#!/usr/bin/env python
# coding: utf-8
#
# Copyright (C) 2016 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#
from cdb.validationkit import then
from common import generateProjectIssue
from common import getContextObject
from common import getTestData


def project_contains(context, project, relship, expected):
    actual = len(getattr(project, relship))
    assert actual == int(expected), (
        "project contains %s %s, expected %s\n%s" % (
            actual, relship, expected, getTestData(context)))


@then("^the (?P<project>(?:second )?project) contains "
      "(?P<expected>[0-9]+) (?P<relship>.*)$")
def step(context, project, expected, relship):
    if relship == "tasks":
        relship = "AllTasks"
    elif relship == "checklists":
        relship = "Checklists"
    elif relship == "issues":
        relship = "Issues"

    proj = getContextObject(context, project)
    project_contains(context, proj, relship, expected)


@given("^an issue exists$")
def step(context):
    context.issue = generateProjectIssue(context.project)
