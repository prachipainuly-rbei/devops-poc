# Copyright (C) 2016 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

Feature: Consistency After Sync from MS Project


Background:
    GIVEN a project exists
        AND a task exists
        AND the project's status is Execution


@msp
Scenario Outline: Add Predecessor
    GIVEN EA-related tasks exist
        AND the predecessor's status is <pred>
        AND the successor's status is <succ>
    WHEN Projektleiter calls MSP consistency function
    THEN the status of the predecessor is <pred>
        AND the status of the successor is <succ_to>

    Examples:
        | pred      | succ      | succ_to    |
        | New       | New       | New        |
        | New       | Ready     | New        |  # reset
        | New       | Execution | Execution  |
        | New       | Finished  | Finished   |
        | New       | Completed | Completed  |
        | New       | Discarded | Discarded  |
        | Ready     | New       | New        |
        | Ready     | Ready     | Ready      |
        | Ready     | Execution | Execution  |
        | Ready     | Finished  | Finished   |
        | Ready     | Completed | Completed  |
        | Ready     | Discarded | Discarded  |
        | Execution | New       | New        |
        | Execution | Ready     | Ready      |
        | Execution | Execution | Execution  |
        | Execution | Finished  | Finished   |
        | Execution | Completed | Completed  |
        | Execution | Discarded | Discarded  |
        | Finished  | New       | New        |
        | Finished  | Ready     | Ready      |
        | Finished  | Execution | Execution  |
        | Finished  | Finished  | Finished   |
        | Finished  | Completed | Completed  |
        | Finished  | Discarded | Discarded  |
        | Completed | New       | New        |
        | Completed | Ready     | Ready      |
        | Completed | Execution | Execution  |
        | Completed | Finished  | Finished   |
        | Completed | Completed | Completed  |
        | Completed | Discarded | Discarded  |
        | Discarded | New       | New        |
        | Discarded | Ready     | Ready      |
        | Discarded | Execution | Execution  |
        | Discarded | Finished  | Finished   |
        | Discarded | Completed | Completed  |
        | Discarded | Discarded | Discarded  |


@msp
Scenario Outline: Move Task to Parent
    GIVEN a subtask exists
        AND a task checklist exists
        AND the task's status is <task>
        AND the subtask's status is <subtask>
        AND the task checklist's status is <checklist>
    WHEN Projektleiter calls MSP consistency function
    THEN the status of the task is <task_to>
        AND the status of the subtask is <subtask_to>
        AND the status of the task checklist is <checklist_to>

    Examples:
        | task      | task_to   | subtask   | subtask_to | checklist  | checklist_to |
        | New       | New       | Ready     | New        | Evaluation | New          |
        | New       | New       | Execution | New        | Evaluation | New          |
        | New       | New       | Finished  | New        | Completed  | Completed    |
        | Ready     | Execution | Execution | Execution  | Evaluation | Evaluation   |
        | Ready     | Execution | Finished  | Finished   | Evaluation | Evaluation   |
        | Ready     | Ready     | New       | New        | New        | New          |
        | Ready     | Ready     | Discarded | Discarded  | Discarded  | Discarded    |
        | Ready     | Finished  | Finished  | Finished   | Completed  | Completed    |
        | Execution | Execution | New       | New        | New        | New          |
        | Execution | Execution | Ready     | Ready      | Evaluation | Evaluation   |
        | Execution | Execution | Finished  | Finished   | Evaluation | Evaluation   |
        | Execution | Execution | Completed | Completed  | Evaluation | Evaluation   |
        | Finished  | Finished  | Finished  | Finished   | Completed  | Completed    |
        | Finished  | Execution | New       | Ready      | New        | New          |
        | Finished  | Execution | Ready     | Ready      | New        | New          |
        | Finished  | Execution | Execution | Execution  | Evaluation | Evaluation   |
        | Finished  | Finished  | Discarded | Discarded  | Discarded  | Discarded    |
        | Finished  | Finished  | Completed | Completed  | Completed  | Completed    |
        | Completed | Completed | Discarded | Discarded  | Completed  | Completed    |
        | Completed | Completed | Completed | Completed  | Completed  | Completed    |
        | Discarded | Discarded | New       | Discarded  | New        | Discarded    |
        | Discarded | Discarded | Ready     | Discarded  | New        | Discarded    |
        | Discarded | Discarded | Execution | Discarded  | Evaluation | Discarded    |
        | Discarded | Discarded | Finished  | Finished   | Completed  | Completed    |
        | Discarded | Discarded | Completed | Completed  | Completed  | Completed    |


@msp
Scenario Outline: Move Task to Parent Failing
    GIVEN a subtask exists
        AND a subtask checklist exists
        AND a second subtask exists
        AND the task's status is <task>
        AND the subtask's status is <subtask>
        AND the second subtask's status is <subtask2>
    WHEN Projektleiter calls MSP consistency function
    THEN exception '<exception>' is thrown
        AND the status of the task is <task>
        AND the status of the subtask is <subtask>

    Examples:
        | task      | subtask   | subtask2  | exception              |
        | New       | Completed | Execution | pcs_msp_closed_subtask | 
        | Ready     | Completed | Execution | pcs_msp_closed_subtask |
        | Completed | New       | Completed | pcs_msp_closed_task    |
        | Completed | Ready     | Completed | pcs_msp_closed_task    |
        | Completed | Execution | Completed | pcs_msp_closed_task    |
