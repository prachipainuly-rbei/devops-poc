# Copyright (C) 2016 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

Feature: Change Project Status

Tests status changes of projects including their consequences. Also test
constraints when creating new structure elements.


Background:
    GIVEN a project exists


Scenario Outline: Change Subproject Status
    GIVEN a subproject exists
    WHEN Projektleiter changes the status of the subproject from <subproject> to Execution
    THEN the changed status of the subproject is <saved>

    Examples:
        | subproject | saved     |
        | New        | not saved |  # 2
        | Execution  | saved     |  # 10


Scenario: Start Project /w Subproject
    GIVEN a subproject exists
        AND a task exists
    WHEN Projektleiter changes the status of the project from New to Execution
    THEN the changed status of the project is saved
        AND the status of the task is Ready

    # 6


Scenario Outline: Complete Project
    GIVEN a task exists
        AND the task's status is <task_from>
    WHEN Projektleiter changes the status of the project from Execution to Completed
    THEN the changed status of the project is saved
        AND the status of the task is <task_to>

    Examples:
        | task_from | task_to   |
        | New       | Discarded |  # 14
        | Ready     | Discarded |  # 14
        | Execution | Discarded |  # 14
        | Discarded | Discarded |  # 14
        | Finished  | Completed |  # 14
        | Completed | Completed |  # 14


Scenario Outline: Freeze Project
    GIVEN a task exists
        AND the task's status is <task_status>
    WHEN Projektleiter changes the status of the project from Execution to Frozen
    THEN the changed status of the project is saved
        AND the status of the task is <task_status>
        AND the task is frozen

    Examples:
        | task_status |
        | New         |  # 15
        | Ready       |  # 15
        | Execution   |  # 15
        | Discarded   |  # 15
        | Finished    |  # 15
        | Completed   |  # 15


Scenario Outline: Defrost Project
    GIVEN a task exists
    WHEN Projektleiter changes the status of the project from Frozen to <project>
    THEN the changed status of the project is saved
        AND the task is not frozen

    Examples:
        | project   |
        | New       |  # KOS1
        | Execution |  # KOS1
        | Discarded |  # KOS1


Scenario Outline: Freeze Project /w Subproject
    GIVEN a subproject exists
        AND the subproject's status is <subproject>
    WHEN Projektleiter changes the status of the project from Execution to Frozen
    THEN the changed status of the project is <saved>

    Examples:
        | subproject | saved     |
        | New        | not saved |  # 17
        | Execution  | not saved |  # 16
        | Frozen     | saved     |  # 18
        | Completed  | saved     |  # 18
        | Discarded  | saved     |  # 18


Scenario Outline: Defrost Subproject
    GIVEN a subproject exists
        AND the project's status is Frozen
    WHEN Projektleiter changes the status of the subproject from Frozen to <subproject>
    THEN the changed status of the subproject is <saved>

    Examples:
        | subproject | saved     |
        | New        | not saved |  # 17
        | Execution  | not saved |  # 19
        | Discarded  | saved     |  # 20


Scenario Outline: Start Subproject in Completed Project
    GIVEN a subproject exists
        AND the project's status is <project>
    WHEN Projektleiter changes the status of the subproject from New to <subproject>
    THEN the changed status of the subproject is <saved>

    Examples:
        | project   | subproject | saved     |
        | Discarded | Execution  | not saved |  # 39
        | Completed | Execution  | not saved |  # 40


Scenario Outline: Reset Project /w Tasks
    GIVEN a task exists
        AND the task's status is <task>
    WHEN Projektleiter changes the status of the project from <project> to New
    THEN the status of the task is <task_to>

    Examples:
        | project   | task      | task_to   |
        | Execution | New       | New       |  # 92
        | Execution | Ready     | New       |  # 92
        | Execution | Execution | New       |  # 92
        | Execution | Finished  | New       |  # 92
        | Execution | Finished  | New       |  # 92
        | Execution | Completed | New       |  # 92
        | Execution | Discarded | Discarded |  # 92
        | Discarded | New       | New       |  # KOS1
        | Discarded | Ready     | New       |  # KOS1
        | Discarded | Execution | New       |  # KOS1
        | Discarded | Finished  | Finished  |  # KOS1
        | Discarded | Completed | Completed |  # KOS1
        | Discarded | Discarded | New       |  # KOS1


Scenario Outline: Reset Project /w Issues
    GIVEN an issue exists
        AND the issue's status is <issue>
    WHEN Projektleiter changes the status of the project from Execution to New
    THEN the status of the issue is <issue>

    Examples:
        | issue           |
        | New             |  # 92
        | Evaluation      |  # 92
        | Execution       |  # 92
        | Deferred        |  # 92
        | Waiting for ... |  # 92
        | Review          |  # 92
        | Discarded       |  # 92
        | Completed       |  # 92


Scenario Outline: Reset Project /w Checklists
    GIVEN a checklist exists
        AND the checklist's status is <checklist>
    WHEN Projektleiter changes the status of the project from Execution to New
    THEN the status of the checklist is <checklist_to>

    Examples:
        | checklist  | checklist_to |
        | New        | New          |  # 92
        | Evaluation | New          |  # 92
        | Discarded  | Discarded    |  # 92
        | Completed  | New          |  # 92


Scenario Outline: Add Task
    GIVEN the project's status is <project>
    WHEN Projektleiter tries to create a new task
    THEN the project contains <amount> tasks
        AND the task is <frozen>

    Examples:
        | project   | amount | frozen     |
        | New       | 1      | not frozen |  # 1, 130
        | Execution | 1      | not frozen |  # 7, 131
        | Frozen    | 1      | frozen     |  # 132


Scenario Outline: Adding Task Fails
    GIVEN the project's status is <project>
    WHEN Projektleiter tries to create a new task
    THEN the project contains <amount> tasks

    Examples:
        | project   | amount |
        | Completed | 0      |  # 133
        | Discarded | 0      |  # 134


Scenario Outline: Add Checklist
    GIVEN the project's status is <project>
    WHEN Projektleiter tries to create a new checklist
    THEN the project contains <amount> checklists
        AND the checklist is <frozen>

    Examples:
        | project   | amount | frozen     |
        | New       | 1      | not frozen |  # 141
        | Execution | 1      | not frozen |  # 142
        | Frozen    | 1      | frozen     |  # 143


Scenario Outline: Adding Checklist Fails
    GIVEN the project's status is <project>
    WHEN Projektleiter tries to create a new checklist
    THEN the project contains <amount> checklists

    Examples:
        | project   | amount |
        | Completed | 0      |  # 144
        | Discarded | 0      |  # 145


Scenario Outline: Copy Task
    GIVEN a second project exists
        AND a task exists
        AND the second project's status is <project2>
    WHEN Projektleiter tries to copy the task into the second project
    THEN the second project contains <amount> tasks
        AND the copy is <frozen>

    Examples:
        | project2  | amount | frozen     | copy |
        | New       | 1      | not frozen | New  |  # 151
        | Execution | 1      | not frozen | New  |  # 152
        | Frozen    | 1      | frozen     | New  |  # 153
        | Completed | 0      | not frozen | New  |  # 154
        | Discarded | 0      | not frozen | New  |  # 155


Scenario Outline: Copy Checklist
    GIVEN a second project exists
        AND a checklist exists
        AND the second project's status is <project2>
        AND the checklist's status is <checklist>
    WHEN Projektleiter tries to copy the checklist into the second project
    THEN the second project contains <amount> checklists
        AND the copy is <frozen>
        AND the status of the copy is <copy>

    Examples:
        | project2  | checklist  | amount | frozen     | copy |
        | New       | New        | 1      | not frozen | New  |  # 162
        | Execution | Evaluation | 1      | not frozen | New  |  # 163
        | Frozen    | Completed  | 1      | frozen     | New  |  # 164
        | Completed | New        | 0      | not frozen | New  |  # 165
        | Discarded | New        | 0      | not frozen | New  |  # 166
