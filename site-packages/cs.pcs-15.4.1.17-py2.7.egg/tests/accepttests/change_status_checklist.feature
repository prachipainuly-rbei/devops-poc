# Copyright (C) 2016 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

Feature: Change Checklist Status

Tests status changes of project checklists including their consequences.


Background:
    GIVEN a project exists
        AND the project's status is Execution


Scenario Outline: Change Checklist Status
    GIVEN a task exists
        AND a task checklist exists
        AND the task's status is <task>
    WHEN Projektleiter changes the status of the task checklist from <checklist> to <checklist_to>
    THEN the changed status of the task checklist is <saved>

    Examples:
        | task      | checklist  | checklist_to | saved     |  # 29
        | New       | Discarded  | New          | saved     |  # 30
        | Ready     | Discarded  | New          | saved     |  # 31
        | Execution | Evaluation | New          | saved     |  # 32
        | Discarded | Discarded  | New          | not saved |  # 33
        | Finished  | Discarded  | New          | not saved |  # 34
        | Completed | Discarded  | New          | not saved |  # 42
        | Execution | New        | Evaluation   | saved     |  # 43
        | New       | New        | Evaluation   | not saved |  # 44
        | Finished  | Completed  | Evaluation   | not saved |  # 45
        | Completed | Completed  | Evaluation   | not saved |  # 46
        | Discarded | Discarded  | Evaluation   | saved     |  # 68


Scenario Outline: Complete Checklist /w Unrated Items
    GIVEN a checklist exists
        AND a checkpoint exists
        AND the checkpoint's status is <cl_item>
    WHEN Projektleiter changes the status of the checklist from Evaluation to Completed
    THEN the changed status of the checklist is not saved

    Examples:
        | cl_item |
        | New     |  # 65
        | Ready   |


Scenario Outline: Create Checklist Item
    GIVEN a checklist exists
        AND the checklist's status is <checklist>
    WHEN Projektleiter creates a new checkpoint
    THEN the checklist has exactly <amount> checkpoints

    Examples:
        | checklist  | amount |
        | New        | 1      |  # OP22
        | Evaluation | 1      |  # OP22
        | Completed  | 0      |  # 66
        | Discarded  | 0      |  # OP22


Scenario Outline: Start Checklist in Task
    GIVEN a task exists
        AND a task checklist exists
        AND the task's status is <task>
    WHEN Projektleiter changes the status of the task checklist from <checklist> to Evaluation
    THEN the changed status of the task checklist is <saved>
        AND the status of the task is <task_to>

    Examples:
        | task      | checklist | saved     | task_to   |
        | Ready     | New       | saved     | Execution |  # 79
        | Ready     | Discarded | saved     | Execution |  # 80
        | Discarded | Discarded | saved     | Discarded |  # 81 (correct?)
        | Finished  | Completed | not saved | Finished  |  # 82 (correct?)


Scenario: Rate Checklist Item
    GIVEN a checklist exists
        AND a checkpoint exists
        AND a second checkpoint exists
    WHEN Projektleiter rates the checkpoint
    THEN the checkpoint is rated
        AND the second checkpoint is not rated
        AND the status of the checklist is Evaluation
    # 83


Scenario: Rate Last Checklist Item
    GIVEN a checklist exists
        AND a checkpoint exists
        AND a second checkpoint exists
        AND the checklist's status is Evaluation
        AND the checkpoint is rated
    WHEN Projektleiter rates the second checkpoint
    THEN the second checkpoint is rated
        AND the status of the checklist is Completed
        AND the evaluator of the checklist is behave_test
        AND the evaluator of the checkpoint is behave_test
    # 84


Scenario Outline: Stop Checklist in Task Group
    GIVEN a task exists
        AND a task checklist exists
        AND the task's status is Execution
        AND the task <group> a task group
    WHEN Projektleiter changes the status of the task checklist from Evaluation to <checklist_to>
    THEN the changed status of the task checklist is saved
        AND the status of the task is <task_to>

    Examples:
        | group  | checklist_to | task_to   |
        | is     | Completed    | Finished  |  # 87
        | is not | Completed    | Finished  |  # 87
        | is     | Discarded    | Execution |  # 90
        | is not | Discarded    | Execution |  # 90


Scenario Outline: Add Task Checklist
    GIVEN a task exists
        AND the project's status is <project>
        AND the task's status is <task>
    WHEN Projektleiter tries to create a new task checklist
    THEN the task has exactly <amount> checklists
        AND the checklist is <frozen>

    Examples:
        | project   | task      | amount | frozen     |
        | Execution | New       | 1      | not frozen |  # 146
        | Frozen    | New       | 1      | frozen     |  # 146
        | Execution | Ready     | 1      | not frozen |  # 147
        | Frozen    | Ready     | 1      | frozen     |  # 147
        | Execution | Execution | 1      | not frozen |  # 147
        | Frozen    | Execution | 1      | frozen     |  # 147


Scenario Outline: Adding Task Checklist Fails
    GIVEN a task exists
        AND the project's status is <project>
        AND the task's status is <task>
    WHEN Projektleiter tries to create a new task checklist
    THEN the task has exactly <amount> checklists

    Examples:
        | project   | task      | amount |
        | Execution | Finished  | 0      |  # 148
        | Frozen    | Finished  | 0      |  # 148
        | Execution | Completed | 0      |  # 149
        | Frozen    | Completed | 0      |  # 149
        | Execution | Discarded | 0      |  # 150
        | Frozen    | Discarded | 0      |  # 150


Scenario Outline: Copy Checklist
    GIVEN a task exists
        AND a checklist exists
        AND the task's status is <task>
        AND the checklist's status is <checklist>
    WHEN Projektleiter tries to copy the checklist into the task
    THEN the task has exactly <amount> checklists
        AND the status of the copy is <copy>

    Examples:
        | task      | checklist  | amount | copy |
        | New       | New        | 1      | New  |  # 167
        | Ready     | Evaluation | 1      | New  |  # 168
        | Execution | Completed  | 1      | New  |  # 169
        | Finished  | New        | 0      | New  |  # 170
        | Completed | New        | 0      | New  |  # 171
        | Discarded | New        | 0      | New  |  # 172


Scenario Outline: Move Checklist
    GIVEN a task exists
        AND a checklist exists
        AND the task's status is <task>
        AND the checklist's status is <checklist>
    WHEN Projektleiter makes the task the parent of the checklist
    THEN the task has exactly <amount> checklists
        AND the status of the checklist is <checklist_to>

    Examples:
        | task      | checklist  | amount | checklist_to |
        | New       | New        | 1      | New          |  # 184
        | Ready     | New        | 1      | New          |  # 185
        | Execution | New        | 1      | New          |  # 186
        | Discarded | New        | 0      | New          |  # 187 (changed)
        | Finished  | New        | 0      | New          |  # 188
        | Completed | New        | 0      | New          |  # 189
        | New       | Evaluation | 0      | Evaluation   |  # 190
        | New       | Completed  | 0      | Completed    |  # 191
        | New       | Discarded  | 0      | Discarded    |  # 192
