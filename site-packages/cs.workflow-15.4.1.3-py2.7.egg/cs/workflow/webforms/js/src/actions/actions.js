/* -*- mode: javascript; coding: utf-8 -*-
 * $Id: actions.js 177273 2018-05-17 09:24:58Z cso $
 *
 * Copyright (c) 2017 CONTACT Software GmbH
 * All rights reserved.
 * http://www.contact-software.com
 */

import {prefixNS} from '../helpers.js';
import {Console, getJSON, postJSON} from 'cs-web-components-base';

export const DATA_FETCH_SUCCESS = prefixNS('DATA_FETCH_SUCCESS');
export const DATA_FETCH_FAILURE = prefixNS('DATA_FETCH_FAILURE');

function onDataReceived(payload) {
    return {
        type: DATA_FETCH_SUCCESS,
        payload: payload
    };
}

function onDataFailed(key) {
    return {
        type: DATA_FETCH_FAILURE,
        payload: {
            key: key
        }
    };
}

export function loadFormsActionCreator(key, task_object_id, forms) {
    const payload = {
        key: key,
        forms: forms ? forms.toJS() : undefined
    };
    return (dispatch) => {
        getJSON(
            `/internal/cs-workflow-forms/${task_object_id}`,
            payload
        )
            .then(
                info => {
                    dispatch(onDataReceived(Object.assign({}, info, {key: key})));
                },
                err => {
                    Console.error("failed to load forms", err);
                    dispatch(onDataFailed(key));
                }
            );
    };
}

export function submitFormsActionCreator(key, task_object_id, forms) {
    const payload = {key: key, forms: forms};
    return (dispatch) => {
        postJSON(
            `/internal/cs-workflow-forms/${task_object_id}`,
            payload
        )
            .then(
                info => {
                    dispatch(onDataReceived(Object.assign({}, info, {key: key})));
                },
                err => {
                    Console.error("submitForms failed", err);
                    dispatch(onDataFailed());
                }
            );
    };
}
