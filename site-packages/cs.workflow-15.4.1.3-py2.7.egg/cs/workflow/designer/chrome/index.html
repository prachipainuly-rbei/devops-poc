<metal:layout use-macro="global_macros['cdb_standard_page_layout']"
              tal:define="body_style_classes 'full-page';
                          no_title_bar_search True;
                          page_title_brand options.labels['cdbwf_workflow_designer'];
                          favicon string:${options.localres}wfdesigner.ico;
                          cdbicon 'cdbwf_workflow_designer';
                          x_ua_compaitble 'edge'">
<html>
  <metal:header fill-slot="head_block">
    <link href="${options.css}jquery/bootstrap/datepicker/css/datepicker.css" rel="stylesheet" type="text/css" />
    <link href="${options.localres}app.css" rel="stylesheet" type="text/css" />
    <script src="${options.localres}obviel-template.js"></script>
    <script src="${options.localres}obviel.js"></script>
    <script src="${options.localres}underscore.js" type="text/javascript"></script>
    <script src="${options.localres}jquery.jsPlumb.js" type="text/javascript"></script>
    <script src="${options.localres}jquery.jeditable.js" type="text/javascript"></script>
    <script src="${options.localres}bootstrap-datepicker.js" type="text/javascript"></script>
    <metal:include use-macro="postingtools.templates()['postings.html'].macros.postinghead" />
    <script tal:condition="options.currlang != 'en'"
            src="${options.localres}datepicker_locales/bootstrap-datepicker.${options.currlang}.js" type="text/javascript"></script>
    <!--! Use old style catalog impl. for now. Later change it to client side templating -->
    <metal:include use-macro="global_plugins['catalog'].macros['catalog_head']" />
    <link href="${options.localres}catalogs.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript">
        window.cs_workflow_designer_templateUrl = "${template_url}";
    </script>
    <script src="${options.localres}app.js" type="text/javascript"></script>
    <tal:extresources repeat="extres extension_resources">
      <link href="${options.localres_base}${extres.css}" rel="stylesheet" type="text/css"
            tal:condition="extres.css|nothing" />
      <script src="${options.localres_base}${extres.js}" type="text/javascript"
              tal:condition="extres.js|nothing"></script>
    </tal:extresources>
  </metal:header>

  <body>
    <metal:pagecontent fill-slot="page_content">
      <div class="cs-workflow-designer container-fluid"
           data-app_url="${app_url}" />
    </metal:pagecontent>
    <metal:dummybutton fill-slot="hidden_elements">
      <!--! Use old style catalog impl. for now. Later change it to client side templating -->
      <tal:layout metal:use-macro="global_plugins['catalog'].macros['catalog-button']"
                  define="catalog_url responsible_catalog_url;
                          catalog_id 'wf-designer-responsible';
                          catalog_multiselect nothing;
                          catalog_button_class 'initHidden'">
      <tal:layout metal:use-macro="global_plugins['catalog'].macros['catalog-button']"
                  define="catalog_url form_template_catalog_url;
                          catalog_id 'wf-designer-form-template';
                          catalog_multiselect nothing;
                          catalog_button_class 'initHidden'">
      <tal:layout metal:use-macro="global_plugins['catalog'].macros['catalog-button']"
                  define="catalog_url operation_catalog_url;
                          catalog_id 'wf-designer-operation';
                          catalog_multiselect nothing;
                          catalog_button_class 'initHidden'">
      </tal:layout>
      <tal:layout metal:use-macro="global_plugins['catalog'].macros['catalog-button']"
                  define="catalog_url constraints_catalog_url;
                          catalog_id 'wf-designer-constraints';
                          catalog_multiselect nothing;
                          catalog_button_class 'initHidden'">
      </tal:layout>
      <tal:layout metal:use-macro="global_plugins['catalog'].macros['catalog-button']"
                  define="catalog_url project_catalog_url;
                          catalog_id 'wf-designer-projects';
                          catalog_multiselect nothing;
                          catalog_button_class 'initHidden'">
      </tal:layout>
      <tal:layout metal:use-macro="global_plugins['catalog'].macros['catalog-button']"
                  define="catalog_url constraints_catalog_url;
                          catalog_id 'wf-designer-objectfilters';
                          catalog_multiselect nothing;
                          catalog_button_class 'initHidden'">
      </tal:layout>
      <span tal:repeat="extres extension_resources">
        <span tal:repeat="extcatalog extres.catalogs"
              tal:condition="extres.catalogs|nothing">>
          <tal:layout metal:use-macro="global_plugins['catalog'].macros['catalog-button']"
                      define="catalog_url extcatalog.url;
                              catalog_id extcatalog.id;
                              catalog_multiselect nothing;
                              catalog_button_class 'initHidden'"
                      tal:condition="extcatalog.url|nothing">
          </span>
        </span>
      <script type="text/javascript">
          var responsibleRolesURL = '${resposible_roles_url}';
          var catalogCdbProcessId = '${cdb_process_id}';
          var task_title_placeholder = '${task_title_placeholder}';
      </script>
      <script src="${options.localres}catalogs.js" type="text/javascript"></script>
      <script src="${options.localres}blog.js" type="text/javascript"></script>
      <script type="text/javascript">
          $(document).ready(function() {
              $('.cs-workflow-designer').on('processTitleChanged', function(ev, title) {
                  document.title = title;
              });
          });
      </script>

      <img id="ajax_animation" class="ajax_animation" src="${options.localres}ajax-loader.gif" />
      <img id="ajax_animation_whitebg" class="ajax_animation"
          src="${options.localres}ajax-loader-whitebg.gif" />
    </metal:dummybutton>
  </body>
</html>
</metal:layout>
