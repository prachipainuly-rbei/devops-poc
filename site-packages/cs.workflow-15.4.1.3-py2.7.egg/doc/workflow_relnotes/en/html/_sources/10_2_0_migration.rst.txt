.. _`10_2_0_migration`:

Migration
#########

When updating to cs.workflow 10.2.0, you will have to migrate your data and
configuration.


Data
====

Data is migrated automatically (see :ref:`10_2_0_whatsnew` and
:ref:`10_2_0_cancelations`).

The migration script will update all Workflows and Workflow Templates to the new
version. You should always check the migration results. Especially Templates may
be optimized manually.

The migration script works as follows:

* Information Tasks are replaced by System Tasks of type :guilabel:`Information`

    If the Task was already :guilabel:`ready` or
    :guilabel:`done`, an :guilabel:`Information Message` is created also.

    .. tip::
      When `Information Messages` are created, E-Mail notifications may be sent
      (subject to configuration). If you want to prevent this to happen during
      migration, you can temporarily set the environment variable
      `CADDOK_STOP_EMAIL_NOTIFICATION` to any string (for example `"TRUE"`). To
      re-enable notifications after the migration script is finished, just
      remove the variable.

* Manual Task Grops are repaced by Parallel Task Groups

    Each Task in the Task Group is replaced by a new Sequential Task Group
    containing an Execution Task titled ``Activate manual task <task_name>``,
    and the original Task.

* Object Roles are migrated

    + Each Object Role becomes a Briefcase
    + The Role's objects are assigned to the Briefcase

    .. note::
        Custom object assignments (by deriving from `ObjectReference`) are not
        migrated. To mitigate this, you can run the script
        `cs.workflow.updates.assign_objects`::

            powerscript assign_objects.py --help

    + If needed, a :guilabel:`Status Change` System Task titled "<Object
      Role's name> + successful" is added to the Workflow's Completion Task
      Group.
    + If needed, a :guilabel:`Status Change` System Task titled "<Object
      Role's name> + failure" is added to the Workflow's Completion Task Group.
    + A corresponding |cdb| Object Rule is created (if not existing yet).
    + Parameters are created (filtered by the generated |cdb| Object Rules).


Configuration
=============

cs.workflow 10.2.0 will automatically update your configuration.

Please check your system afterwards if you customized cs.workflow.
