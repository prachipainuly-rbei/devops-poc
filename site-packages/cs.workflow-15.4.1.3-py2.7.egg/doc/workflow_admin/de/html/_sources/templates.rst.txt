.. _`templates`:

Workflow-Vorlagen
#################

Üblicherweise werden wiederholbare :term:`Workflows <Workflow>` durch Vorlagen
gesteuert. Diese können Fachanwender selbst erstellen, ggf. mit Regeln behaften
und freigeben.

Vorlagen transportieren
=======================

Da :term:`Workflow`-Vorlagen inhärenter Bestandteil der Geschäftslogik sind,
sollten diese wie ein Bestandteil des Customizings behandelt und stets zwischen
den Systemen (Entwicklung, Test, Produktion) synchron gehalten werden.

Dies ist mit der folgenden Werkzeugkette möglich:

1. ``cs/workflow/updates/tools/export_process.py``
2. ``cdbexp``
3. ``cdbimp``

.. warning::

    Um Konflikte zwischen IDs zu vermeiden, müssen Sie Vorkehrungen treffen.
    Mögliche Lösungen finden Sie unter :ref:`manage_ids`.

.. warning::

    Transportiert wird lediglich der :term:`Workflow` mitsamt seiner Struktur
    (:term:`Aufgaben <Aufgabe>`, :term:`Mappen <Mappe>`,
    :term:`Constraints <Constraint>`...) und Informationen (:term:`Protokoll`,
    Activities). Explizit vom Transport ausgeschlossen sind referenzierte
    Objekte (nicht jedoch die Referenzen selbst), bspw.
    :term:`Mappeninhalte <Mappeninhalt>` und Anhänge zu Beiträgen und
    Kommentaren im Activity Stream.

Vorgehen
--------

Zuerst sollte der zu transportierende :term:`Workflow` im Quellsystem ausgiebig
getestet werden. Am wenigsten fehleranfällig ist es,
:term:`Workflows <Workflow>` immer nur in einer festgelegten Reihenfolge zu
transportieren (z.B. von der Entwicklung in den Test, vom Test in die
Produktion).

Anschließend kann mit dem mitgelieferten Kommandozeilentool ``export_process``
eine Steuerdatei für ``cdbexp`` erstellt werden. Diese Datei beinhaltet die
Datenbankabfragen, die zum Export des :term:`Workflows <Workflow>` und seiner
Struktur benötigt werden:

.. code-block:: bat

    powerscript -m cs.workflow.updates.tools.export_process P00000000 > P.ctl

Falls der Aufruf fehlerfrei beendet wird, finden Sie in der Ausgabedatei (im
Beispiel ``P.ctl``) die Datenbankabfragen. Die Abfragen können als Eingabe für
``cdbexp`` benutzt werden:

.. code-block:: bat

    cdbexp -c P.ctl -o P.exp

Die Ausgabedatei ``P.exp`` enthält nun die exportierte
:term:`Workflow`-Struktur, die im Zielsystem importiert werden kann (bitte
beugen Sie Konflikten zwischen IDs vor):

.. code-block:: bat

    cdbimp P.exp

.. _`manage_ids`:

Strategien zur Vermeidung von Konflikten zwischen IDs
-----------------------------------------------------

IDs von :term:`Workflows <Workflow>` (``cdbwf_process.cdb_process_id``) und
:term:`Aufgaben <Aufgabe>` (``cdbwf_task.task_id``) werden in der
Standardkonfiguration mit einer fortlaufenden Nummer (``P000...`` bzw.
``T000...``) generiert. Dieser Mechanismus funktioniert nicht
systemübergreifend, weshalb beim Transport von :term:`Workflows <Workflow>` und
:term:`Aufgaben <Aufgabe>` Konflikten vorgebeugt werden muss. Im Folgenden
werden einige Lösungsansätze skizziert.

Separate Nummernkreise
^^^^^^^^^^^^^^^^^^^^^^

Die einfachste Möglichkeit ist, in jedem System getrennte Nummernkreise zu
verwenden. So könnte jedes System einen dedizierten Prefix für die Nummern
verwenden (Bsp.: Entwicklungssystem verwendet für :term:`Workflow`-Nummern
``X000...`` statt ``T000...``).

Wird dieser Ansatz verfolgt, muss beim Transport weiter nichts beachtet werden.

Nummern beim Transport separieren
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Der Export liegt als Textdatei vor. Mit einem geeigneten Editor können Sie
sämtliche potentiell konfligierenden Nummern ersetzen. Diese Lösung ermöglicht
unter anderem auch die Nutzung etwas sprechenderer IDs für Vorlagen, da sowohl
IDs von :term:`Workflows <Workflow>` als auch :term:`Aufgaben <Aufgabe>` auch
rein textuell definiert sein dürfen.

Nummern zusammenführen
^^^^^^^^^^^^^^^^^^^^^^

Sollen systemübergreifend einheitliche Nummern für :term:`Workflow`-Vorlagen
verwendet werden, sollten zumindest die Nummernkreise der Vorlagen von denen
der Instanzen getrennt werden.

Wird dann eine neue Vorlage angelegt, sollte unmittelbar in allen Systemen die
gleiche Nummer "reserviert" werden. Unmittelbar vor dem Transport der fertigen
Vorlage kann der Platzhalter in den Zielsystemen dann gelöscht werden.
