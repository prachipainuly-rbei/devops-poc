.. _`monitoring`:

Monitoring
##########

.. note::

    Dieses Kapitel enthält Informationen über die technische
    Funktionsüberwachung von |cs.workflow|. Für Informationen über das
    Monitoring eigener laufender :term:`Workflows <Workflow>` lesen Sie bitte
    das :ref:`wf_user:workflow_user`.

.. _`wf_service`:

Workflow-Dienst
===============

Läuft der :term:`Workflow-Dienst` nicht, hat das auf das laufende System
ausschließlich den Effekt, dass :term:`Systemaufgaben <Systemaufgabe>` im
Status |task10| nicht abgearbeitet werden. Ihre :term:`Workflows <Workflow>`
pausieren also effektiv, was zu Verzögerungen im Geschäftsprozess führen kann.

Einen Überblick über bevorstehende und fehlgeschlagene Aufträge finden Sie in
der Warteschlange (im Navigationsmenü erreichbar unter |nav_admin|
:menuselection:`Prozesse -> Systemaufgabenaufträge`). Erfolgreich
abgeschlossene Aufträge werden aus der Warteschlange entfernt.

Impersonation
-------------

Die Abarbeitung der :term:`Systemaufgaben <Systemaufgabe>` geschieht in einem
separaten Unterprozess des Dienstes. Damit Rechte korrekt geprüft und
Protokolle korrekt geschrieben werden, wird der Unterprozess mit dem Konto des
Benutzers gestartet, der den :term:`Workflow` gestartet hat. Dieser fungiert
als eindeutiger :term:`Workflow`-Verantwortlicher, da die Konfiguriation auch
die Nennung einer Rolle als Verantwortlicher erlaubt. In der Datenbank finden
Sie die Benutzer-ID im Attribut `started_by` der Relation `cdbwf_process`.

.. warning::

    Nach Deaktivierung eines Benutzerkontos schlagen sämtliche
    :term:`Systemaufgaben <Systemaufgabe>` fehl, deren :term:`Workflow` von
    diesem Benutzer gestartet wurden.

Lizenzprüfung
-------------

Für Lizenzprüfungen im Prozess jeder :term:`Systemaufgabe` wird stellvertretend
ein Service-Benutzerkonto herangezogen. Welches Konto benutzt wird, kann in den
Dienstargumenten mit `--svcuser <personalnummer>` festgelegt werden.

|cs.workflow| liefert zu diesem Zweck das vorkonfigurierte Benutzerkonto
`cs.workflow.svcuser` mit.

.. note::

    Der :term:`Workflow-Dienst` prüft die Lizenzen des
    :term:`Workflow-Besitzers <Workflow-Besitzer>` bei Ausführung einer
    :term:`Systemaufgabe`, belegt sie aber nicht dauerhaft, um den interaktiven
    Betrieb nicht zu stören.

Logging
-------

Das Logverhalten der Unterprozesse kann in `$CADDOK_BASE/etc/wfqueue.conf`
festgelegt werden.

E-Mail Benachrichtigungen
=========================

Anwender können auf Wunsch E-Mail Benachrichtigungen bei Eintreten
:ref:`bestimmter Ereignisse <wf_user:email_notifications>` erhalten.

Damit diese auch tatsächlich verschickt werden können, muss ein E-Mail Server
konfiguriert werden (siehe Umgebungsvariablen :envvar:`CADDOK_MAIL*` und
:envvar:`CADDOK_SMTP*` in der :file:`site.conf`).

Darüber hinaus besteht die Möglichkeit, durch Setzen der Umgebungsvariable
:envvar:`CADDOK_STOP_EMAIL_NOTIFICATION` (ebenfalls in der :file:`site.conf`)
E-Mail Benachrichtigungen aus |cs.workflow| pauschal zu deaktivieren. Dies ist
aber in erster Linie für Test- und Entwicklungssysteme gedacht.
