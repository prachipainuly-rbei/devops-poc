#!/usr/bin/env powerscript
# -*- mode: python; coding: utf-8 -*-
#
# Copyright (C) 2017 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/

__docformat__ = "restructuredtext en"
__revision__ = "$Id: test_upd_v15_3_0_13.py 164873 2017-09-08 14:13:13Z cso $"

import unittest
from cdb import testcase
from cdb.platform.uberserver import Services
from cs.workflow.updates.v15_3_0_13 import UpdateWFServices


class UpdateV15_3_0_13_TestCase(testcase.RollbackTestCase):
    def _UpdateWFServices(self, init_args, expected_result):
        wf_server = "cs.workflow.services.WFServer"

        def get_wf_svcs():
            return Services.KeywordQuery(svcname=wf_server)

        get_wf_svcs().Update(arguments=init_args)

        UpdateWFServices().run()

        for svc in get_wf_svcs():
            self.assertEqual(svc.arguments, expected_result)

    def test_UpdateWFServices(self):
        self._UpdateWFServices(
            "{'--user': 'caddok'}",
            "--svcuser cs.workflow.svcuser")
        self._UpdateWFServices(
            "{'--user': 'caddok', '--svcuser': 'existing_user'}",
            "--svcuser existing_user")
        self._UpdateWFServices(
            "--svcuser existing_user",
            "--svcuser existing_user")
        self._UpdateWFServices("test", "test")
        self._UpdateWFServices(None, None)


# Allow running this testfile directly
if __name__ == "__main__":
    unittest.main()
