# Copyright (C) 1990 - 2018 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

# Setup dimensions:
#   - Workflow status: 0, 10, 20, 30, 40, 50
#   - Task level: 0, 1, 2, Completion
#   - Task status: 0, 10
# Assertion dimensions:
#   - For WF owner, Task owner, "nobody"
#     - "save", "delete", "edit schema", "process manage"
#       - Access on workflow
#     - "save", "delete", "task complete", "task_ready"
#       - Access on task
#       - Access on task predecessors
#       - Access on task successors


Feature: Workflow Access
    Note: read access is always granted, so it will not be tested


Background:
    GIVEN test process exists
        AND process is reset
        AND briefcases are filled


Scenario Outline: Workflow Access (No Running Tasks)
    GIVEN process status is <status>
    THEN user "<user>" is <process> "save" on process
        AND user "<user>" is <process> "delete" on process
        AND user "<user>" is <schema> "edit schema" on process
        AND user "<user>" is <manage> "process manage" on process
        AND user "<user>" is <task_s> "save" on all components
        AND user "<user>" is <schema> "edit schema" on all components
        AND user "<user>" is <task_c> "task complete" on all components
        AND user "<user>" is <task_c> "task_ready" on all taskgroups
        AND user "<user>" is <task_r> "task_ready" on all tasks

    # 0 = New, 10 = Execution, 20 = Completed, 30 = Canceled, 40 = Discarded, 50 = Frozen
    Examples:

    | status | user              | process | schema  | manage  | task_s  | task_c  | task_r  |
    # workflow owner
    | 0      | wftest_wf_owner   | granted | granted | granted | granted | denied  | granted |
    | 10     | wftest_wf_owner   | denied  | granted | granted | granted | granted | granted |
    | 20     | wftest_wf_owner   | denied  | denied  | granted | denied  | denied  | granted |
    | 30     | wftest_wf_owner   | denied  | denied  | granted | denied  | denied  | granted |
    | 40     | wftest_wf_owner   | denied  | denied  | granted | denied  | denied  | granted |
    | 50     | wftest_wf_owner   | denied  | denied  | granted | denied  | denied  | granted |
    # task owner
    | 0      | wftest_task_owner | denied  | denied  | denied  | denied  | denied  | granted |
    | 10     | wftest_task_owner | denied  | denied  | denied  | denied  | denied  | granted |
    | 20     | wftest_task_owner | denied  | denied  | denied  | denied  | denied  | granted |
    | 30     | wftest_task_owner | denied  | denied  | denied  | denied  | denied  | granted |
    | 40     | wftest_task_owner | denied  | denied  | denied  | denied  | denied  | granted |
    | 50     | wftest_task_owner | denied  | denied  | denied  | denied  | denied  | granted |
    # everyone else
    | 0      | wftest_bystander  | denied  | denied  | denied  | denied  | denied  | granted |
    | 10     | wftest_bystander  | denied  | denied  | denied  | denied  | denied  | granted |
    | 20     | wftest_bystander  | denied  | denied  | denied  | denied  | denied  | granted |
    | 30     | wftest_bystander  | denied  | denied  | denied  | denied  | denied  | granted |
    | 40     | wftest_bystander  | denied  | denied  | denied  | denied  | denied  | granted |
    | 50     | wftest_bystander  | denied  | denied  | denied  | denied  | denied  | granted |


Scenario Outline: Workflow Access (In Progress, WF Owner)
    GIVEN process status is 0
        AND current process step is <current>
    THEN user "wftest_wf_owner" is denied "edit schema" on past tasks
        AND user "wftest_wf_owner" is granted "edit schema" on past taskgroups
        AND user "wftest_wf_owner" is denied "edit schema" on current tasks
        AND user "wftest_wf_owner" is granted "edit schema" on future tasks
        AND user "wftest_wf_owner" is denied "save" on past tasks
        AND user "wftest_wf_owner" is granted "save" on past taskgroups
        AND user "wftest_wf_owner" is granted "save" on current tasks
        AND user "wftest_wf_owner" is granted "save" on future tasks
        AND user "wftest_wf_owner" is granted "save" on future taskgroups
        AND user "wftest_wf_owner" is granted "task complete" on all components
        AND user "wftest_wf_owner" is granted "task_ready" on all components

    Examples:

    | current | past_groups |
    | 1       | denied      |
    | 2.1     | denied      |
    | 2.2.1   | denied      |
    | C1      | granted     |


Scenario Outline: Workflow Access (In Progress, Task Owner)
    GIVEN process status is 0
        AND current process step is <current>
    THEN user "wftest_task_owner" is denied "edit schema" on past tasks
        AND user "wftest_task_owner" is denied "edit schema" on all components
        AND user "wftest_task_owner" is denied "save" on past tasks
        AND user "wftest_task_owner" is denied "save" on past taskgroups
        AND user "wftest_task_owner" is granted "save" on current tasks
        AND user "wftest_task_owner" is denied "save" on future tasks
        AND user "wftest_task_owner" is denied "save" on future taskgroups
        AND user "wftest_task_owner" is denied "task complete" on past tasks
        AND user "wftest_task_owner" is denied "task complete" on past taskgroups
        AND user "wftest_task_owner" is granted "task complete" on current tasks
        AND user "wftest_task_owner" is denied "task complete" on future tasks
        AND user "wftest_task_owner" is denied "task_ready" on past tasks
        AND user "wftest_task_owner" is denied "task_ready" on past taskgroups
        # AND user "wftest_task_owner" is denied "task_ready" on current tasks
        AND user "wftest_task_owner" is granted "task_ready" on future tasks
        AND user "wftest_task_owner" is denied "task_ready" on future taskgroups

    Examples:

    | current |
    | 1       |
    | 2.1     |
    | 2.2.1   |
    | C1      |


Scenario Outline: Workflow Access (In Progress, Bystander)
    GIVEN process status is 0
        AND current process step is <current>
    THEN user "wftest_bystander" is denied "edit schema" on all components
        AND user "wftest_bystander" is denied "save" on past tasks
        AND user "wftest_bystander" is denied "save" on past taskgroups
        AND user "wftest_bystander" is denied "save" on current tasks
        AND user "wftest_bystander" is denied "save" on future tasks
        AND user "wftest_bystander" is denied "save" on future taskgroups
        AND user "wftest_bystander" is denied "task complete" on all components
        AND user "wftest_bystander" is denied "task_ready" on past tasks
        AND user "wftest_bystander" is denied "task_ready" on past taskgroups
        # AND user "wftest_bystander" is denied "task_ready" on current tasks
        AND user "wftest_bystander" is granted "task_ready" on future tasks
        AND user "wftest_bystander" is denied "task_ready" on future taskgroups

    Examples:

    | current |
    | 1       |
    | 2.1     |
    | 2.2.1   |
    | C1      |
