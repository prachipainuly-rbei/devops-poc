# Copyright (C) 1990 - 2012 CONTACT Software GmbH
# All rights reserved.
# http://www.contact.de/
#

# TO BE TESTED:
#
# - Create a process from template


Feature: Process Flow

Scenario Outline: Start Process
    GIVEN a process was created
        AND some task has no <attribute>
    WHEN the responsible starts the process
    THEN the process is not started

    Examples:
        | attribute   |
        | responsible |
        | title       |

Scenario: Copy running process
    GIVEN a running process with some tasks exists
    WHEN the process is copied
    THEN the new process and its tasks are in the state new

Scenario: Copy a process with briefcase content
    GIVEN a process was created
        AND some briefcase has some content
    WHEN the process is copied
    THEN the new process has the same briefcase content

Scenario: Delete a process with briefcase content
    GIVEN a process was created
        AND some briefcase has some content
    WHEN the process is deleted
    THEN the links to the content are deleted

Scenario: Edit tasks of a closed project
    GIVEN a closed process with some tasks exists
    WHEN some task is edited
    THEN the task is not modified

@skip  # skip temporarily because of E034162
Scenario Outline: Edit tasks of a running process
    GIVEN a running process with some tasks exists
    WHEN the <attribute> of the task is edited
    THEN the task is <outcome>

    Examples:
        | attribute    | outcome      |
#        | subject_id   | modified     |
        | deadline     | modified     |
        | max_duration | modified     |
        | title        | not modified |

Scenario Outline: Create a new task in a running process
    GIVEN a running process with some running tasks exists
    WHEN a new task is created <position> the other task
    THEN the task is <outcome>

    Examples:
        | position | outcome     |
        | before   | not created |
        | after    | created     |

Scenario Outline: Modify briefcase meaning
    GIVEN a running process with some <status> tasks exists
        AND the <status> task has some info briefcase
    WHEN the briefcase meaning is edited
    THEN the briefcase meaning is <outcome>

    Examples:
        | status      | outcome      |
        | running     | not modified |
        | not running | modified     |

#Scenario Outline: Add content to briefcases
#    GIVEN a <status> process exists
#    WHEN some content is added to some briefcase
#    THEN the content is <outcome>
#
#    Examples:
#        | status  | outcome   |
#        | running | added     |
#        | closed  | not added |

Scenario Outline: Edit task content
    GIVEN a running process with some not running tasks exists
        AND the <status> task has a <object>
    WHEN the <object> of a <status> task is edited
    THEN the <object> is <outcome>

    Examples:
        | object     | status      | outcome      |
        | constraint | running     | not modified |
        | constraint | not running | modified     |

Scenario Outline: Cancel process
    GIVEN a <process status> process with some <task status> tasks exists
    WHEN the process is canceled
    THEN the process is <process outcome>
        AND the task is <task outcome>

    Examples:
        | process status | task status | process outcome | task outcome |
        | not running    | not running | canceled        | canceled     |
        | running        | running     | canceled        | canceled     |
        | running        | closed      | canceled        | not canceled |
        | closed         | closed      | not canceled    | not canceled |

Scenario Outline:2 Delete briefcase content
    GIVEN a process was created
        AND some briefcase has some content
    WHEN the process is <action>
        AND the briefcase content is deleted
    THEN the briefcase content is <outcome>

    Examples:
        | action   | outcome     |
        | started  | deleted     |
        | closed   | not deleted |
        | canceled | not deleted |

Scenario Outline:3 Add briefcase content
    GIVEN a process was created
    WHEN the process is <action>
        AND some briefcase content is added
    THEN the briefcase content is <outcome>

    Examples:
        | action   | outcome   |
        | started  | added     |
        | closed   | not added |
        | canceled | not added |


Scenario Outline: Test on hold state changes
    GIVEN a process created by <role> in state <FROM>, with a task
    WHEN <role> changes the state of this process from <FROM> to <TO>
    THEN the state change is <saved>

    Examples:
     | role                         | FROM      | TO        | saved |
     | cdbwf: Process Administrator | New       | Frozen    | no    |
     | cdbwf: Process Administrator | Execution | Frozen    | yes   |
     | cdbwf: Process Administrator | Completed | Frozen    | no    |
     | cdbwf: Process Administrator | Failed    | Frozen    | no    |
     | cdbwf: Process Administrator | Discarded | Frozen    | no    |
     | cdbwf: Process Administrator | Frozen    | New       | no    |
     | cdbwf: Process Administrator | Frozen    | Execution | yes   |
     | cdbwf: Process Administrator | Frozen    | Completed | no    |
     | cdbwf: Process Administrator | Frozen    | Failed    | yes   |
     | cdbwf: Process Administrator | Frozen    | Discarded | no    |


Scenario Outline: Test on hold process changes
    GIVEN a process created by <role> in state on hold which has a task
    WHEN <role> changes the process
    THEN the process change is <saved>

    Examples:
     | role                                | saved |
     | public,cdbwf: Process Administrator | no    |


Scenario Outline: Test on hold process task status changes
    GIVEN a process created by <role> in state on hold which has a task
    WHEN <role> changes the status of the task to <state>
    THEN the task state change is <saved>

    Examples:
     | role                                | state     | saved |
     | public,cdbwf: Process Administrator | Completed | no    |
     | public,cdbwf: Process Administrator | Rejected  | no    |


Scenario Outline: On holding process keeps status of tasks
    GIVEN a <FROM> process created by <role> has a closed task and a started task
    WHEN <role> changes the state of this process from <FROM> to <TO>
    THEN the closed task stays closed
        AND the started task stays started

    Examples:
     | role                         | FROM      | TO        |
     | cdbwf: Process Administrator | Execution | Frozen    |
     | cdbwf: Process Administrator | Frozen    | Execution |
