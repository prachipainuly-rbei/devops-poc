

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating a BOM automatically &mdash; BOM Generation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="BOM Generation" href="index.html"/>
        <link rel="prev" title="cs.vp.bomcreator.bom" href="cdb_bom_bom.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="/doc/en" class="icon fa-book">
            Documentation Portal
          </a>
        

        
          <a href="index.html" class="icon icon-home"> BOM Generation
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bomcreator_intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bomcreator_intro.html#powerscript-api">Powerscript API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cdb_bom_preface.html">Customization of BOM algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#implementing-a-new-bom-reader">Implementing a new BOM reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#customizing-an-existing-bom-reader">Customizing an existing BOM reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#integrating-a-new-bom-reader">Integrating a new BOM reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#using-callbacks">Using callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#shared-position-numbers">Shared position numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#customizing-the-order-of-entries-for-generating-position-numbers-in-cadbominforeader">Customizing the order of entries for generating position numbers in CADBomInfoReader</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#configuring-an-operation-for-other-classes-than-cad-documents">Configuring an operation for other classes than CAD documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_preface.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating a BOM automatically</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-implementation">Basic implementation</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">BOM Generation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Creating a BOM automatically</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/cdb_automatic_bom.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="creating-a-bom-automatically">
<h1>Creating a BOM automatically<a class="headerlink" href="#creating-a-bom-automatically" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The cs.vp.bomcreator module is designed for customizable, interactive creation
of bills of materials (BOM) and includes a preview function.
However, in some situations customers need BOMs to be created and updated
automatically without user intervention whenever new data enters the system.
It is possible to implement such behaviour with some manual customization.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>To implement automatic BOM creation we first need a suitable integration point
where all needed data is available. The exact user exit or signal to use
depends on the type of input data.</p>
<p>For data imported with the Workspace Manager, the right choice is the signal
<code class="xref py py-obj docutils literal"><span class="pre">wsmcommit</span></code>, emitted by the Workspace Manager communication component. This
signal is only available in <strong>Workspace Manager 3.1</strong> and newer.</p>
</div>
<div class="section" id="basic-implementation">
<h2>Basic implementation<a class="headerlink" href="#basic-implementation" title="Permalink to this headline">¶</a></h2>
<p>The cs.vp.bomcreator.bomreader Python module contains a function
<code class="xref py py-obj docutils literal"><span class="pre">create_and_save_bom</span></code> which is suitable for this use case. It considers the
current configuration and creates a BOM for the article associated with the
given CAD document. Note: Depending on the configuration, it may also create
BOMs for referenced documents and their articles.</p>
<p>The function is called like this, if you are using <strong>Workspace Manager 3.1.1-4</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cdb</span> <span class="k">import</span> <span class="n">sig</span>
<span class="kn">from</span> <span class="nn">cs.documents</span> <span class="k">import</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">cs.vp.bomcreator.bom</span> <span class="k">import</span> <span class="n">UserHintList</span>
<span class="kn">from</span> <span class="nn">cs.vp.bomcreator.bomreader</span> <span class="k">import</span> <span class="n">create_and_save_bom</span>

<span class="nd">@sig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="s2">&quot;wsmcommit&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_bom_after_commit</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">hasArticle</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">Item</span><span class="p">)</span>
        <span class="n">isDrawing</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">z_categ2</span> <span class="o">==</span> <span class="s2">&quot;CAD-Zeichnung&quot;</span>  <span class="c1"># customize!</span>
        <span class="k">if</span> <span class="n">hasArticle</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isDrawing</span><span class="p">:</span>
            <span class="n">errors_and_hints</span> <span class="o">=</span> <span class="n">UserHintList</span><span class="p">()</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">create_and_save_bom</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">errors_and_hints</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># better: log exception</span>
</pre></div>
</div>
<p>In this example, we connect the code to the Workspace Manager-specific
signal <code class="xref py py-obj docutils literal"><span class="pre">wsm_commit</span></code> to make sure that the BOM is created and updated
whenever the data of a document is committed.</p>
<p><code class="xref py py-obj docutils literal"><span class="pre">create_and_save_bom</span></code> logs most errors and warnings automatically.
However, errors will not be visible to the user!</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">BOMs must not be created from drawing documents. The mechanism how to exclude
drawings is dependend on the concrete installation and must be adjusted
(comparing &#8220;z_categ2&#8221; to &#8220;CAD-Zeichnung&#8221; will not work in the general case).</p>
</div>
<p>If you are using <strong>Workspace Manager 3.1.5</strong> or newer, the signature is
slightly changed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="nd">@sig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="s2">&quot;wsmcommit&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_bom_after_commit</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If you are using <strong>Workspace Manager 3.3</strong> or newer, you can improve this
example by returning any errors and warnings to the Workspace Manager where
they will be displayed after the commit operation.</p>
<p>The Workspace Manager expects error messages in a format that is different from
the format that is used by the BOM creation. So some glue code is
necessary:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">cdb</span> <span class="k">import</span> <span class="n">sig</span>
<span class="kn">from</span> <span class="nn">cs.documents</span> <span class="k">import</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">cs.vp.bomcreator.bom</span> <span class="k">import</span> <span class="n">UserHintList</span>
<span class="kn">from</span> <span class="nn">cs.vp.bomcreator.bomreader</span> <span class="k">import</span> <span class="n">create_and_save_bom</span>
<span class="kn">from</span> <span class="nn">cs.wsm.result</span> <span class="k">import</span> <span class="n">Result</span><span class="p">,</span> <span class="n">Error</span><span class="p">,</span> <span class="n">Info</span>


<span class="nd">@sig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="s2">&quot;wsmcommit&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_bom_after_commit</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">Result</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="n">hasArticle</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">Item</span><span class="p">)</span>
        <span class="n">isDrawing</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">z_categ2</span> <span class="o">==</span> <span class="s2">&quot;CAD-Zeichnung&quot;</span>  <span class="c1"># customize!</span>
        <span class="k">if</span> <span class="n">hasArticle</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isDrawing</span><span class="p">:</span>
            <span class="n">errors_and_hints</span> <span class="o">=</span> <span class="n">UserHintList</span><span class="p">()</span>
            <span class="n">create_and_save_bom</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">errors_and_hints</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">convert_to_result</span><span class="p">(</span><span class="n">errors_and_hints</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Unexpected exception while creating BOM for document </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span>
                     <span class="o">%</span> <span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">z_nummer</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">z_index</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">convert_to_result</span><span class="p">(</span><span class="n">userHintList</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">Result</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">msg</span><span class="p">,</span> <span class="n">alertType</span> <span class="ow">in</span> <span class="n">userHintList</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">u&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span>  <span class="c1"># convert to unicode if bytestring</span>
        <span class="k">if</span> <span class="n">alertType</span> <span class="o">==</span> <span class="s1">&#39;alert-error&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">alertType</span> <span class="o">==</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">Info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="cdb_bom_bom.html" class="btn btn-neutral" title="cs.vp.bomcreator.bom" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Contact Software.
      Last updated on 13.08.2018.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'15.2.1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>