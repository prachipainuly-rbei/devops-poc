

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Customization of BOM algorithms &mdash; BOM Generation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="BOM Generation" href="index.html"/>
        <link rel="next" title="cs.vp.bomcreator.bomreader" href="cdb_bom_bomreader.html"/>
        <link rel="prev" title="Introduction" href="bomcreator_intro.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="/doc/en" class="icon fa-book">
            Documentation Portal
          </a>
        

        
          <a href="index.html" class="icon icon-home"> BOM Generation
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bomcreator_intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bomcreator_intro.html#powerscript-api">Powerscript API</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Customization of BOM algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#implementing-a-new-bom-reader">Implementing a new BOM reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-an-existing-bom-reader">Customizing an existing BOM reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integrating-a-new-bom-reader">Integrating a new BOM reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-callbacks">Using callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shared-position-numbers">Shared position numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-the-order-of-entries-for-generating-position-numbers-in-cadbominforeader">Customizing the order of entries for generating position numbers in CADBomInfoReader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-an-operation-for-other-classes-than-cad-documents">Configuring an operation for other classes than CAD documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cdb_automatic_bom.html">Creating a BOM automatically</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cdb_automatic_bom.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_automatic_bom.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_automatic_bom.html#basic-implementation">Basic implementation</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">BOM Generation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Customization of BOM algorithms</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/cdb_bom_preface.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="customization-of-bom-algorithms">
<h1>Customization of BOM algorithms<a class="headerlink" href="#customization-of-bom-algorithms" title="Permalink to this headline">¶</a></h1>
<div class="section" id="implementing-a-new-bom-reader">
<h2>Implementing a new BOM reader<a class="headerlink" href="#implementing-a-new-bom-reader" title="Permalink to this headline">¶</a></h2>
<p>The cs.vp.bomcreator module offers a general mechanism to automatically derive
a BOM (bill of materials) from CAD documents (and other business objects) with appropriate information.
Examples for concrete implementations of this mechanism are contained in the
<em>CONTACT Workspaces</em> package. These implementations work on CAD documents that were
imported with the Workspace Manager.</p>
<p>In this section, you will learn how to extend this functionality with your own
algorithms. This gives you the flexibility to use arbitrary files, file
structures or system objects as the source for your automatically generated
bills of materials, if you are willing to invest in the implementation effort.</p>
<p>To read about this functionality from a user perspective, see section
&#8220;Stuecklisten-Ausleitung aus CAD-Systemen&#8221; in chapter &#8220;Stuecklisten und
Produktstrukturen&#8221; of the <em>CONTACT Virtual Product</em> user manual. To learn about
the configuration options, read chapter &#8220;Stuecklistenverwaltung&#8221;, section
&#8220;Stuecklistenausleitung aus CAD-Systemen&#8221; in the <em>CONTACT Virtual Product</em> administration manual.</p>
<div class="section" id="example-extracting-a-bom-from-a-csv-file">
<h3>Example: Extracting a BOM from a CSV file<a class="headerlink" href="#example-extracting-a-bom-from-a-csv-file" title="Permalink to this headline">¶</a></h3>
<p>BOM readers are implemented as classes that directly or indirectly are
derived from the abstract base class <a class="reference internal" href="cdb_bom_bomreader.html#cs.vp.bomcreator.bomreader.BOMReader" title="cs.vp.bomcreator.bomreader.BOMReader"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bomreader.BOMReader</span></code></a>.
This class defines a very flexible interface. Most custom
implementation don&#8217;t need this flexibility and should derive from
<a class="reference internal" href="cdb_bom_bomreader.html#cs.vp.bomcreator.bomreader.SimpleBOMReader" title="cs.vp.bomcreator.bomreader.SimpleBOMReader"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bomreader.SimpleBOMReader</span></code></a> instead.</p>
<p>As a simple example, the following listing shows the implementation of a BOM reader
that reads its information from a file with lines of comma-separated values. The implementation
assumes that it is invoked on a document with a text file as the first primary file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cdb.objects</span> <span class="k">import</span> <span class="n">ByID</span>
<span class="kn">from</span> <span class="nn">cs.vp.bomcreator.bomreader</span> <span class="k">import</span> <span class="n">SimpleBOMReader</span>
<span class="kn">import</span> <span class="nn">csv</span>


<span class="k">class</span> <span class="nc">CSVBOMReader</span><span class="p">(</span><span class="n">SimpleBOMReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A BOM-Reader that interprets a CSV-file as a bill of materials.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">fill_BOM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bom_context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :Parameters:</span>
<span class="sd">         - bom_context: bomreader.BOMContext</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">ByID</span><span class="p">(</span><span class="n">bom_context</span><span class="o">.</span><span class="n">object_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">PrimaryFiles</span><span class="p">:</span>
            <span class="n">anchor_file</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">PrimaryFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">anchor_file</span><span class="o">.</span><span class="n">get_content</span><span class="p">()</span>    <span class="c1"># String</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>           <span class="c1"># list of Strings</span>

            <span class="c1"># now parse the lines and create a BOM item for each</span>
            <span class="c1"># assumption: every line has the format &quot;part number,part index&quot;</span>
            <span class="k">for</span> <span class="n">part_no</span><span class="p">,</span> <span class="n">part_index</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="n">part_no</span><span class="p">,</span>
                                  <span class="n">t_index</span><span class="o">=</span><span class="n">part_index</span><span class="p">)</span>
</pre></div>
</div>
<p>As you see, this class only has one method: <code class="xref py py-meth docutils literal"><span class="pre">fill_BOM()</span></code>. It takes a
<a class="reference internal" href="cdb_bom_bomreader.html#cs.vp.bomcreator.bomreader.BOMContext" title="cs.vp.bomcreator.bomreader.BOMContext"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bomreader.BOMContext</span></code></a> as its sole argument. From this
<code class="xref py py-obj docutils literal"><span class="pre">bom_context</span></code> object the method navigates to the first primary file of the
document and extracts its contents. The contents string is split into lines which
are parsed as pairs of part numbers and part indices. Using this part information,
the method fills the internal BOM object by repeated calls to <code class="xref py py-meth docutils literal"><span class="pre">add_position()</span></code>.</p>
<p>Before it can be used, the class has to be made available to the system. See section
&#8220;<a class="reference internal" href="#integrating-a-new-bom-reader">Integrating a new BOM reader</a>&#8221;.</p>
<p>This implementation has some weaknesses which will be discussed in
&#8220;<a class="reference internal" href="#improvements-to-the-example">Improvements to the example</a>&#8221;. But first we describe the features that even this simple
implementation gets for free.</p>
</div>
<div class="section" id="advantages-of-using-a-simplebomreader">
<h3>Advantages of using a <code class="xref py py-class docutils literal"><span class="pre">SimpleBOMReader</span></code><a class="headerlink" href="#advantages-of-using-a-simplebomreader" title="Permalink to this headline">¶</a></h3>
<p>BOMs generated by custom BOM readers</p>
<ul class="simple">
<li>will automatically be merged with existing BOMs in the database,</li>
<li>are displayed in the interactive preview, and</li>
<li>will be stored in the database after user confirmation.</li>
</ul>
<p>When creating a BOM with a class derived from <code class="xref py py-class docutils literal"><span class="pre">SimpleBOMReader</span></code>, it will
also automatically take into account any configuration settings:</p>
<ul class="simple">
<li>BOM items will be merged using the correct key attributes.</li>
<li>Positions will be displayed according to the configured display columns.</li>
<li>When storing positions in the database, only the configured attributes
will be updated.</li>
<li>New BOM items without a value for the <code class="xref py py-obj docutils literal"><span class="pre">position</span></code> attribute will
be assigned a position value according to the configured step width.</li>
</ul>
</div>
<div class="section" id="improvements-to-the-example">
<h3>Improvements to the example<a class="headerlink" href="#improvements-to-the-example" title="Permalink to this headline">¶</a></h3>
<p>The implementation of the <code class="xref py py-obj docutils literal"><span class="pre">CSVBOMReader</span></code> in the example above has some problems.
This section shows how to avoid them.</p>
<ul>
<li><p class="first">Reading the complete file contents with the <code class="xref py py-meth docutils literal"><span class="pre">get_contents()</span></code> method can
be problematic with large files. You should check the <code class="xref py py-obj docutils literal"><span class="pre">cdbf_size</span></code> attribute before,
or use a sandbox instead.</p>
</li>
<li><p class="first">The implementation does not handle the case where a line does not match the expected
format.</p>
<p>But more importantly, it also does not check whether the item that a position
references, actually exists. BOM reader implementations should always verify
the existence of items. Otherwise the whole BOM import will fail and the user
will see an error message only after they tried to save the BOM.</p>
<p>Both problems can be fixed by rewriting the <code class="xref py py-obj docutils literal"><span class="pre">for</span></code>-loop like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">line_tuple</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_tuple</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;Unexpected line: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_tuple</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="p">(</span><span class="n">part_no</span><span class="p">,</span> <span class="n">part_index</span><span class="p">)</span> <span class="o">=</span> <span class="n">line_tuple</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">ByKeys</span><span class="p">(</span><span class="n">part_no</span><span class="p">,</span> <span class="n">part_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;Item does not exist: &#39;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                           <span class="o">%</span> <span class="p">(</span><span class="n">part_no</span><span class="p">,</span> <span class="n">part_index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="n">part_no</span><span class="p">,</span>
                              <span class="n">t_index</span><span class="o">=</span><span class="n">part_index</span><span class="p">)</span>
</pre></div>
</div>
<p>This implementation needs an additional import:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cs.vp.items</span> <span class="k">import</span> <span class="n">Item</span>
</pre></div>
</div>
<p>The messages passed to <code class="xref py py-meth docutils literal"><span class="pre">add_error()</span></code> will be shown to the user, who can
then decide whether they want to save the BOM nevertheless.</p>
</li>
<li><p class="first">The implementation does not respect object rules which may be configured to
filter some BOM items. This can be fixed by using the method
<code class="xref py py-meth docutils literal"><span class="pre">ignore_component_item()</span></code> and change the last statement to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_component_item</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="n">part_no</span><span class="p">,</span>
                      <span class="n">t_index</span><span class="o">=</span><span class="n">part_index</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="merging-attribute-values-of-merged-positions">
<h3>Merging attribute values of merged positions<a class="headerlink" href="#merging-attribute-values-of-merged-positions" title="Permalink to this headline">¶</a></h3>
<p>When multiple positions are merged on the basis of their key attributes,
the <code class="xref py py-obj docutils literal"><span class="pre">menge</span></code> attribute is automatically aggregated. Other attributes
are not merged, however. In this case, the value of the position that was
added first is always used.</p>
<p>If you need to change this behaviour, you can check the return value of
the <code class="xref py py-meth docutils literal"><span class="pre">add_position()</span></code> method. Whenever the call to <code class="xref py py-meth docutils literal"><span class="pre">add_position()</span></code>
results in a merge with an existing position, the existing position is returned
as an instance of <code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bom.BOMEntry</span></code>. Otherwise <a class="reference external" href="https://docs.python.org/2.7/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal"><span class="pre">None</span></code></a>
is returned. The <code class="xref py py-obj docutils literal"><span class="pre">attrs</span></code> field
of <code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bom.BOMEntry</span></code> is a dictionary and can be
manipulated in custom code. In this example, we manipulate the <code class="xref py py-obj docutils literal"><span class="pre">auswahlmenge</span></code>
attribute (which is NOT identical to <code class="xref py py-obj docutils literal"><span class="pre">menge</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">existingEntry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="n">part_no</span><span class="p">,</span> <span class="n">auswahlmenge</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="k">if</span> <span class="n">existingEntry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># update auswahlmenge manually</span>
    <span class="n">existingEntry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;auswahlmenge&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span>
</pre></div>
</div>
</div>
<div class="section" id="alternatives-to-simplebomreader">
<h3>Alternatives to <code class="xref py py-class docutils literal"><span class="pre">SimpleBOMReader</span></code><a class="headerlink" href="#alternatives-to-simplebomreader" title="Permalink to this headline">¶</a></h3>
<p>Customizations that need to create and display more than one BOM in one step,
have to derive from the more general interface
<a class="reference internal" href="cdb_bom_bomreader.html#cs.vp.bomcreator.bomreader.BOMReader" title="cs.vp.bomcreator.bomreader.BOMReader"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bomreader.BOMReader</span></code></a> instead.</p>
<p>It is an an important design decision whether to use the methods of the
<a class="reference internal" href="cdb_bom_factory.html#cs.vp.bomcreator.factory.Factory" title="cs.vp.bomcreator.factory.Factory"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.factory.Factory</span></code></a> class to create BOMs and
BOM items or whether to create these objects manually. If you use the
factory methods, the resulting BOMs will automatically respect the current
configuration settings. If you want to work independently from these settings,
you should avoid the factory methods.</p>
<p>The following example illustrates a BOM reader that creates two BOMs using the
<code class="xref py py-obj docutils literal"><span class="pre">Factory</span></code> class. It assumes that there are two pre-existing items <code class="xref py py-obj docutils literal"><span class="pre">self.part</span></code>
and <code class="xref py py-obj docutils literal"><span class="pre">self.assembly2</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MultipleBOMReader</span><span class="p">(</span><span class="n">BOMReader</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">An example of a BOMReader that create more than one BOM.</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bom_context</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">custom_state</span><span class="p">):</span>
        <span class="c1"># MISSING: prepare test data self.part and self.assembly2</span>

        <span class="c1"># create the main bom for the main assembly (taken from the CAD document)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bom</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_BOM</span><span class="p">()</span>
        <span class="c1"># ... and add a position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bom</span><span class="o">.</span><span class="n">create_and_add_entry</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">teilenummer</span><span class="p">,</span> <span class="n">t_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">t_index</span><span class="p">,</span> <span class="n">menge</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># create another BOM for our test assembly, also containing a position</span>
        <span class="n">bom2</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_BOM_for_assembly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span><span class="p">)</span>
        <span class="n">bom2</span><span class="o">.</span><span class="n">create_and_add_entry</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">teilenummer</span><span class="p">,</span> <span class="n">t_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">t_index</span><span class="p">,</span> <span class="n">menge</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># return both BOMs as a list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bom</span><span class="p">,</span> <span class="n">bom2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="customizing-an-existing-bom-reader">
<h2>Customizing an existing BOM reader<a class="headerlink" href="#customizing-an-existing-bom-reader" title="Permalink to this headline">¶</a></h2>
<p>Often it is not necessary to implement a new BOM method from scratch when
handling customization requests. If the requirements cannot be met with
configuration changes and object rules alone, it may suffice to extend an
existing class by overriding a specific method.</p>
<p>All existing implementations support an explicit customization point:
the method <code class="xref py py-meth docutils literal"><span class="pre">adjust_and_filter()</span></code>. We will show how to use it in the next
section.</p>
<div class="section" id="example-converting-attributes-from-workspace-manager-file-information">
<h3>Example: Converting attributes from Workspace Manager file information<a class="headerlink" href="#example-converting-attributes-from-workspace-manager-file-information" title="Permalink to this headline">¶</a></h3>
<p>For this example, we assume that we are importing the BOM from a CAD system,
using the Workspace Manager. We also assume that the package <em>CONTACT Workspaces</em>
is installed.</p>
<p>The problem that is example tries to solve is: the <code class="xref py py-obj docutils literal"><span class="pre">menge</span></code> attribute does not
have the required format. It uses the comma as the decimal separator instead of
following the English convention. To convert the value, we can use a
customization that like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cs.vp.bomcreator.cadbominforeader</span> <span class="k">import</span> <span class="n">CADBomInfoReader</span>

<span class="k">class</span> <span class="nc">CustomCADBomInfoReader</span><span class="p">(</span><span class="n">CADBomInfoReader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">adjust_and_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="n">menge</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;menge&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">menge</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">menge2</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">menge</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;menge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">menge2</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;Could not convert &#39;menge&#39; value: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">menge</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">adjust_and_filter()</span></code> is a method that is supported by all BOM reader
implementations. It works on the level of single BOM items and allows to
change the value of attributes, to add new attribute values, and to discard a
position completely.</p>
<p>As its input, the method takes a dictionary of attribute values.
This dictionary may contain a value for any of the attributes of the system&#8217;s
<code class="xref py py-obj docutils literal"><span class="pre">bom_item</span></code> class. However, if the data comes from an external source, you
cannot make any assumptions about which attributes are present or about the
format of their values.</p>
<p>The above example checks whether there is a <code class="xref py py-obj docutils literal"><span class="pre">menge</span></code> attribute and whether it is
a string. If this is the case, it replaces all commas with periods, tries to
convert the resulting string to a float and stores the float in the dictionary.
If no error occurs, the method returns <a class="reference external" href="https://docs.python.org/2.7/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal"><span class="pre">True</span></code></a> which indicates that the BOM
position should not be discarded. If an exception occurs because the <code class="xref py py-obj docutils literal"><span class="pre">menge</span></code>
string still cannot be converted to float, the method returns <a class="reference external" href="https://docs.python.org/2.7/library/constants.html#False" title="(in Python v2.7)"><code class="xref py py-obj docutils literal"><span class="pre">False</span></code></a> and the
BOM item will be filtered out.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This specific implementation can be problematic if input data contains
commas as thousands separators. In this case you need a more
sophisticated algorithm.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="integrating-a-new-bom-reader">
<h2>Integrating a new BOM reader<a class="headerlink" href="#integrating-a-new-bom-reader" title="Permalink to this headline">¶</a></h2>
<p>A new class like <code class="xref py py-obj docutils literal"><span class="pre">CSVBomReader</span></code> should be part of a new or existing
CONTACT Elements package. In this way, custom BOM implementations can easily be
distributed and updated.</p>
<p>The fully qualified Python class name must be configured as described in section
&#8220;Konfiguration einer eigenen Methode zur Stuecklistenausleitung&#8221; in the
<em>CONTACT Virtual Product</em> administration manual.</p>
</div>
<div class="section" id="using-callbacks">
<h2>Using callbacks<a class="headerlink" href="#using-callbacks" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is necessary to maintain additional database relations whenever
BOM items are written or deleted. The easiest way to do this is to
override one or more of these methods in your <code class="xref py py-obj docutils literal"><span class="pre">BOMReader</span></code> implementation:</p>
<ul class="simple">
<li><code class="xref py py-meth docutils literal"><span class="pre">post_write_component()</span></code></li>
<li><code class="xref py py-meth docutils literal"><span class="pre">post_write_bom()</span></code></li>
<li><code class="xref py py-meth docutils literal"><span class="pre">post_write_boms()</span></code></li>
</ul>
<p>However, you should be aware that this only works with BOMs which were
created with one of the methods in the <a class="reference internal" href="cdb_bom_factory.html#cs.vp.bomcreator.factory.Factory" title="cs.vp.bomcreator.factory.Factory"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.factory.Factory</span></code></a>
class. For details, see the documentation of
<a class="reference internal" href="cdb_bom_bomreader.html#cs.vp.bomcreator.bomreader.BOMReader" title="cs.vp.bomcreator.bomreader.BOMReader"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bomreader.BOMReader</span></code></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You cannot use instance variables in these methods.
If you need persistent values, use <code class="xref py py-meth docutils literal"><span class="pre">set_user_attribute()</span></code> of class
<a class="reference internal" href="cdb_bom_bom.html#cs.vp.bomcreator.bom.GeneratedBOM" title="cs.vp.bomcreator.bom.GeneratedBOM"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bom.GeneratedBOM</span></code></a> instead.</p>
</div>
</div>
<div class="section" id="shared-position-numbers">
<h2>Shared position numbers<a class="headerlink" href="#shared-position-numbers" title="Permalink to this headline">¶</a></h2>
<p>Position numbers are typically automatically created for every new BOM entry,
using the configured step width. If your goal is to have multiple BOM entries
which receive the same generated position number, you can use the class
<a class="reference internal" href="cdb_bom_bom.html#cs.vp.bomcreator.bom.SharedPosition" title="cs.vp.bomcreator.bom.SharedPosition"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bom.SharedPosition</span></code></a>. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">shared_pos</span> <span class="o">=</span> <span class="n">SharedPosition</span><span class="p">()</span>
<span class="n">bom</span><span class="o">.</span><span class="n">create_and_add_entry</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="n">part_nr_1</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">shared_pos</span><span class="p">)</span>
<span class="n">bom</span><span class="o">.</span><span class="n">create_and_add_entry</span><span class="p">(</span><span class="n">teilenummer</span><span class="o">=</span><span class="n">part_nr_2</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">shared_pos</span><span class="p">)</span>
</pre></div>
</div>
<p>The two entries will receive their common position number when the BOM is
synchronized with the database.</p>
<p>The class <code class="xref py py-obj docutils literal"><span class="pre">SharedPosition</span></code> can also be used with the method meth:<code class="xref py py-obj docutils literal"><span class="pre">add_position</span></code>
of BOM readers.</p>
</div>
<div class="section" id="customizing-the-order-of-entries-for-generating-position-numbers-in-cadbominforeader">
<h2>Customizing the order of entries for generating position numbers in CADBomInfoReader<a class="headerlink" href="#customizing-the-order-of-entries-for-generating-position-numbers-in-cadbominforeader" title="Permalink to this headline">¶</a></h2>
<p>When position numbers are automatically assigned to new BOM entries, the order of entries
as added to the BOM is taken into account, e.g. earlier entries get a lower position number.</p>
<p>But sometimes the required behavior is different. Implementations derived from the class
<code class="xref py py-obj docutils literal"><span class="pre">CADBomInfoReader</span></code> can override the method <code class="xref py py-meth docutils literal"><span class="pre">sort_key()</span></code> to influence the order. For example,
to sort by the attribute &#8220;netto_breite&#8221; before assigning position numbers, add this implementation
to your BOM reader:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sort_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;netto_breite&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>By default, <code class="xref py py-obj docutils literal"><span class="pre">CADBomInfoReader</span></code> uses the order of the XML elements in the appinfo
file.</p>
</div>
<div class="section" id="configuring-an-operation-for-other-classes-than-cad-documents">
<h2>Configuring an operation for other classes than CAD documents<a class="headerlink" href="#configuring-an-operation-for-other-classes-than-cad-documents" title="Permalink to this headline">¶</a></h2>
<p>This package comes with a predefined interactive operation for creating BOMs from CAD documents.
This operation is called <code class="xref py py-obj docutils literal"><span class="pre">cdbwsm_createbom</span></code> and belongs to the data dictionary class <code class="xref py py-obj docutils literal"><span class="pre">model</span></code>.
The operation opens a preview of the BOM and allows the user to save it to the database.</p>
<p>It is possible to define such an operation for other data dictionary classes. Classes must fulfill these requirements:</p>
<ul class="simple">
<li>They <em>must</em> have an attribute <code class="xref py py-obj docutils literal"><span class="pre">cdb_object_id</span></code> with the usual semantics.</li>
<li>They <em>must</em> have a 1:1 PowerScript relation named <code class="xref py py-obj docutils literal"><span class="pre">Item</span></code> which returns the associated item. This item will receive the
BOM when it is saved by the user.</li>
<li>They <em>may</em> have an attribute <code class="xref py py-obj docutils literal"><span class="pre">erzeug_system</span></code> which describes the associated application. The application determines
the applied BOM configuration and the value of the <code class="xref py py-obj docutils literal"><span class="pre">cadsource</span></code> attribute of the generated components.</li>
</ul>
<p>The operation must be defined as a <code class="xref py py-obj docutils literal"><span class="pre">SingleObject</span></code> operation of type <code class="xref py py-obj docutils literal"><span class="pre">PowerScript</span></code>. To implement the operation,
connect to it and start the preview application like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cdb</span> <span class="k">import</span> <span class="n">sig</span>

<span class="nd">@sig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">OwnClass</span><span class="p">,</span> <span class="s2">&quot;operation_name&quot;</span><span class="p">,</span> <span class="s2">&quot;now&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_bom_from_own_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="s2">&quot;powerscript/&quot;</span>
            <span class="s2">&quot;cs.vp.bomcreator.app/&quot;</span>
            <span class="s2">&quot;bomcreator_confirm?cdb_object_id=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdb_object_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Or, if your class does <em>not</em> have an attribute <code class="xref py py-obj docutils literal"><span class="pre">erzeug_system</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cdb</span> <span class="k">import</span> <span class="n">sig</span>

<span class="nd">@sig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">OwnClass</span><span class="p">,</span> <span class="s2">&quot;operation_name&quot;</span><span class="p">,</span> <span class="s2">&quot;now&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_bom_from_own_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>

    <span class="n">cadsource</span> <span class="o">=</span> <span class="s2">&quot;ProE&quot;</span>  <span class="c1"># replace with your own application!</span>

    <span class="n">ctx</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="s2">&quot;powerscript/&quot;</span>
            <span class="s2">&quot;cs.vp.bomcreator.app/&quot;</span>
            <span class="s2">&quot;bomcreator_confirm?cdb_object_id=</span><span class="si">%s</span><span class="s2">&amp;cadsource=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdb_object_id</span><span class="p">,</span> <span class="n">cadsource</span><span class="p">))</span>
</pre></div>
</div>
<p>The built-in <code class="xref py py-obj docutils literal"><span class="pre">BOMReader</span></code> implementations all only work on CAD documents. So you also need to implement your own <code class="xref py py-obj docutils literal"><span class="pre">BOMReader</span></code>
if your new operation should do something useful. The <code class="xref py py-obj docutils literal"><span class="pre">cdb_object_id</span></code> of the business object will be available as part of the
<a class="reference internal" href="cdb_bom_bomreader.html#cs.vp.bomcreator.bomreader.BOMContext" title="cs.vp.bomcreator.bomreader.BOMContext"><code class="xref py py-class docutils literal"><span class="pre">cs.vp.bomcreator.bomreader.BOMContext</span></code></a> that is passed to your <code class="xref py py-obj docutils literal"><span class="pre">BOMReader</span></code>.</p>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="cdb_bom_bomreader.html">cs.vp.bomcreator.bomreader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bomreader.html#simplebomreader">SimpleBOMReader</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bomreader.html#bomcontext">BOMContext</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bomreader.html#bomfatalerror">BOMFatalError</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bomreader.html#bomreader">BOMReader</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bomreader.html#make-recursive-reader-type">make_recursive_reader_type</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cdb_bom_factory.html">cs.vp.bomcreator.factory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_factory.html#factory">Factory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cdb_bom_bom.html">cs.vp.bomcreator.bom</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bom.html#bom">BOM</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bom.html#generatedbom">GeneratedBOM</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bom.html#userhintlist">UserHintList</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdb_bom_bom.html#sharedposition">SharedPosition</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cdb_bom_bomreader.html" class="btn btn-neutral float-right" title="cs.vp.bomcreator.bomreader" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bomcreator_intro.html" class="btn btn-neutral" title="Introduction" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Contact Software.
      Last updated on 13.08.2018.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'15.2.1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>