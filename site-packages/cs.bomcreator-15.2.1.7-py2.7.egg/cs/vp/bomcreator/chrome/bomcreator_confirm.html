<metal:page use-macro="global_macros['cdb_standard_page_layout']"
            tal:define="page_title options.labels.WSM_BOM_bom_import + ' - ' + title;
                        page_title_brand options.labels.WSM_BOM_bom_import;
                        no_title_bar_search True;
              ">
    <html>
    <head>
        <metal:block fill-slot="head_block">
            <script src="${options.localres}bomcreator_confirm.js"
                    type="text/javascript"></script>
            <link rel="shortcut icon" type="image/x-icon"
                  cdbicon="cdb_elink_wsmbom"/>
        </metal:block>
    </head>

    <body>
    <tal:buttons metal:fill-slot="page_title_buttons">
        <ul class="nav">
            <li tal:condition="enable_save" class="nav-item"><a onclick="submitBoms()" href="#">${options.labels.WSM_BOM_confirm}</a>
            </li>
            <li class="nav-item"><a onclick="closeApp()" href="#">${options.labels.WSM_BOM_cancel}</a>
            </li>
        </ul>
    </tal:buttons>

    <metal:block fill-slot="page_content">
        <!--  everything is in one form -->
        <form id="bomform" name="bomform">
            <h2>${title}</h2>

            <!--  global hints -->
            <div tal:condition="global_user_hints">
                <div tal:repeat="hint global_user_hints"
                     class="alert ${hint[1]}"
                     tal:content="hint[0]"/>
            </div>

            <!-- for every bom -->
            <div class="well well-large"
                 style="margin-left:${bom.get_margin()}px"
                 tal:repeat="bom boms">
                <!-- checkbox to select / deselect a bom -->
                <div tal:condition="len(boms) > 1 and bom.show_import_checkbox"
                     class="pull-right"><label class="checkbox"
                                               for="${bom.display_name}"> <input
                        tal:condition="not bom.is_writeable" type="checkbox"
                        disabled="disabled" name="${bom.id}"
                        id="${bom.display_name}"/> <input
                        tal:condition="bom.is_writeable" type="checkbox"
                        checked="checked"
                        name="${bom.id}" id="${bom.display_name}"/>
                    ${options.labels.WSM_BOM_select_for_import} </label></div>

                <!-- for BOMs with temporary article -->
                <div tal:condition="bom.assemblyIsTemporary">
                    <!-- bom name  plus a hint that the article is new-->
                    <h3>
                        <a onclick="markArticleAsModified('${bom.id}')"
                           href="${bom._assembly.MakeURL('CDB_Modify')}"><strong>${bom.display_name}</strong></a>
                        (<strong>${options.labels.WSM_BOM_new_item}</strong>)
                    </h3>
                </div>

                <div tal:condition="not bom.assemblyIsTemporary">
                    <!-- bom name -->
                    <h3><a href="${bom._assembly.MakeURL('CDB_ShowObject')}">
                        <strong>${bom.display_name}</strong>
                    </a></h3>
                </div>

                <!--  bom-specific hints -->
                <div tal:condition="bom.user_hints">
                    <div tal:repeat="hint bom.user_hints"
                         tal:attributes="class 'alert ' + hint[1]"
                         tal:content="hint[0]"/>
                </div>

                <!-- the BOM itself -->
                <div tal:condition="bom"><!-- first the normal entries -->
                    <tal:non_deleted
                            condition="bom.non_deleted_entries">
                        <table class="table bomtable">
                            <tr>
                                <th></th>
                                <!-- link to item -->
                                <th tal:repeat="header bom.headers">${header}
                                </th>
                                <th>${options.labels.WSM_BOM_status}</th>
                            </tr>

                            <tr tal:repeat="bomentry bom.non_deleted_entries">
                                <td>
                                    <a href="${bomentry.item.MakeURL('CDB_ShowObject')}">
                                        <img title="${options.labels.show_mask} (${options.labels.cdb_part})"
                                             src="${options.images}external_link1.png">
                                    </a>
                                </td>
                                <td tal:repeat="value bomentry.display_row.columns">
                                    ${value}
                                </td>
                                <td tal:attributes="class bomentry.status_class">
                                    ${bomentry.status_message}
                                </td>
                            </tr>
                        </table>
                    </tal:non_deleted>
                    <!-- now the deleted entries -->
                    <tal:deleted
                            condition="bom.deleted_entries">
                        <h3 class="text-warning">
                            ${options.labels.WSM_BOM_deleted_bom}</h3>
                        <table class="table bomtable">
                            <tr>
                                <th></th>
                                <!-- link to item -->
                                <th tal:repeat="header bom.headers">${header}
                                </th>
                                <th>${options.labels.WSM_BOM_status}</th>
                            </tr>

                            <tr tal:repeat="bomentry bom.deleted_entries">
                                <td>
                                    <a href="${bomentry.item.MakeURL('CDB_ShowObject')}">
                                        <img title="${options.labels.show_mask} (${options.labels.cdb_part})"
                                             src="${options.images}external_link1.png">
                                    </a>
                                </td>
                                <td tal:repeat="value bomentry.display_row.columns">
                                    ${value}
                                </td>
                                <td tal:attributes="class bomentry.status_class">
                                    ${bomentry.status_message}
                                </td>
                            </tr>
                        </table>
                    </tal:deleted>
                    <div tal:condition="not bom.non_deleted_entries and not bom.deleted_entries">
                        ${options.labels.WSM_BOM_no_entries}
                    </div>
                </div>
            <!-- the bom data embedded as html-escaped JSON -->
                <script type="application/json" class="bomdata" data-bomid="${bom.id}">
                    ${bom.json}
                </script>
            </div>

            <button tal:condition="enable_save" class="btn btn-primary" type="button" onclick="submitBoms()">
                ${options.labels.WSM_BOM_confirm}
            </button>
        </form>
        <div id="saveMsg" style="display: none;">${options.labels.WSM_BOM_saving_boms}</div>
    </metal:block>
    </body>
    </html>
</metal:page>

